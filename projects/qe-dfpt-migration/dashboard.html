<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>qe-dfpt-migration — PM Agent</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;700&family=Crimson+Pro:ital,wght@0,300;0,400;0,600;1,300&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#06080c;--bg2:#090c12;--surface:#0d1018;
  --card:#111520;--card2:#161b26;
  --border:#1c2235;--border2:#242d42;
  --text:#d4cfc4;--text2:#7a7d8a;--text3:#4a4d5a;
  --amber:#f5a623;--amber2:#e8941a;--amber-dim:#c47d10;
  --amber-bg:rgba(245,166,35,.07);--amber-glow:rgba(245,166,35,.15);
  --green:#4ade80;--green-bg:rgba(74,222,128,.07);
  --blue:#60a5fa;--blue-bg:rgba(96,165,250,.07);
  --orange:#fb923c;--orange-bg:rgba(251,146,60,.07);
  --red:#f87171;--red-bg:rgba(248,113,113,.07);
  --purple:#c084fc;--purple-bg:rgba(192,132,252,.07);
  --gray:#4b5563;--gray-bg:rgba(75,85,99,.07);
  --mono:'JetBrains Mono',monospace;
  --serif:'Crimson Pro',Georgia,serif;
}
body::before{
  content:'';position:fixed;top:0;left:0;width:100%;height:100%;
  background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,0,0,.06) 2px,rgba(0,0,0,.06) 4px);
  pointer-events:none;z-index:9999;
}
body{
  font-family:var(--mono);background:var(--bg);color:var(--text);
  line-height:1.6;min-height:100vh;
  background-image:radial-gradient(ellipse 80% 50% at 50% -10%,rgba(245,166,35,.04) 0%,transparent 60%);
}

/* ── HEADER ── */
.header{
  padding:28px 48px 22px;border-bottom:1px solid var(--border);
  display:flex;align-items:flex-end;justify-content:space-between;gap:24px;
  position:relative;overflow:hidden;
}
.header::after{content:'';position:absolute;bottom:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,var(--amber-dim),transparent)}
.header-label{font-size:10px;letter-spacing:.2em;color:var(--amber-dim);text-transform:uppercase;margin-bottom:6px;font-weight:500}
.header h1{font-family:var(--serif);font-size:26px;font-weight:300;color:var(--text);letter-spacing:.02em;line-height:1.2}
.header h1 em{font-style:italic;color:var(--amber)}
.header-right{text-align:right;font-size:11px;color:var(--text3);line-height:1.8}
.header-right .proj-id{font-size:13px;color:var(--amber-dim);letter-spacing:.05em}

/* ── STATS BAR ── */
.stats-bar{display:flex;gap:1px;border-bottom:1px solid var(--border);background:var(--border)}
.stat-card{background:var(--surface);padding:18px 28px;flex:1;min-width:100px;position:relative;transition:background .15s}
.stat-card:hover{background:var(--card)}
.stat-card .label{font-size:9px;letter-spacing:.18em;color:var(--text3);text-transform:uppercase;margin-bottom:8px;font-weight:500}
.stat-card .value{font-size:32px;font-weight:300;font-family:var(--mono);line-height:1}
.stat-card .unit{font-size:9px;color:var(--text3);margin-top:4px;letter-spacing:.1em}
.stat-card .value.total{color:var(--amber)}
.stat-card .value.pending{color:var(--blue)}
.stat-card .value.progress{color:var(--orange)}
.stat-card .value.review{color:var(--purple)}
.stat-card .value.done{color:var(--green)}
.stat-card .value.deferred{color:var(--gray)}
.stat-card .value.failed{color:var(--red)}
.stat-bar{position:absolute;bottom:0;left:0;height:2px;background:currentColor;opacity:.4;transition:width .6s cubic-bezier(.4,0,.2,1)}

/* ── TABS ── */
.tabs{display:flex;gap:0;border-bottom:1px solid var(--border);background:var(--bg2);padding:0 48px;overflow-x:auto}
.tab{padding:13px 20px;cursor:pointer;font-size:10px;font-weight:500;letter-spacing:.12em;text-transform:uppercase;color:var(--text3);border:none;background:none;border-bottom:2px solid transparent;transition:all .15s;position:relative;white-space:nowrap}
.tab:hover{color:var(--text2)}
.tab.active{color:var(--amber);border-bottom-color:var(--amber)}

/* ── CONTENT ── */
.content{padding:32px 48px 80px}
.view{display:none}
.view.active{display:block}

/* ── SECTION HEADER ── */
.section-h{font-size:10px;letter-spacing:.2em;text-transform:uppercase;color:var(--amber-dim);margin-bottom:20px;padding-bottom:10px;border-bottom:1px solid var(--border);font-weight:500}

/* ── OVERVIEW ── */
.overview-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px}
@media(max-width:900px){.overview-grid{grid-template-columns:1fr}}
.overview-card{background:var(--surface);border:1px solid var(--border);padding:24px}
.overview-card h3{font-size:10px;letter-spacing:.18em;text-transform:uppercase;color:var(--amber-dim);margin-bottom:14px;font-weight:500}
.overview-card p{font-size:13px;line-height:1.8;color:var(--text2);font-family:var(--serif)}
.overview-card .mono{font-family:var(--mono);font-size:11px;color:var(--text);line-height:2}
.overview-full{grid-column:1/-1}
.critical-path{font-family:var(--mono);font-size:11px;color:var(--text2);background:var(--card);padding:14px 18px;border:1px solid var(--border);overflow-x:auto;white-space:nowrap;line-height:1.8}
.critical-path .arrow{color:var(--amber-dim);margin:0 4px}

/* ── MILESTONES ── */
.milestones{display:grid;gap:0;border:1px solid var(--border)}
.milestone-row{display:grid;grid-template-columns:80px 1fr;border-bottom:1px solid var(--border);transition:background .12s}
.milestone-row:last-child{border-bottom:none}
.milestone-row:hover{background:var(--card)}
.milestone-id{padding:16px 20px;background:var(--surface);border-right:1px solid var(--border);display:flex;align-items:center;justify-content:center}
.milestone-id span{font-size:14px;font-weight:500;color:var(--amber)}
.milestone-body{padding:14px 20px}
.milestone-body .ms-desc{font-size:13px;color:var(--text);font-family:var(--serif);line-height:1.6}
.milestone-body .ms-gate{font-size:11px;color:var(--text3);margin-top:6px}
.milestone-body .ms-gate em{color:var(--text2);font-style:normal}
.ms-progress{height:3px;background:var(--border);margin-top:10px;position:relative}
.ms-progress-fill{height:100%;background:var(--amber);transition:width .6s}

/* ── KANBAN ── */
.kanban{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px}
.column{background:var(--surface);border:1px solid var(--border);border-top:2px solid var(--border2)}
.column-header{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;border-bottom:1px solid var(--border);background:var(--card)}
.column-header .title{font-size:10px;letter-spacing:.15em;text-transform:uppercase;color:var(--text2);font-weight:500}
.column-header .count{font-size:11px;color:var(--amber-dim);font-family:var(--mono)}
.column-body{padding:12px}

/* ── TASK CARD ── */
.task-card{background:var(--card);border:1px solid var(--border);padding:12px 14px;margin-bottom:8px;cursor:pointer;transition:border-color .12s,background .12s;position:relative;clip-path:polygon(0 0,calc(100% - 10px) 0,100% 10px,100% 100%,0 100%)}
.task-card::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,var(--status-color,var(--border2)),transparent);opacity:.6}
.task-card:hover{background:var(--card2);border-color:var(--border2)}
.task-card:hover::before{opacity:1}
.task-card.status-pending{--status-color:var(--blue)}
.task-card.status-in_progress{--status-color:var(--orange)}
.task-card.status-in_review{--status-color:var(--purple)}
.task-card.status-done{--status-color:var(--green)}
.task-card.status-deferred{--status-color:var(--gray)}
.task-card.status-failed,.task-card.status-terminated{--status-color:var(--red)}
.task-card .task-header{display:flex;align-items:center;gap:8px;margin-bottom:7px}
.task-card .task-id{font-size:10px;color:var(--amber-dim);letter-spacing:.06em;font-weight:500}
.status-dot{width:6px;height:6px;border-radius:50%;background:var(--status-color,var(--border2));flex-shrink:0}
.status-dot.pulse{animation:pulse 2s ease-in-out infinite}
@keyframes pulse{0%,100%{opacity:1;box-shadow:0 0 0 0 var(--status-color)}50%{opacity:.7;box-shadow:0 0 0 4px transparent}}
.task-card .task-title{font-size:12px;line-height:1.5;color:var(--text);font-family:var(--serif);font-weight:300;letter-spacing:.01em;margin-bottom:8px}
.task-card .task-meta{display:flex;gap:5px;flex-wrap:wrap}

/* ── BADGES ── */
.badge{font-size:9px;padding:2px 7px;letter-spacing:.08em;text-transform:uppercase;font-weight:500;font-family:var(--mono);border:1px solid currentColor;opacity:.8}
.badge.layer{color:var(--orange);border-color:rgba(251,146,60,.3);background:var(--orange-bg)}
.badge.risk-low{color:var(--green);border-color:rgba(74,222,128,.3);background:var(--green-bg)}
.badge.risk-medium{color:var(--orange);border-color:rgba(251,146,60,.3);background:var(--orange-bg)}
.badge.risk-high{color:var(--red);border-color:rgba(248,113,113,.3);background:var(--red-bg)}
.badge.type{color:var(--purple);border-color:rgba(192,132,252,.3);background:var(--purple-bg)}
.badge.batch{color:var(--blue);border-color:rgba(96,165,250,.3);background:var(--blue-bg)}
.badge.phase{color:var(--amber-dim);border-color:rgba(245,166,35,.3);background:var(--amber-bg)}
.badge.novelty-frontier{color:var(--amber);border-color:rgba(245,166,35,.4);background:var(--amber-bg)}
.badge.novelty-advanced{color:var(--purple);border-color:rgba(192,132,252,.3);background:var(--purple-bg)}
.badge.novelty-incremental{color:var(--text3);border-color:var(--border2);background:var(--gray-bg)}

/* ── TIMELINE ── */
.phase-section{margin-bottom:32px}
.phase-header{font-size:10px;letter-spacing:.2em;text-transform:uppercase;color:var(--amber-dim);font-weight:500;padding:10px 0;border-bottom:1px solid var(--border);margin-bottom:14px;display:flex;align-items:center;gap:12px}
.phase-header::before{content:'';width:20px;height:1px;background:var(--amber-dim)}
.phase-tasks{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:8px;padding-left:32px}

/* ── REFERENCES ── */
.ref-grid{display:grid;gap:16px}
.ref-card{background:var(--surface);border:1px solid var(--border);padding:20px 24px;transition:background .12s}
.ref-card:hover{background:var(--card)}
.ref-card-header{display:flex;align-items:center;gap:10px;margin-bottom:12px}
.ref-card-header .ref-tid{font-size:11px;color:var(--amber);font-weight:500}
.ref-card-header .ref-title{font-size:13px;color:var(--text);font-family:var(--serif)}
.ref-meta{display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap}
.ref-section{margin-bottom:14px}
.ref-section h5{font-size:9px;letter-spacing:.15em;text-transform:uppercase;color:var(--text3);margin-bottom:6px;font-weight:500}
.ref-section p{font-size:12px;line-height:1.7;color:var(--text2)}
.ref-section ul{padding-left:16px;list-style:none}
.ref-section ul li{font-size:12px;line-height:1.8;color:var(--text2);position:relative;padding-left:12px}
.ref-section ul li::before{content:'';position:absolute;left:0;top:9px;width:4px;height:4px;background:var(--amber-dim);border-radius:50%}
.ref-papers{border-top:1px solid var(--border);padding-top:12px;margin-top:12px}
.ref-papers h5{font-size:9px;letter-spacing:.15em;text-transform:uppercase;color:var(--text3);margin-bottom:8px;font-weight:500}
.ref-paper{font-size:11px;line-height:1.7;color:var(--text2);margin-bottom:4px;padding-left:12px;position:relative}
.ref-paper::before{content:'';position:absolute;left:0;top:8px;width:4px;height:1px;background:var(--amber-dim)}
.ref-paper a{color:var(--blue);text-decoration:none;border-bottom:1px solid rgba(96,165,250,.2)}
.ref-paper a:hover{border-bottom-color:var(--blue)}

/* ── GRAPH ── */
.graph-container h2{font-size:10px;letter-spacing:.2em;text-transform:uppercase;color:var(--amber-dim);margin-bottom:20px;padding-bottom:10px;border-bottom:1px solid var(--border)}
#dep-graph-svg{width:100%;min-height:400px;border:1px solid var(--border);background:var(--surface);padding:20px;overflow:auto}
#dep-graph-svg svg{max-width:100%}
.graph-fallback{padding:48px;text-align:center;color:var(--text3)}
.graph-fallback p{font-size:12px;margin-bottom:16px}
.graph-fallback pre{text-align:left;background:var(--card);padding:16px;border:1px solid var(--border);overflow-x:auto;font-size:11px;color:var(--text2);line-height:1.7}

/* ── DEFERRED ── */
.deferred-card{background:var(--surface);border:1px solid var(--border);border-left:2px solid var(--orange);padding:16px 20px;margin-bottom:10px;cursor:pointer;transition:background .12s;clip-path:polygon(0 0,calc(100% - 12px) 0,100% 12px,100% 100%,0 100%)}
.deferred-card:hover{background:var(--card)}
.deferred-card .task-id{font-size:10px;color:var(--amber-dim);margin-bottom:6px}
.deferred-card .task-title{font-size:14px;font-family:var(--serif);font-weight:300;margin-bottom:10px}
.deferred-card .task-meta{display:flex;gap:5px;flex-wrap:wrap;margin-bottom:10px}
.trigger-info{background:rgba(251,146,60,.05);border:1px solid rgba(251,146,60,.15);padding:10px 14px;font-size:11px}
.trigger-label{font-size:9px;letter-spacing:.15em;text-transform:uppercase;color:var(--orange);margin-bottom:4px;font-weight:500}

/* ── MODAL ── */
.modal-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.75);z-index:1000;align-items:center;justify-content:center;backdrop-filter:blur(2px)}
.modal-overlay.active{display:flex}
.modal{background:var(--surface);border:1px solid var(--border2);padding:0;max-width:660px;width:90%;max-height:82vh;overflow-y:auto;position:relative}
.modal::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--amber),transparent)}
.modal-header{display:flex;justify-content:space-between;align-items:flex-start;padding:24px 28px 18px;border-bottom:1px solid var(--border)}
.modal-header .modal-id{font-size:10px;color:var(--amber-dim);letter-spacing:.1em;margin-bottom:6px}
.modal-header h3{font-family:var(--serif);font-size:18px;font-weight:300;color:var(--text);line-height:1.3}
.modal-close{background:none;border:1px solid var(--border);color:var(--text3);font-size:16px;cursor:pointer;padding:4px 10px;transition:all .12s;flex-shrink:0;margin-left:16px}
.modal-close:hover{border-color:var(--amber-dim);color:var(--amber)}
.modal-body{padding:20px 28px 28px}
.modal-section{margin-bottom:20px}
.modal-section h4{font-size:9px;letter-spacing:.18em;text-transform:uppercase;color:var(--text3);margin-bottom:8px;font-weight:500}
.modal-section p,.modal-section li{font-size:13px;line-height:1.7;color:var(--text2)}
.modal-section ul{padding-left:18px}
.modal-section code{background:var(--card);border:1px solid var(--border);padding:1px 6px;font-size:11px;color:var(--amber-dim)}
.modal-kv{display:grid;grid-template-columns:auto 1fr;gap:4px 16px}
.modal-kv .k{font-size:11px;color:var(--text3)}
.modal-kv .v{font-size:11px;color:var(--text)}

/* ── SCROLLBAR ── */
::-webkit-scrollbar{width:6px;height:6px}
::-webkit-scrollbar-track{background:var(--bg)}
::-webkit-scrollbar-thumb{background:var(--border2)}
::-webkit-scrollbar-thumb:hover{background:var(--amber-dim)}
.empty{padding:60px;text-align:center;color:var(--text3);font-size:12px;letter-spacing:.1em}
</style>
</head>
<body>
<div class="header">
  <div class="header-left">
    <div class="header-label">PM Agent / Project Dashboard</div>
    <h1>qe-dfpt-migration</h1>
  </div>
  <div class="header-right">
    <div class="proj-id">qe-dfpt-migration</div>
    <div>Generated by pm-agent</div>
  </div>
</div>

<div class="stats-bar" id="stats-bar"></div>

<div class="tabs" id="tabs-bar">
  <button class="tab active" data-view="overview">Overview</button>
  <button class="tab" data-view="milestones">Milestones</button>
  <button class="tab" data-view="kanban">Kanban</button>
  <button class="tab" data-view="timeline">Timeline</button>
  <button class="tab" data-view="references">References</button>
  <button class="tab" data-view="graph">Dependencies</button>
  <button class="tab" data-view="deferred">Deferred</button>
  <button class="tab" data-view="burndown">Burndown</button>
</div>

<div class="content">
  <div id="overview-view" class="view active"></div>
  <div id="milestones-view" class="view"></div>
  <div id="kanban-view" class="view"></div>
  <div id="timeline-view" class="view"></div>
  <div id="references-view" class="view"></div>
  <div id="graph-view" class="view"></div>
  <div id="deferred-view" class="view"></div>
  <div id="burndown-view" class="view"></div>
</div>

<div class="modal-overlay" id="modal-overlay">
  <div class="modal">
    <div class="modal-header">
      <div>
        <div class="modal-id" id="modal-id"></div>
        <h3 id="modal-title"></h3>
      </div>
      <button class="modal-close" onclick="closeModal()">&#x2715;</button>
    </div>
    <div class="modal-body" id="modal-body"></div>
  </div>
</div>
<script>
let tasks = [{"id": "DFPT-001", "title": "设计 ABACUS DFPT 模块架构", "layer": "infra", "type": "new", "description": "设计 DFPT 模块在 ABACUS 中的整体架构，包括：\n- 模块目录结构（module_dfpt/）\n- 与现有模块的接口（module_pw, module_hamilt_pw, module_elecstate）\n- 数据流设计（FFTGrid, WaveFunction, KPointData 等）\n- ESolver 扩展（ksdft_pw_dfpt）\n- 参考 dvqpsi_cpp 的成功经验", "dependencies": [], "acceptance_criteria": ["完成架构设计文档（DFPT_ARCHITECTURE.md）", "定义核心数据结构和接口", "明确与 ABACUS 现有模块的集成点", "设计文档通过技术评审"], "files_to_touch": ["source/module_dfpt/README.md", "docs/DFPT_ARCHITECTURE.md"], "estimated_scope": "medium", "specialist": "architect", "gates": [], "status": "pending", "branch_name": "", "commit_hash": "", "worktree_path": "", "risk_level": "", "defer_trigger": "", "original_dependencies": [], "suspended_dependencies": [], "started_at": "", "completed_at": ""}, {"id": "DFPT-002", "title": "建立代码审核工作流", "layer": "infra", "type": "new", "description": "基于 /root/code-review-agent/ 建立 DFPT 迁移的代码审核流程：\n- 配置 6-agent 并发审核（单位、物理、算法、风格、调用链、防御）\n- 配置 3-agent 串行迁移工作流（源码分析、目标模式、差异适配）\n- 准备 ABACUS 领域知识文档（domain-knowledge/abacus-dfpt.md）\n- 设置审核 schema 和 prompt 模板", "dependencies": ["DFPT-001"], "acceptance_criteria": ["code-review-agent 配置完成", "ABACUS DFPT 领域知识文档就绪", "审核工作流测试通过（用 dvqpsi_cpp 代码验证）", "生成示例审核报告"], "files_to_touch": ["tools/code-review/config.yaml", "tools/code-review/domain-knowledge/abacus-dfpt.md", "tools/code-review/prompts/review-dfpt-*.md"], "estimated_scope": "medium", "specialist": "devops", "gates": [], "status": "pending", "branch_name": "", "commit_hash": "", "worktree_path": "", "risk_level": "", "defer_trigger": "", "original_dependencies": [], "suspended_dependencies": [], "started_at": "", "completed_at": ""}, {"id": "DFPT-003", "title": "创建 DFPT 模块骨架和构建系统", "layer": "infra", "type": "new", "description": "在 ABACUS 中创建 module_dfpt 目录结构和 CMake 构建配置：\n- source/module_dfpt/ 目录结构\n- CMakeLists.txt 配置\n- 测试框架集成（GoogleTest）\n- 与主构建系统集成", "dependencies": ["DFPT-001"], "acceptance_criteria": ["module_dfpt 目录结构创建完成", "CMake 构建配置正确", "空模块可以成功编译", "测试框架集成完成"], "files_to_touch": ["source/module_dfpt/CMakeLists.txt", "source/module_dfpt/test/CMakeLists.txt", "source/CMakeLists.txt"], "estimated_scope": "small", "specialist": "build-engineer", "gates": [], "status": "pending", "branch_name": "", "commit_hash": "", "worktree_path": "", "risk_level": "", "defer_trigger": "", "original_dependencies": [], "suspended_dependencies": [], "started_at": "", "completed_at": ""}, {"id": "DFPT-101", "title": "迁移数据结构适配层", "layer": "core", "type": "extend", "description": "创建 dvqpsi_cpp 和 ABACUS 之间的数据结构适配层：\n- FFTGrid ↔ PW_Basis\n- WaveFunction ↔ Psi<complex<double>>\n- KPointData ↔ K_Vectors\n- GVectorData ↔ PW_Basis\n- NonlocalData ↔ pseudopot_cell_vnl", "dependencies": ["DFPT-003"], "acceptance_criteria": ["适配器类实现完成", "单元测试覆盖所有转换", "性能开销 < 5%", "代码审核通过（6-agent review）"], "files_to_touch": ["source/module_dfpt/dfpt_adapters.h", "source/module_dfpt/dfpt_adapters.cpp", "source/module_dfpt/test/test_adapters.cpp"], "estimated_scope": "medium", "specialist": "cpp-developer", "gates": [], "status": "pending", "branch_name": "", "commit_hash": "", "worktree_path": "", "risk_level": "", "defer_trigger": "", "original_dependencies": [], "suspended_dependencies": [], "started_at": "", "completed_at": ""}, {"id": "DFPT-102", "title": "迁移 DVQPsiUS 核心 kernel", "layer": "core", "type": "extend", "description": "将 dvqpsi_cpp 的核心 DFPT kernel 迁移到 ABACUS：\n- 局部势贡献（local potential）\n- 非局部赝势贡献（nonlocal pseudopotential）\n- 超软赝势增强（ultrasoft augmentation）\n- FFT 操作集成（使用 ABACUS 的 UFFT）\n- OpenMP 并行化", "dependencies": ["DFPT-101"], "acceptance_criteria": ["DVQPsiUS 类实现完成", "与 dvqpsi_cpp 数值结果一致（误差 < 1e-10）", "单元测试通过", "性能与 dvqpsi_cpp 相当", "代码审核通过（物理正确性、算法匹配）"], "files_to_touch": ["source/module_dfpt/dvqpsi_us.h", "source/module_dfpt/dvqpsi_us.cpp", "source/module_dfpt/test/test_dvqpsi.cpp"], "estimated_scope": "large", "specialist": "physics-developer", "gates": [], "status": "pending", "branch_name": "", "commit_hash": "", "worktree_path": "", "risk_level": "", "defer_trigger": "", "original_dependencies": [], "suspended_dependencies": [], "started_at": "", "completed_at": ""}, {"id": "DFPT-103", "title": "迁移 Sternheimer 求解器", "layer": "algorithm", "type": "new", "description": "实现 Sternheimer 方程求解器 (H-ε)·Δψ = -ΔV·ψ：\n- 共轭梯度（CG）求解器\n- 预条件器（diagonal preconditioning）\n- Hamiltonian 算符应用\n- 收敛判据和迭代控制", "dependencies": ["DFPT-102"], "acceptance_criteria": ["Sternheimer 求解器实现完成", "与 QE 参考结果一致", "收敛性测试通过", "性能基准达标", "代码审核通过"], "files_to_touch": ["source/module_dfpt/sternheimer_solver.h", "source/module_dfpt/sternheimer_solver.cpp", "source/module_dfpt/cg_solver.h", "source/module_dfpt/cg_solver.cpp", "source/module_dfpt/test/test_sternheimer.cpp"], "estimated_scope": "large", "specialist": "algorithm-developer", "gates": [], "status": "pending", "branch_name": "", "commit_hash": "", "worktree_path": "", "risk_level": "", "defer_trigger": "", "original_dependencies": [], "suspended_dependencies": [], "started_at": "", "completed_at": ""}, {"id": "DFPT-201", "title": "实现 DFPT 自洽场迭代", "layer": "algorithm", "type": "new", "description": "实现 DFPT 的 SCF 循环：\n- 电荷密度响应计算（Δρ）\n- 势能响应计算（ΔV_SCF = ΔV_H + ΔV_xc）\n- 势能混合（charge mixing）\n- 对称化操作\n- 收敛判据", "dependencies": ["DFPT-103"], "acceptance_criteria": ["DFPT SCF 循环实现完成", "与 QE 收敛行为一致", "支持多种混合方案（linear, Broyden）", "单元测试和集成测试通过", "代码审核通过"], "files_to_touch": ["source/module_dfpt/dfpt_scf.h", "source/module_dfpt/dfpt_scf.cpp", "source/module_dfpt/potential_mixer.h", "source/module_dfpt/potential_mixer.cpp", "source/module_dfpt/test/test_dfpt_scf.cpp"], "estimated_scope": "large", "specialist": "physics-developer", "gates": [], "status": "pending", "branch_name": "", "commit_hash": "", "worktree_path": "", "risk_level": "", "defer_trigger": "", "original_dependencies": [], "suspended_dependencies": [], "started_at": "", "completed_at": ""}, {"id": "DFPT-202", "title": "实现动力学矩阵计算", "layer": "algorithm", "type": "new", "description": "计算声子动力学矩阵：\n- 力常数矩阵计算\n- 对称化和约化\n- 本征值求解（声子频率）\n- 本征向量计算（声子模式）\n- LO-TO 劈裂处理（极性材料）", "dependencies": ["DFPT-201"], "acceptance_criteria": ["动力学矩阵计算正确", "声子频率与 QE 一致（误差 < 0.1 cm⁻¹）", "支持声学和规范和", "单元测试通过", "代码审核通过"], "files_to_touch": ["source/module_dfpt/dynmat.h", "source/module_dfpt/dynmat.cpp", "source/module_dfpt/symmetry_dfpt.h", "source/module_dfpt/symmetry_dfpt.cpp", "source/module_dfpt/test/test_dynmat.cpp"], "estimated_scope": "large", "specialist": "physics-developer", "gates": [], "status": "pending", "branch_name": "", "commit_hash": "", "worktree_path": "", "risk_level": "", "defer_trigger": "", "original_dependencies": [], "suspended_dependencies": [], "started_at": "", "completed_at": ""}, {"id": "DFPT-203", "title": "实现电声耦合计算", "layer": "algorithm", "type": "extend", "description": "计算电声耦合矩阵元和相关物理量：\n- EPC 矩阵元 g(k,q,ν)\n- 声子线宽 γ(q,ν)\n- Eliashberg 函数 α²F(ω)\n- 耦合常数 λ\n- Tc 估算（McMillan 公式）", "dependencies": ["DFPT-202"], "acceptance_criteria": ["EPC 计算实现完成", "与 QE 结果一致", "支持 Brillouin zone 积分", "单元测试通过", "代码审核通过"], "files_to_touch": ["source/module_dfpt/elphon.h", "source/module_dfpt/elphon.cpp", "source/module_dfpt/bz_integration.h", "source/module_dfpt/bz_integration.cpp", "source/module_dfpt/test/test_elphon.cpp"], "estimated_scope": "large", "specialist": "physics-developer", "gates": [], "status": "pending", "branch_name": "", "commit_hash": "", "worktree_path": "", "risk_level": "", "defer_trigger": "", "original_dependencies": [], "suspended_dependencies": [], "started_at": "", "completed_at": ""}, {"id": "DFPT-301", "title": "实现 MPI 并行化", "layer": "infra", "type": "new", "description": "添加 MPI 并行支持：\n- k 点并行（pool parallelization）\n- q 点并行（image parallelization）\n- 不可约表示并行\n- 数据通信优化", "dependencies": ["DFPT-203"], "acceptance_criteria": ["MPI 并行实现完成", "并行效率 > 80%（16 进程）", "负载均衡良好", "并行测试通过", "代码审核通过"], "files_to_touch": ["source/module_dfpt/dfpt_parallel.h", "source/module_dfpt/dfpt_parallel.cpp", "source/module_dfpt/test/test_parallel.cpp"], "estimated_scope": "large", "specialist": "hpc-developer", "gates": [], "status": "pending", "branch_name": "", "commit_hash": "", "worktree_path": "", "risk_level": "", "defer_trigger": "", "original_dependencies": [], "suspended_dependencies": [], "started_at": "", "completed_at": ""}, {"id": "DFPT-302", "title": "性能优化和基准测试", "layer": "infra", "type": "new", "description": "性能优化和基准测试：\n- 热点分析和优化\n- 内存使用优化\n- 与 QE 性能对比\n- 生成性能基准报告", "dependencies": ["DFPT-301"], "acceptance_criteria": ["性能与 QE 相当或更优", "内存使用合理", "性能基准报告完成", "优化文档完成"], "files_to_touch": ["docs/DFPT_PERFORMANCE.md", "benchmarks/dfpt_benchmark.cpp"], "estimated_scope": "medium", "specialist": "performance-engineer", "gates": [], "status": "pending", "branch_name": "", "commit_hash": "", "worktree_path": "", "risk_level": "", "defer_trigger": "", "original_dependencies": [], "suspended_dependencies": [], "started_at": "", "completed_at": ""}, {"id": "DFPT-401", "title": "创建 ESolver_DFPT 类", "layer": "workflow", "type": "new", "description": "创建 DFPT ESolver 并集成到 ABACUS 主流程：\n- 实现 ESolver_DFPT 类\n- 集成到 Driver 流程\n- 输入参数处理\n- 输出文件生成", "dependencies": ["DFPT-302"], "acceptance_criteria": ["ESolver_DFPT 实现完成", "可通过 INPUT 文件调用", "输出格式与 ABACUS 一致", "集成测试通过"], "files_to_touch": ["source/module_esolver/esolver_dfpt.h", "source/module_esolver/esolver_dfpt.cpp", "source/module_esolver/esolver.cpp", "source/driver.cpp"], "estimated_scope": "medium", "specialist": "integration-engineer", "gates": [], "status": "pending", "branch_name": "", "commit_hash": "", "worktree_path": "", "risk_level": "", "defer_trigger": "", "original_dependencies": [], "suspended_dependencies": [], "started_at": "", "completed_at": ""}, {"id": "DFPT-402", "title": "实现 q 点网格和工作流", "layer": "workflow", "type": "new", "description": "实现完整的声子计算工作流：\n- q 点网格生成\n- q 点循环驱动\n- 对称性约化\n- 恢复/检查点机制\n- 后处理工具（q2r, matdyn 等效功能）", "dependencies": ["DFPT-401"], "acceptance_criteria": ["q 点网格工作流实现完成", "支持恢复中断的计算", "后处理工具可用", "端到端测试通过"], "files_to_touch": ["source/module_dfpt/qpoint_grid.h", "source/module_dfpt/qpoint_grid.cpp", "source/module_dfpt/phonon_driver.h", "source/module_dfpt/phonon_driver.cpp", "tools/dfpt_postprocess.cpp"], "estimated_scope": "large", "specialist": "workflow-developer", "gates": [], "status": "pending", "branch_name": "", "commit_hash": "", "worktree_path": "", "risk_level": "", "defer_trigger": "", "original_dependencies": [], "suspended_dependencies": [], "started_at": "", "completed_at": ""}, {"id": "DFPT-501", "title": "创建集成测试套件", "layer": "validation", "type": "test", "description": "创建完整的集成测试套件：\n- 简单系统测试（Si, Al 等）\n- 与 QE 结果对比验证\n- 极性材料测试（LO-TO 劈裂）\n- 金属系统测试\n- 电声耦合测试\n- 集成到 abacustest 框架", "dependencies": ["DFPT-402"], "acceptance_criteria": ["集成测试套件完成（≥10 个测试用例）", "所有测试通过", "与 QE 结果一致性验证完成", "测试文档完成"], "files_to_touch": ["tests/integrate/dfpt_*/", "tests/integrate/CASES_DFPT.txt", "docs/DFPT_TESTING.md"], "estimated_scope": "large", "specialist": "test-engineer", "gates": [], "status": "pending", "branch_name": "", "commit_hash": "", "worktree_path": "", "risk_level": "", "defer_trigger": "", "original_dependencies": [], "suspended_dependencies": [], "started_at": "", "completed_at": ""}, {"id": "DFPT-502", "title": "编写用户文档", "layer": "validation", "type": "new", "description": "编写完整的用户文档：\n- 用户手册（如何使用 DFPT 功能）\n- 输入参数说明\n- 示例计算\n- 常见问题解答\n- 与 QE 的差异说明", "dependencies": ["DFPT-501"], "acceptance_criteria": ["用户文档完成", "示例计算可复现", "文档评审通过"], "files_to_touch": ["docs/DFPT_USER_GUIDE.md", "docs/DFPT_INPUT_PARAMETERS.md", "examples/dfpt_*/README.md"], "estimated_scope": "medium", "specialist": "technical-writer", "gates": [], "status": "pending", "branch_name": "", "commit_hash": "", "worktree_path": "", "risk_level": "", "defer_trigger": "", "original_dependencies": [], "suspended_dependencies": [], "started_at": "", "completed_at": ""}, {"id": "DFPT-503", "title": "编写开发者文档", "layer": "validation", "type": "new", "description": "编写开发者文档：\n- 架构设计文档\n- 算法实现细节\n- 代码审核报告汇总\n- 性能分析报告\n- 未来扩展建议", "dependencies": ["DFPT-501"], "acceptance_criteria": ["开发者文档完成", "代码审核报告汇总完成", "文档评审通过"], "files_to_touch": ["docs/DFPT_DEVELOPER_GUIDE.md", "docs/DFPT_ALGORITHM_DETAILS.md", "docs/DFPT_CODE_REVIEW_SUMMARY.md"], "estimated_scope": "medium", "specialist": "technical-writer", "gates": [], "status": "pending", "branch_name": "", "commit_hash": "", "worktree_path": "", "risk_level": "", "defer_trigger": "", "original_dependencies": [], "suspended_dependencies": [], "started_at": "", "completed_at": ""}];
let extra = {"meta": {"request": "将 Quantum ESPRESSO PHonon 包中的 DFPT 功能迁移到 ABACUS C++ 代码库。\n\n**背景：**\n- 源代码：/root/q-e/PHonon/ (183个Fortran文件，主要是PH/目录)\n- 目标代码库：/root/abacus-dfpt/abacus-develop/\n- 之前的尝试：/root/q-e/PHonon/dvqpsi_cpp/ (独立的C++实现，已完成核心DFPT kernel)\n- 代码审核参考：/root/code-review-agent/ (6-agent并发审核系统 + 3-agent串行迁移工作流)\n\n**核心需求：**\n1. 将QE PHonon的DFPT功能用C++重新实现并集成到ABACUS\n2. 保持物理正确性和数值精度\n3. 利用ABACUS现有的模块架构（module_pw, module_hamilt_pw等）\n4. 参考dvqpsi_cpp的成功经验（已实现核心kernel、电声耦合、测试框架）\n5. 建立代码审核流程（物理正确性、算法匹配、数值稳定性）\n\n**技术栈：**\n- 源语言：Fortran 90/95 (QE PHonon)\n- 目标语言：C++11/14 (ABACUS)\n- 构建系统：CMake\n- 测试框架：GoogleTest (单元测试) + abacustest (集成测试)\n- 并行：MPI + OpenMP\n- 数学库：BLAS/LAPACK, FFTW3, ScaLAPACK\n\n**关键组件（按优先级）：**\n1. 核心DFPT kernel (dV/dτ·ψ) - 已在dvqpsi_cpp中实现\n2. Sternheimer求解器 (H-ε)·Δψ = -ΔV·ψ\n3. 自洽场迭代 (SCF loop for DFPT)\n4. 声子动力学矩阵计算\n5. 电声耦合矩阵元\n6. 对称性操作和约化\n7. 并行化（k点、q点、不可约表示）\n\n**质量保证：**\n- 使用code-review-agent的6个审核维度：单位一致性、物理守恒律、算法匹配、代码风格、调用链、防御性编程\n- 使用3-agent迁移工作流：源代码分析 → 目标代码模式提取 → 差异对比和适配计划\n- 与QE参考结果对比验证（声子频率、电声耦合常数）\n- 性能基准测试（与QE对比）\n\n**交付物：**\n- 集成到ABACUS的DFPT模块代码\n- 单元测试和集成测试\n- 用户文档和开发者文档\n- 性能基准报告\n- 代码审核报告（每个关键组件）\n", "project_id": "qe-dfpt-migration", "parsed_intent": {"domain": ["phonon", "pw", "scf"], "method": ["mpi", "openmp"], "validation": [], "keywords": ["quantum", "espresso", "phonon", "dfpt", "abacus", "c++", "root", "fortran", "dvqpsi_cpp", "kernel", "code", "review", "agent", "module_pw", "module_hamilt_pw", "c++11", "cmake", "googletest", "abacustest", "mpi", "openmp", "blas", "lapack", "fftw3", "scalapack", "sternheimer", "scf", "loop"], "raw_request": "将 Quantum ESPRESSO PHonon 包中的 DFPT 功能迁移到 ABACUS C++ 代码库。\n\n**背景：**\n- 源代码：/root/q-e/PHonon/ (183个Fortran文件，主要是PH/目录)\n- 目标代码库：/root/abacus-dfpt/abacus-develop/\n- 之前的尝试：/root/q-e/PHonon/dvqpsi_cpp/ (独立的C++实现，已完成核心DFPT kernel)\n- 代码审核参考：/root/code-review-agent/ (6-agent并发审核系统 + 3-agent串行迁移工作流)\n\n**核心需求：**\n1. 将QE PHonon的DFPT功能用C++重新实现并集成到ABACUS\n2. 保持物理正确性和数值精度\n3. 利用ABACUS现有的模块架构（module_pw, module_hamilt_pw等）\n4. 参考dvqpsi_cpp的成功经验（已实现核心kernel、电声耦合、测试框架）\n5. 建立代码审核流程（物理正确性、算法匹配、数值稳定性）\n\n**技术栈：**\n- 源语言：Fortran 90/95 (QE PHonon)\n- 目标语言：C++11/14 (ABACUS)\n- 构建系统：CMake\n- 测试框架：GoogleTest (单元测试) + abacustest (集成测试)\n- 并行：MPI + OpenMP\n- 数学库：BLAS/LAPACK, FFTW3, ScaLAPACK\n\n**关键组件（按优先级）：**\n1. 核心DFPT kernel (dV/dτ·ψ) - 已在dvqpsi_cpp中实现\n2. Sternheimer求解器 (H-ε)·Δψ = -ΔV·ψ\n3. 自洽场迭代 (SCF loop for DFPT)\n4. 声子动力学矩阵计算\n5. 电声耦合矩阵元\n6. 对称性操作和约化\n7. 并行化（k点、q点、不可约表示）\n\n**质量保证：**\n- 使用code-review-agent的6个审核维度：单位一致性、物理守恒律、算法匹配、代码风格、调用链、防御性编程\n- 使用3-agent迁移工作流：源代码分析 → 目标代码模式提取 → 差异对比和适配计划\n- 与QE参考结果对比验证（声子频率、电声耦合常数）\n- 性能基准测试（与QE对比）\n\n**交付物：**\n- 集成到ABACUS的DFPT模块代码\n- 单元测试和集成测试\n- 用户文档和开发者文档\n- 性能基准报告\n- 代码审核报告（每个关键组件）\n"}, "audit_results": [{"component": "abacus_core", "status": "available", "description": "'abacus' found in abacus_core.source_path", "details": {"category": "source_path", "value": "/root/abacus-develop", "matched_term": "abacus"}}, {"component": "pyabacus", "status": "available", "description": "'abacus' found in pyabacus.source_path", "details": {"category": "source_path", "value": "/root/abacus-develop/python/pyabacus", "matched_term": "abacus"}}, {"component": "abacustest", "status": "available", "description": "'abacus' found in abacustest.result_extraction", "details": {"category": "result_extraction", "value": ["abacus", "vasp", "qe", "cp2k"], "matched_term": "abacus"}}, {"component": "deepmd_kit", "status": "available", "description": "'abacus' found in deepmd_kit.inference", "details": {"category": "inference", "value": ["lammps", "ase", "i_pi", "gromacs", "amber", "cp2k", "abacus"], "matched_term": "abacus"}}, {"component": "deeptb", "status": "available", "description": "'abacus' found in deeptb.training_data", "details": {"category": "training_data", "value": ["abacus", "vasp", "siesta", "openmx"], "matched_term": "abacus"}}, {"component": "pyatb", "status": "available", "description": "'abacus' found in pyatb.input_from", "details": {"category": "input_from", "value": ["abacus"], "matched_term": "abacus"}}, {"component": "abacus_agent_tools", "status": "available", "description": "'abacus' found in abacus_agent_tools.source_path", "details": {"category": "source_path", "value": "/root/abacus-agent-tools", "matched_term": "abacus"}}, {"component": "unknown", "status": "missing", "description": "'abacustest': no matching capability found in registry", "details": {"matched_term": "abacustest"}}, {"component": "abacus_agent_tools", "status": "available", "description": "'agent' found in abacus_agent_tools.source_path", "details": {"category": "source_path", "value": "/root/abacus-agent-tools", "matched_term": "agent"}}, {"component": "unknown", "status": "missing", "description": "'blas': no matching capability found in registry", "details": {"matched_term": "blas"}}, {"component": "unknown", "status": "missing", "description": "'c++': no matching capability found in registry", "details": {"matched_term": "c++"}}, {"component": "unknown", "status": "missing", "description": "'c++11': no matching capability found in registry", "details": {"matched_term": "c++11"}}, {"component": "unknown", "status": "missing", "description": "'cmake': no matching capability found in registry", "details": {"matched_term": "cmake"}}, {"component": "unknown", "status": "missing", "description": "'code': no matching capability found in registry", "details": {"matched_term": "code"}}, {"component": "unknown", "status": "missing", "description": "'dfpt': no matching capability found in registry", "details": {"matched_term": "dfpt"}}, {"component": "unknown", "status": "missing", "description": "'dvqpsi_cpp': no matching capability found in registry", "details": {"matched_term": "dvqpsi_cpp"}}, {"component": "unknown", "status": "missing", "description": "'espresso': no matching capability found in registry", "details": {"matched_term": "espresso"}}, {"component": "unknown", "status": "missing", "description": "'fftw3': no matching capability found in registry", "details": {"matched_term": "fftw3"}}, {"component": "unknown", "status": "missing", "description": "'fortran': no matching capability found in registry", "details": {"matched_term": "fortran"}}, {"component": "unknown", "status": "missing", "description": "'googletest': no matching capability found in registry", "details": {"matched_term": "googletest"}}, {"component": "unknown", "status": "missing", "description": "'kernel': no matching capability found in registry", "details": {"matched_term": "kernel"}}, {"component": "unknown", "status": "missing", "description": "'lapack': no matching capability found in registry", "details": {"matched_term": "lapack"}}, {"component": "pyatb", "status": "available", "description": "'loop' found in pyatb.calculations", "details": {"category": "calculations", "value": ["band_structure", "pdos", "fat_band", "fermi_surface", "berry_phase", "berry_curvature", "electric_polarization", "wilson_loop", "chern_number", "anomalous_hall_conductivity", "weyl_point_detection"], "matched_term": "loop"}}, {"component": "unknown", "status": "missing", "description": "'module_hamilt_pw': no matching capability found in registry", "details": {"matched_term": "module_hamilt_pw"}}, {"component": "unknown", "status": "missing", "description": "'module_pw': no matching capability found in registry", "details": {"matched_term": "module_pw"}}, {"component": "unknown", "status": "missing", "description": "'mpi': no matching capability found in registry", "details": {"matched_term": "mpi"}}, {"component": "unknown", "status": "missing", "description": "'openmp': no matching capability found in registry", "details": {"matched_term": "openmp"}}, {"component": "abacustest", "status": "available", "description": "'phonon' found in abacustest.models", "details": {"category": "models", "value": ["eos", "phonon", "band", "elastic", "vacancy", "bec"], "matched_term": "phonon"}}, {"component": "abacus_core", "status": "available", "description": "'pw' found in abacus_core.basis_types", "details": {"category": "basis_types", "value": ["pw", "lcao", "lcao_in_pw"], "matched_term": "pw"}}, {"component": "pyabacus", "status": "available", "description": "'pw' found in pyabacus.workflows", "details": {"category": "workflows", "value": ["LCAOWorkflow", "PWWorkflow"], "matched_term": "pw"}}, {"component": "unknown", "status": "missing", "description": "'quantum': no matching capability found in registry", "details": {"matched_term": "quantum"}}, {"component": "unknown", "status": "missing", "description": "'review': no matching capability found in registry", "details": {"matched_term": "review"}}, {"component": "abacus_core", "status": "available", "description": "'root' found in abacus_core.source_path", "details": {"category": "source_path", "value": "/root/abacus-develop", "matched_term": "root"}}, {"component": "pyabacus", "status": "available", "description": "'root' found in pyabacus.source_path", "details": {"category": "source_path", "value": "/root/abacus-develop/python/pyabacus", "matched_term": "root"}}, {"component": "abacustest", "status": "available", "description": "'root' found in abacustest.source_path", "details": {"category": "source_path", "value": "/root/abacus-test", "matched_term": "root"}}, {"component": "deepmd_kit", "status": "available", "description": "'root' found in deepmd_kit.source_path", "details": {"category": "source_path", "value": "/root/deepmd-kit", "matched_term": "root"}}, {"component": "deeptb", "status": "available", "description": "'root' found in deeptb.source_path", "details": {"category": "source_path", "value": "/root/DeePTB", "matched_term": "root"}}, {"component": "pyatb", "status": "available", "description": "'root' found in pyatb.source_path", "details": {"category": "source_path", "value": "/root/pyatb", "matched_term": "root"}}, {"component": "abacus_agent_tools", "status": "available", "description": "'root' found in abacus_agent_tools.source_path", "details": {"category": "source_path", "value": "/root/abacus-agent-tools", "matched_term": "root"}}, {"component": "unknown", "status": "missing", "description": "'scalapack': no matching capability found in registry", "details": {"matched_term": "scalapack"}}, {"component": "abacus_core", "status": "available", "description": "'scf' found in abacus_core.calculations", "details": {"category": "calculations", "value": ["scf", "relax", "cell_relax", "md", "tddft"], "matched_term": "scf"}}, {"component": "pyabacus", "status": "available", "description": "'scf' found in pyabacus.callbacks", "details": {"category": "callbacks", "value": ["before_scf", "after_iter", "before_after_scf", "after_scf"], "matched_term": "scf"}}, {"component": "unknown", "status": "missing", "description": "'sternheimer': no matching capability found in registry", "details": {"matched_term": "sternheimer"}}], "tasks": [{"id": "DFPT-001", "title": "设计 ABACUS DFPT 模块架构", "layer": "infra", "type": "new", "description": "设计 DFPT 模块在 ABACUS 中的整体架构，包括：\n- 模块目录结构（module_dfpt/）\n- 与现有模块的接口（module_pw, module_hamilt_pw, module_elecstate）\n- 数据流设计（FFTGrid, WaveFunction, KPointData 等）\n- ESolver 扩展（ksdft_pw_dfpt）\n- 参考 dvqpsi_cpp 的成功经验", "dependencies": [], "acceptance_criteria": ["完成架构设计文档（DFPT_ARCHITECTURE.md）", "定义核心数据结构和接口", "明确与 ABACUS 现有模块的集成点", "设计文档通过技术评审"], "files_to_touch": ["source/module_dfpt/README.md", "docs/DFPT_ARCHITECTURE.md"], "estimated_scope": "medium", "specialist": "architect", "gates": [], "status": "pending", "branch_name": "", "commit_hash": "", "worktree_path": "", "risk_level": "", "defer_trigger": "", "original_dependencies": [], "suspended_dependencies": [], "started_at": "", "completed_at": ""}, {"id": "DFPT-002", "title": "建立代码审核工作流", "layer": "infra", "type": "new", "description": "基于 /root/code-review-agent/ 建立 DFPT 迁移的代码审核流程：\n- 配置 6-agent 并发审核（单位、物理、算法、风格、调用链、防御）\n- 配置 3-agent 串行迁移工作流（源码分析、目标模式、差异适配）\n- 准备 ABACUS 领域知识文档（domain-knowledge/abacus-dfpt.md）\n- 设置审核 schema 和 prompt 模板", "dependencies": ["DFPT-001"], "acceptance_criteria": ["code-review-agent 配置完成", "ABACUS DFPT 领域知识文档就绪", "审核工作流测试通过（用 dvqpsi_cpp 代码验证）", "生成示例审核报告"], "files_to_touch": ["tools/code-review/config.yaml", "tools/code-review/domain-knowledge/abacus-dfpt.md", "tools/code-review/prompts/review-dfpt-*.md"], "estimated_scope": "medium", "specialist": "devops", "gates": [], "status": "pending", "branch_name": "", "commit_hash": "", "worktree_path": "", "risk_level": "", "defer_trigger": "", "original_dependencies": [], "suspended_dependencies": [], "started_at": "", "completed_at": ""}, {"id": "DFPT-003", "title": "创建 DFPT 模块骨架和构建系统", "layer": "infra", "type": "new", "description": "在 ABACUS 中创建 module_dfpt 目录结构和 CMake 构建配置：\n- source/module_dfpt/ 目录结构\n- CMakeLists.txt 配置\n- 测试框架集成（GoogleTest）\n- 与主构建系统集成", "dependencies": ["DFPT-001"], "acceptance_criteria": ["module_dfpt 目录结构创建完成", "CMake 构建配置正确", "空模块可以成功编译", "测试框架集成完成"], "files_to_touch": ["source/module_dfpt/CMakeLists.txt", "source/module_dfpt/test/CMakeLists.txt", "source/CMakeLists.txt"], "estimated_scope": "small", "specialist": "build-engineer", "gates": [], "status": "pending", "branch_name": "", "commit_hash": "", "worktree_path": "", "risk_level": "", "defer_trigger": "", "original_dependencies": [], "suspended_dependencies": [], "started_at": "", "completed_at": ""}, {"id": "DFPT-101", "title": "迁移数据结构适配层", "layer": "core", "type": "extend", "description": "创建 dvqpsi_cpp 和 ABACUS 之间的数据结构适配层：\n- FFTGrid ↔ PW_Basis\n- WaveFunction ↔ Psi<complex<double>>\n- KPointData ↔ K_Vectors\n- GVectorData ↔ PW_Basis\n- NonlocalData ↔ pseudopot_cell_vnl", "dependencies": ["DFPT-003"], "acceptance_criteria": ["适配器类实现完成", "单元测试覆盖所有转换", "性能开销 < 5%", "代码审核通过（6-agent review）"], "files_to_touch": ["source/module_dfpt/dfpt_adapters.h", "source/module_dfpt/dfpt_adapters.cpp", "source/module_dfpt/test/test_adapters.cpp"], "estimated_scope": "medium", "specialist": "cpp-developer", "gates": [], "status": "pending", "branch_name": "", "commit_hash": "", "worktree_path": "", "risk_level": "", "defer_trigger": "", "original_dependencies": [], "suspended_dependencies": [], "started_at": "", "completed_at": ""}, {"id": "DFPT-102", "title": "迁移 DVQPsiUS 核心 kernel", "layer": "core", "type": "extend", "description": "将 dvqpsi_cpp 的核心 DFPT kernel 迁移到 ABACUS：\n- 局部势贡献（local potential）\n- 非局部赝势贡献（nonlocal pseudopotential）\n- 超软赝势增强（ultrasoft augmentation）\n- FFT 操作集成（使用 ABACUS 的 UFFT）\n- OpenMP 并行化", "dependencies": ["DFPT-101"], "acceptance_criteria": ["DVQPsiUS 类实现完成", "与 dvqpsi_cpp 数值结果一致（误差 < 1e-10）", "单元测试通过", "性能与 dvqpsi_cpp 相当", "代码审核通过（物理正确性、算法匹配）"], "files_to_touch": ["source/module_dfpt/dvqpsi_us.h", "source/module_dfpt/dvqpsi_us.cpp", "source/module_dfpt/test/test_dvqpsi.cpp"], "estimated_scope": "large", "specialist": "physics-developer", "gates": [], "status": "pending", "branch_name": "", "commit_hash": "", "worktree_path": "", "risk_level": "", "defer_trigger": "", "original_dependencies": [], "suspended_dependencies": [], "started_at": "", "completed_at": ""}, {"id": "DFPT-103", "title": "迁移 Sternheimer 求解器", "layer": "algorithm", "type": "new", "description": "实现 Sternheimer 方程求解器 (H-ε)·Δψ = -ΔV·ψ：\n- 共轭梯度（CG）求解器\n- 预条件器（diagonal preconditioning）\n- Hamiltonian 算符应用\n- 收敛判据和迭代控制", "dependencies": ["DFPT-102"], "acceptance_criteria": ["Sternheimer 求解器实现完成", "与 QE 参考结果一致", "收敛性测试通过", "性能基准达标", "代码审核通过"], "files_to_touch": ["source/module_dfpt/sternheimer_solver.h", "source/module_dfpt/sternheimer_solver.cpp", "source/module_dfpt/cg_solver.h", "source/module_dfpt/cg_solver.cpp", "source/module_dfpt/test/test_sternheimer.cpp"], "estimated_scope": "large", "specialist": "algorithm-developer", "gates": [], "status": "pending", "branch_name": "", "commit_hash": "", "worktree_path": "", "risk_level": "", "defer_trigger": "", "original_dependencies": [], "suspended_dependencies": [], "started_at": "", "completed_at": ""}, {"id": "DFPT-201", "title": "实现 DFPT 自洽场迭代", "layer": "algorithm", "type": "new", "description": "实现 DFPT 的 SCF 循环：\n- 电荷密度响应计算（Δρ）\n- 势能响应计算（ΔV_SCF = ΔV_H + ΔV_xc）\n- 势能混合（charge mixing）\n- 对称化操作\n- 收敛判据", "dependencies": ["DFPT-103"], "acceptance_criteria": ["DFPT SCF 循环实现完成", "与 QE 收敛行为一致", "支持多种混合方案（linear, Broyden）", "单元测试和集成测试通过", "代码审核通过"], "files_to_touch": ["source/module_dfpt/dfpt_scf.h", "source/module_dfpt/dfpt_scf.cpp", "source/module_dfpt/potential_mixer.h", "source/module_dfpt/potential_mixer.cpp", "source/module_dfpt/test/test_dfpt_scf.cpp"], "estimated_scope": "large", "specialist": "physics-developer", "gates": [], "status": "pending", "branch_name": "", "commit_hash": "", "worktree_path": "", "risk_level": "", "defer_trigger": "", "original_dependencies": [], "suspended_dependencies": [], "started_at": "", "completed_at": ""}, {"id": "DFPT-202", "title": "实现动力学矩阵计算", "layer": "algorithm", "type": "new", "description": "计算声子动力学矩阵：\n- 力常数矩阵计算\n- 对称化和约化\n- 本征值求解（声子频率）\n- 本征向量计算（声子模式）\n- LO-TO 劈裂处理（极性材料）", "dependencies": ["DFPT-201"], "acceptance_criteria": ["动力学矩阵计算正确", "声子频率与 QE 一致（误差 < 0.1 cm⁻¹）", "支持声学和规范和", "单元测试通过", "代码审核通过"], "files_to_touch": ["source/module_dfpt/dynmat.h", "source/module_dfpt/dynmat.cpp", "source/module_dfpt/symmetry_dfpt.h", "source/module_dfpt/symmetry_dfpt.cpp", "source/module_dfpt/test/test_dynmat.cpp"], "estimated_scope": "large", "specialist": "physics-developer", "gates": [], "status": "pending", "branch_name": "", "commit_hash": "", "worktree_path": "", "risk_level": "", "defer_trigger": "", "original_dependencies": [], "suspended_dependencies": [], "started_at": "", "completed_at": ""}, {"id": "DFPT-203", "title": "实现电声耦合计算", "layer": "algorithm", "type": "extend", "description": "计算电声耦合矩阵元和相关物理量：\n- EPC 矩阵元 g(k,q,ν)\n- 声子线宽 γ(q,ν)\n- Eliashberg 函数 α²F(ω)\n- 耦合常数 λ\n- Tc 估算（McMillan 公式）", "dependencies": ["DFPT-202"], "acceptance_criteria": ["EPC 计算实现完成", "与 QE 结果一致", "支持 Brillouin zone 积分", "单元测试通过", "代码审核通过"], "files_to_touch": ["source/module_dfpt/elphon.h", "source/module_dfpt/elphon.cpp", "source/module_dfpt/bz_integration.h", "source/module_dfpt/bz_integration.cpp", "source/module_dfpt/test/test_elphon.cpp"], "estimated_scope": "large", "specialist": "physics-developer", "gates": [], "status": "pending", "branch_name": "", "commit_hash": "", "worktree_path": "", "risk_level": "", "defer_trigger": "", "original_dependencies": [], "suspended_dependencies": [], "started_at": "", "completed_at": ""}, {"id": "DFPT-301", "title": "实现 MPI 并行化", "layer": "infra", "type": "new", "description": "添加 MPI 并行支持：\n- k 点并行（pool parallelization）\n- q 点并行（image parallelization）\n- 不可约表示并行\n- 数据通信优化", "dependencies": ["DFPT-203"], "acceptance_criteria": ["MPI 并行实现完成", "并行效率 > 80%（16 进程）", "负载均衡良好", "并行测试通过", "代码审核通过"], "files_to_touch": ["source/module_dfpt/dfpt_parallel.h", "source/module_dfpt/dfpt_parallel.cpp", "source/module_dfpt/test/test_parallel.cpp"], "estimated_scope": "large", "specialist": "hpc-developer", "gates": [], "status": "pending", "branch_name": "", "commit_hash": "", "worktree_path": "", "risk_level": "", "defer_trigger": "", "original_dependencies": [], "suspended_dependencies": [], "started_at": "", "completed_at": ""}, {"id": "DFPT-302", "title": "性能优化和基准测试", "layer": "infra", "type": "new", "description": "性能优化和基准测试：\n- 热点分析和优化\n- 内存使用优化\n- 与 QE 性能对比\n- 生成性能基准报告", "dependencies": ["DFPT-301"], "acceptance_criteria": ["性能与 QE 相当或更优", "内存使用合理", "性能基准报告完成", "优化文档完成"], "files_to_touch": ["docs/DFPT_PERFORMANCE.md", "benchmarks/dfpt_benchmark.cpp"], "estimated_scope": "medium", "specialist": "performance-engineer", "gates": [], "status": "pending", "branch_name": "", "commit_hash": "", "worktree_path": "", "risk_level": "", "defer_trigger": "", "original_dependencies": [], "suspended_dependencies": [], "started_at": "", "completed_at": ""}, {"id": "DFPT-401", "title": "创建 ESolver_DFPT 类", "layer": "workflow", "type": "new", "description": "创建 DFPT ESolver 并集成到 ABACUS 主流程：\n- 实现 ESolver_DFPT 类\n- 集成到 Driver 流程\n- 输入参数处理\n- 输出文件生成", "dependencies": ["DFPT-302"], "acceptance_criteria": ["ESolver_DFPT 实现完成", "可通过 INPUT 文件调用", "输出格式与 ABACUS 一致", "集成测试通过"], "files_to_touch": ["source/module_esolver/esolver_dfpt.h", "source/module_esolver/esolver_dfpt.cpp", "source/module_esolver/esolver.cpp", "source/driver.cpp"], "estimated_scope": "medium", "specialist": "integration-engineer", "gates": [], "status": "pending", "branch_name": "", "commit_hash": "", "worktree_path": "", "risk_level": "", "defer_trigger": "", "original_dependencies": [], "suspended_dependencies": [], "started_at": "", "completed_at": ""}, {"id": "DFPT-402", "title": "实现 q 点网格和工作流", "layer": "workflow", "type": "new", "description": "实现完整的声子计算工作流：\n- q 点网格生成\n- q 点循环驱动\n- 对称性约化\n- 恢复/检查点机制\n- 后处理工具（q2r, matdyn 等效功能）", "dependencies": ["DFPT-401"], "acceptance_criteria": ["q 点网格工作流实现完成", "支持恢复中断的计算", "后处理工具可用", "端到端测试通过"], "files_to_touch": ["source/module_dfpt/qpoint_grid.h", "source/module_dfpt/qpoint_grid.cpp", "source/module_dfpt/phonon_driver.h", "source/module_dfpt/phonon_driver.cpp", "tools/dfpt_postprocess.cpp"], "estimated_scope": "large", "specialist": "workflow-developer", "gates": [], "status": "pending", "branch_name": "", "commit_hash": "", "worktree_path": "", "risk_level": "", "defer_trigger": "", "original_dependencies": [], "suspended_dependencies": [], "started_at": "", "completed_at": ""}, {"id": "DFPT-501", "title": "创建集成测试套件", "layer": "validation", "type": "test", "description": "创建完整的集成测试套件：\n- 简单系统测试（Si, Al 等）\n- 与 QE 结果对比验证\n- 极性材料测试（LO-TO 劈裂）\n- 金属系统测试\n- 电声耦合测试\n- 集成到 abacustest 框架", "dependencies": ["DFPT-402"], "acceptance_criteria": ["集成测试套件完成（≥10 个测试用例）", "所有测试通过", "与 QE 结果一致性验证完成", "测试文档完成"], "files_to_touch": ["tests/integrate/dfpt_*/", "tests/integrate/CASES_DFPT.txt", "docs/DFPT_TESTING.md"], "estimated_scope": "large", "specialist": "test-engineer", "gates": [], "status": "pending", "branch_name": "", "commit_hash": "", "worktree_path": "", "risk_level": "", "defer_trigger": "", "original_dependencies": [], "suspended_dependencies": [], "started_at": "", "completed_at": ""}, {"id": "DFPT-502", "title": "编写用户文档", "layer": "validation", "type": "new", "description": "编写完整的用户文档：\n- 用户手册（如何使用 DFPT 功能）\n- 输入参数说明\n- 示例计算\n- 常见问题解答\n- 与 QE 的差异说明", "dependencies": ["DFPT-501"], "acceptance_criteria": ["用户文档完成", "示例计算可复现", "文档评审通过"], "files_to_touch": ["docs/DFPT_USER_GUIDE.md", "docs/DFPT_INPUT_PARAMETERS.md", "examples/dfpt_*/README.md"], "estimated_scope": "medium", "specialist": "technical-writer", "gates": [], "status": "pending", "branch_name": "", "commit_hash": "", "worktree_path": "", "risk_level": "", "defer_trigger": "", "original_dependencies": [], "suspended_dependencies": [], "started_at": "", "completed_at": ""}, {"id": "DFPT-503", "title": "编写开发者文档", "layer": "validation", "type": "new", "description": "编写开发者文档：\n- 架构设计文档\n- 算法实现细节\n- 代码审核报告汇总\n- 性能分析报告\n- 未来扩展建议", "dependencies": ["DFPT-501"], "acceptance_criteria": ["开发者文档完成", "代码审核报告汇总完成", "文档评审通过"], "files_to_touch": ["docs/DFPT_DEVELOPER_GUIDE.md", "docs/DFPT_ALGORITHM_DETAILS.md", "docs/DFPT_CODE_REVIEW_SUMMARY.md"], "estimated_scope": "medium", "specialist": "technical-writer", "gates": [], "status": "pending", "branch_name": "", "commit_hash": "", "worktree_path": "", "risk_level": "", "defer_trigger": "", "original_dependencies": [], "suspended_dependencies": [], "started_at": "", "completed_at": ""}], "current_task_id": null, "drafts": {}, "gate_results": {}, "integration_results": [], "phase": "execute", "human_decisions": [], "review_results": [], "human_approvals": [], "brainstorm_results": [], "blocked_reason": null, "optimization_history": [], "last_optimization": null, "optimization_metadata": {}, "charter": {}, "closure": {}}, "milestones": [], "literature": [], "description": "将 Quantum ESPRESSO PHonon 包中的 DFPT 功能迁移到 ABACUS C++ 代码库。\n\n**背景：**\n- 源代码：/root/q-e/PHonon/ (183个Fortran文件，主要是PH/目录)\n- 目标代码库：/root/abacus-dfpt/abacus-develop/\n- 之前的尝试：/root/q-e/PHonon/dvqpsi_cpp/ (独立的C++实现，已完成核心DFPT kernel)\n- 代码审核参考：/root/code-review-agent/ (6-agent并发审核系统 + 3-agent串行迁移工作流)\n\n**核心需求：**\n1. 将QE PHonon的DFPT功能用C++重新实现并集成到ABACUS\n2. 保持物理正确性和数值精度\n3. 利用ABACUS现有的模块架构（module_pw, module_hamilt_pw等）\n4. 参考dvqpsi_cpp的成功经验（已实现核心kernel、电声耦合、测试框架）\n5. 建立代码审核流程（物理正确性、算法匹配、数值稳定性）\n\n**技术栈：**\n- 源语言：Fortran 90/95 (QE PHonon)\n- 目标语言：C++11/14 (ABACUS)\n- 构建系统：CMake\n- 测试框架：GoogleTest (单元测试) + abacustest (集成测试)\n- 并行：MPI + OpenMP\n- 数学库：BLAS/LAPACK, FFTW3, ScaLAPACK\n\n**关键组件（按优先级）：**\n1. 核心DFPT kernel (dV/dτ·ψ) - 已在dvqpsi_cpp中实现\n2. Sternheimer求解器 (H-ε)·Δψ = -ΔV·ψ\n3. 自洽场迭代 (SCF loop for DFPT)\n4. 声子动力学矩阵计算\n5. 电声耦合矩阵元\n6. 对称性操作和约化\n7. 并行化（k点、q点、不可约表示）\n\n**质量保证：**\n- 使用code-review-agent的6个审核维度：单位一致性、物理守恒律、算法匹配、代码风格、调用链、防御性编程\n- 使用3-agent迁移工作流：源代码分析 → 目标代码模式提取 → 差异对比和适配计划\n- 与QE参考结果对比验证（声子频率、电声耦合常数）\n- 性能基准测试（与QE对比）\n\n**交付物：**\n- 集成到ABACUS的DFPT模块代码\n- 单元测试和集成测试\n- 用户文档和开发者文档\n- 性能基准报告\n- 代码审核报告（每个关键组件）\n", "timeline": "", "critical_path": "", "phases": {}, "burndown": {}};

/* ── INIT ── */
function init() {
  renderStats();
  renderOverview();
  renderMilestones();
  renderKanban();
  renderTimeline();
  renderReferences();
  renderGraph();
  renderDeferred();
  bindTabs();
}

/* ── STATS ── */
function renderStats() {
  const bar = document.getElementById('stats-bar');
  const total = tasks.length;
  const counts = {
    pending:     tasks.filter(t => t.status === 'pending').length,
    in_progress: tasks.filter(t => t.status === 'in_progress').length,
    in_review:   tasks.filter(t => t.status === 'in_review').length,
    done:        tasks.filter(t => t.status === 'done').length,
    deferred:    tasks.filter(t => t.status === 'deferred').length,
    failed:      tasks.filter(t => t.status === 'failed' || t.status === 'terminated').length,
  };
  const specs = [
    {label:'Total',    val:total,             cls:'total',    pct:1},
    {label:'Pending',  val:counts.pending,    cls:'pending',  pct:total?counts.pending/total:0},
    {label:'Active',   val:counts.in_progress,cls:'progress', pct:total?counts.in_progress/total:0},
    {label:'Review',   val:counts.in_review,  cls:'review',   pct:total?counts.in_review/total:0},
    {label:'Done',     val:counts.done,       cls:'done',     pct:total?counts.done/total:0},
    {label:'Deferred', val:counts.deferred,   cls:'deferred', pct:total?counts.deferred/total:0},
    {label:'Failed',   val:counts.failed,     cls:'failed',   pct:total?counts.failed/total:0},
  ];
  bar.innerHTML = specs.map(s =>
    `<div class="stat-card">
      <div class="label">${s.label}</div>
      <div class="value ${s.cls}">${s.val}</div>
      <div class="unit">tasks</div>
      <div class="stat-bar" style="width:${(s.pct*100).toFixed(1)}%;color:var(--${s.cls==='total'?'amber':s.cls==='progress'?'orange':s.cls==='review'?'purple':s.cls})"></div>
    </div>`
  ).join('');
}

/* ── OVERVIEW ── */
function renderOverview() {
  const view = document.getElementById('overview-view');
  const desc = extra.description || '';
  const timeline = extra.timeline || '';
  const cp = extra.critical_path || '';
  const phases = extra.phases || {};

  let html = '<h2 class="section-h">Project Overview</h2>';
  html += '<div class="overview-grid">';

  // Description card
  html += `<div class="overview-card">
    <h3>Description</h3>
    <p>${esc(desc)}</p>
    ${timeline ? `<div style="margin-top:14px"><span style="color:var(--text3);font-size:10px;letter-spacing:.12em;text-transform:uppercase">Timeline</span><div class="mono" style="margin-top:6px;color:var(--amber)">${esc(timeline)}</div></div>` : ''}
  </div>`;

  // Phase summary card
  html += '<div class="overview-card"><h3>Phase Summary</h3><div class="mono">';
  for (const [pname, tids] of Object.entries(phases)) {
    const ids = Array.isArray(tids) ? tids : [];
    const done = ids.filter(id => {
      const t = tasks.find(x => x.id === id);
      return t && t.status === 'done';
    }).length;
    const pct = ids.length ? Math.round(done / ids.length * 100) : 0;
    html += `<div style="margin-bottom:8px">
      <span style="color:var(--text2)">${esc(pname)}</span>
      <span style="color:var(--text3);margin:0 8px">${ids.length} tasks</span>
      <span style="color:${pct > 0 ? 'var(--green)' : 'var(--text3)'}">${pct}%</span>
    </div>`;
  }
  html += '</div></div>';

  // Deliverables card
  const deliverables = [
    {phase:'Phase 1', items:['DFT+U PW SCF (nspin=1/2/4)', 'DeltaSpin LCAO/PW', 'GPU/DCU acceleration']},
    {phase:'Phase 2', items:['Adaptive Kerker preconditioning', 'Occupation matrix mixing', 'Constrained DFT framework']},
    {phase:'Phase 3', items:['CeO2/Gd2O3/La2O3 benchmarks', 'ABACUS vs VASP cross-validation (<3%)', 'Convergence reliability (>90%)']},
    {phase:'Phase 4', items:['Auto parameter selection', 'abacustest workflow integration', 'Documentation & examples']},
  ];
  html += '<div class="overview-card"><h3>Key Deliverables</h3>';
  deliverables.forEach(d => {
    html += `<div style="margin-bottom:12px">
      <div style="font-size:10px;letter-spacing:.12em;text-transform:uppercase;color:var(--amber-dim);margin-bottom:4px">${d.phase}</div>`;
    d.items.forEach(item => {
      html += `<div style="font-size:12px;color:var(--text2);padding-left:12px;line-height:1.8;position:relative">
        <span style="position:absolute;left:0;top:8px;width:4px;height:4px;background:var(--amber-dim);border-radius:50%"></span>
        ${esc(item)}
      </div>`;
    });
    html += '</div>';
  });
  html += '</div>';

  // Critical path card
  if (cp) {
    html += '<div class="overview-card"><h3>Critical Path</h3>';
    const parts = cp.split(/\s*→\s*/);
    html += '<div class="critical-path">';
    html += parts.map(p => `<span style="color:var(--text)">${esc(p)}</span>`).join('<span class="arrow">→</span>');
    html += '</div></div>';
  }

  html += '</div>';
  view.innerHTML = html;
}

/* ── MILESTONES ── */
function renderMilestones() {
  const view = document.getElementById('milestones-view');
  const milestones = extra.milestones || [];
  const phases = extra.phases || {};

  let html = '<h2 class="section-h">Milestones & Gates</h2>';

  if (milestones.length === 0) {
    html += '<div class="empty">No milestone data available</div>';
    view.innerHTML = html;
    return;
  }

  html += '<div class="milestones">';
  milestones.forEach(ms => {
    // Try to compute progress for this milestone
    let progress = 0;
    let totalTasks = 0;
    let doneTasks = 0;

    // Map milestone to phase tasks
    const msNum = ms.id.replace(/[^0-9]/g, '');
    for (const [pname, tids] of Object.entries(phases)) {
      const phaseNum = pname.match(/Phase\s*(\d)/i);
      if (phaseNum) {
        const pn = parseInt(phaseNum[1]);
        // M1 covers Phase 0+1, M2 covers Phase 2, M3 covers Phase 3, etc.
        let covers = false;
        if (msNum === '1' && pn <= 1) covers = true;
        if (msNum === '2' && pn <= 2) covers = true;
        if (msNum === '3' && pn <= 3) covers = true;
        if (msNum === '4' && pn <= 4) covers = true;
        if (msNum === '5' && pn <= 4) covers = true;
        if (covers) {
          const ids = Array.isArray(tids) ? tids : [];
          totalTasks += ids.length;
          doneTasks += ids.filter(id => {
            const t = tasks.find(x => x.id === id);
            return t && t.status === 'done';
          }).length;
        }
      }
    }
    progress = totalTasks ? Math.round(doneTasks / totalTasks * 100) : 0;

    html += `<div class="milestone-row">
      <div class="milestone-id"><span>${esc(ms.id)}</span></div>
      <div class="milestone-body">
        <div class="ms-desc">${esc(ms.description)}</div>
        <div class="ms-gate">Coverage: <em>${doneTasks}/${totalTasks} tasks</em></div>
        <div class="ms-progress"><div class="ms-progress-fill" style="width:${progress}%"></div></div>
      </div>
    </div>`;
  });
  html += '</div>';
  view.innerHTML = html;
}

/* ── GROUPING ── */
function detectGrouping() {
  const hasPhase = tasks.some(t => t.phase || (t.id && /^[A-Z]+-\d/.test(t.id)));
  const hasBatch = tasks.some(t => t.batch !== undefined && t.batch !== null);
  if (hasPhase) return 'phase';
  if (hasBatch) return 'batch';
  return 'status';
}
function groupByPhase() {
  const groups = {};
  tasks.forEach(t => {
    let phase = t.phase || '';
    if (!phase && t.id) {
      const m = t.id.match(/^[A-Z]+-(\d)/);
      if (m) phase = 'Phase ' + m[1];
      else if (t.id.match(/^[A-Z]+-D/)) phase = 'Deferred';
    }
    if (!phase) phase = 'Other';
    (groups[phase] = groups[phase] || []).push(t);
  });
  return groups;
}
function groupByBatch() {
  const groups = {};
  tasks.forEach(t => {
    const batch = t.batch !== undefined ? 'Batch ' + t.batch : 'Unassigned';
    (groups[batch] = groups[batch] || []).push(t);
  });
  return groups;
}
function groupByStatus() {
  const order = ['pending','in_progress','in_review','done','deferred','failed'];
  const labels = {pending:'Pending',in_progress:'In Progress',in_review:'In Review',done:'Done',deferred:'Deferred',failed:'Failed'};
  const groups = {};
  order.forEach(s => { groups[labels[s]] = []; });
  tasks.forEach(t => {
    const label = labels[t.status] || t.status || 'Pending';
    (groups[label] = groups[label] || []).push(t);
  });
  return groups;
}

/* ── TASK CARD ── */
function statusDot(status) {
  const pulse = status === 'in_progress' || status === 'in_review';
  const colorMap = {pending:'blue',in_progress:'orange',in_review:'purple',done:'green',deferred:'gray'};
  return `<span class="status-dot${pulse?' pulse':''}" style="--status-color:var(--${colorMap[status]||'red'})"></span>`;
}
function taskCard(t) {
  let meta = '';
  if (t.layer)       meta += `<span class="badge layer">${t.layer}</span>`;
  if (t.type)        meta += `<span class="badge type">${t.type}</span>`;
  if (t.risk_level)  meta += `<span class="badge risk-${t.risk_level}">${t.risk_level}</span>`;
  if (t.batch !== undefined && t.batch !== null) meta += `<span class="badge batch">B${t.batch}</span>`;
  return `<div class="task-card status-${t.status}" data-id="${esc(t.id)}">
    <div class="task-header">${statusDot(t.status)}<span class="task-id">${esc(t.id)}</span></div>
    <div class="task-title">${esc(t.title)}</div>
    <div class="task-meta">${meta}</div>
  </div>`;
}

/* ── KANBAN ── */
function renderKanban() {
  const view = document.getElementById('kanban-view');
  const strategy = detectGrouping();
  const groups = strategy === 'phase' ? groupByPhase() : strategy === 'batch' ? groupByBatch() : groupByStatus();
  let html = '<div class="kanban">';
  for (const [name, items] of Object.entries(groups)) {
    if (items.length === 0) continue;
    html += `<div class="column"><div class="column-header"><span class="title">${esc(name)}</span><span class="count">${items.length}</span></div><div class="column-body">`;
    items.forEach(t => { html += taskCard(t); });
    html += '</div></div>';
  }
  html += '</div>';
  view.innerHTML = html;
  bindCardClicks(view);
}

/* ── TIMELINE ── */
function renderTimeline() {
  const view = document.getElementById('timeline-view');
  const groups = groupByPhase();
  let html = '';
  for (const [name, items] of Object.entries(groups)) {
    const active = items.filter(t => t.status !== 'deferred');
    if (active.length === 0) continue;
    html += `<div class="phase-section"><div class="phase-header">${esc(name)} <span style="color:var(--text3)">(${active.length})</span></div><div class="phase-tasks">`;
    active.forEach(t => { html += taskCard(t); });
    html += '</div></div>';
  }
  view.innerHTML = html || '<div class="empty">No tasks</div>';
  bindCardClicks(view);
}

/* ── REFERENCES ── */
function renderReferences() {
  const view = document.getElementById('references-view');
  const lit = extra.literature || [];

  let html = '<h2 class="section-h">Literature & Technical References</h2>';

  if (lit.length === 0) {
    html += '<div class="empty">No literature review data available</div>';
    view.innerHTML = html;
    return;
  }

  html += '<div class="ref-grid">';
  lit.forEach(entry => {
    const tid = entry.task_id || '';
    const task = tasks.find(t => t.id === tid);
    const title = task ? task.title : tid;
    const novelty = entry.novelty_level || '';

    html += '<div class="ref-card">';
    html += `<div class="ref-card-header">
      <span class="ref-tid">${esc(tid)}</span>
      <span class="ref-title">${esc(title)}</span>
    </div>`;

    // Badges
    html += '<div class="ref-meta">';
    if (novelty) html += `<span class="badge novelty-${novelty}">${novelty}</span>`;
    html += '</div>';

    // State of art
    if (entry.state_of_art) {
      html += `<div class="ref-section"><h5>State of the Art</h5><p>${esc(entry.state_of_art)}</p></div>`;
    }
    // Recent advances
    if (entry.recent_advances) {
      html += `<div class="ref-section"><h5>Recent Advances</h5><p>${esc(entry.recent_advances)}</p></div>`;
    }
    // Gaps
    if (entry.gaps_identified) {
      html += `<div class="ref-section"><h5>Gaps Identified</h5><p>${esc(entry.gaps_identified)}</p></div>`;
    }
    // Improvement suggestions
    const suggestions = entry.improvement_suggestions || [];
    if (suggestions.length) {
      html += '<div class="ref-section"><h5>Improvement Suggestions</h5><ul>';
      suggestions.forEach(s => { html += `<li>${esc(s)}</li>`; });
      html += '</ul></div>';
    }
    // Alternative approaches
    const alts = entry.alternative_approaches || [];
    if (alts.length) {
      html += '<div class="ref-section"><h5>Alternative Approaches</h5><ul>';
      alts.forEach(a => { html += `<li>${esc(a)}</li>`; });
      html += '</ul></div>';
    }
    // Key papers
    const papers = entry.key_papers || [];
    const detailedRefs = entry.detailed_refs || [];
    if (papers.length || detailedRefs.length) {
      html += '<div class="ref-papers"><h5>Key Papers</h5>';
      const allRefs = detailedRefs.length ? detailedRefs : papers;
      allRefs.forEach(p => {
        // Try to extract URL from markdown link
        const linkMatch = p.match(/\[([^\]]+)\]\(([^)]+)\)/);
        if (linkMatch) {
          html += `<div class="ref-paper"><a href="${esc(linkMatch[2])}" target="_blank">${esc(linkMatch[1])}</a></div>`;
        } else {
          html += `<div class="ref-paper">${esc(p.replace(/^\d+\.\s*/, ''))}</div>`;
        }
      });
      html += '</div>';
    }
    html += '</div>';
  });
  html += '</div>';
  view.innerHTML = html;
}

/* ── GRAPH ── */
function renderGraph() {
  const view = document.getElementById('graph-view');
  const withDeps = tasks.filter(t => (t.dependencies && t.dependencies.length > 0) || tasks.some(o => (o.dependencies || []).includes(t.id)));
  let dot = 'digraph G {\\n  rankdir=LR;\\n';
  const statusColor = {pending:'#60a5fa',in_progress:'#fb923c',in_review:'#c084fc',done:'#4ade80',deferred:'#4b5563',failed:'#f87171'};
  tasks.forEach(t => {
    const c = statusColor[t.status] || '#60a5fa';
    const label = t.id + '\\\\n' + (t.title||'').substring(0,24);
    dot += `  "${t.id}" [label="${label}" fillcolor="${c}" style="filled,rounded" shape=box fontname="monospace" fontsize=10];\\n`;
  });
  tasks.forEach(t => {
    (t.dependencies||[]).forEach(d => { dot += `  "${d}" -> "${t.id}";\\n`; });
    (t.suspended_dependencies||[]).forEach(d => { dot += `  "${d}" -> "${t.id}" [style=dashed color="#4b5563"];\\n`; });
  });
  dot += '}';
  let html = '<div class="graph-container"><h2>Task Dependencies</h2><div id="dep-graph-svg">';
  const inlineSvg = document.getElementById('embedded-svg');
  if (inlineSvg && inlineSvg.textContent.trim()) {
    html += inlineSvg.textContent;
  } else if (withDeps.length === 0) {
    html += '<div class="graph-fallback"><p>No dependency information available.</p></div>';
  } else {
    html += `<div class="graph-fallback"><p>Run <code>python -m tools.generate_graph</code> to render SVG.</p><pre>${dot.replace(/\\n/g,'\n')}</pre></div>`;
  }
  html += '</div></div>';
  view.innerHTML = html;
}

/* ── DEFERRED ── */
function renderDeferred() {
  const view = document.getElementById('deferred-view');
  const deferred = tasks.filter(t => t.status === 'deferred');
  let html = '<h2 class="section-h">Deferred Tasks</h2>';
  if (deferred.length === 0) {
    html += '<div class="empty">No deferred tasks</div>';
  } else {
    deferred.forEach(t => {
      let meta = '';
      if (t.layer)      meta += `<span class="badge layer">${t.layer}</span>`;
      if (t.risk_level) meta += `<span class="badge risk-${t.risk_level}">${t.risk_level}</span>`;
      html += `<div class="deferred-card" data-id="${esc(t.id)}">
        <div class="task-id">${esc(t.id)}</div>
        <div class="task-title">${esc(t.title)}</div>
        <div class="task-meta">${meta}</div>`;
      if (t.defer_trigger) {
        html += `<div class="trigger-info"><div class="trigger-label">Trigger Condition</div><div>${esc(t.defer_trigger)}</div></div>`;
      }
      if (t.description) {
        html += `<div style="margin-top:10px;font-size:12px;color:var(--text3)">${esc(t.description).substring(0,200)}</div>`;
      }
      html += '</div>';
    });
  }
  view.innerHTML = html;
  bindCardClicks(view);
}

/* ── MODAL ── */
function showModal(task) {
  document.getElementById('modal-id').textContent = task.id;
  document.getElementById('modal-title').textContent = task.title;
  const statusLabels = {pending:'Pending',in_progress:'In Progress',in_review:'In Review',done:'Done',deferred:'Deferred',failed:'Failed',terminated:'Terminated'};
  let body = '';
  if (task.description) body += `<div class="modal-section"><h4>Description</h4><p>${esc(task.description)}</p></div>`;
  body += `<div class="modal-section"><h4>Metadata</h4><div class="modal-kv">`;
  body += `<span class="k">Status</span><span class="v">${statusLabels[task.status]||task.status}</span>`;
  if (task.layer)     body += `<span class="k">Layer</span><span class="v">${task.layer}</span>`;
  if (task.type)      body += `<span class="k">Type</span><span class="v">${task.type}</span>`;
  if (task.risk_level)body += `<span class="k">Risk</span><span class="v">${task.risk_level}</span>`;
  if (task.specialist)body += `<span class="k">Specialist</span><span class="v">${task.specialist}</span>`;
  if (task.batch !== undefined) body += `<span class="k">Batch</span><span class="v">${task.batch}</span>`;
  body += `</div></div>`;
  if (task.defer_trigger) body += `<div class="modal-section"><h4>Trigger Condition</h4><p style="background:var(--orange-bg);border:1px solid rgba(251,146,60,.2);padding:10px 14px;font-size:12px">${esc(task.defer_trigger)}</p></div>`;
  const deps = task.dependencies || [];
  if (deps.length) body += `<div class="modal-section"><h4>Dependencies (${deps.length})</h4><ul>${deps.map(d=>`<li>${esc(d)}</li>`).join('')}</ul></div>`;
  const criteria = task.acceptance_criteria || [];
  if (criteria.length) body += `<div class="modal-section"><h4>Acceptance Criteria</h4><ul>${criteria.map(c=>`<li>${esc(c)}</li>`).join('')}</ul></div>`;
  const files = task.files_to_touch || [];
  if (files.length) body += `<div class="modal-section"><h4>Files</h4><ul>${files.map(f=>`<li><code>${esc(f)}</code></li>`).join('')}</ul></div>`;
  document.getElementById('modal-body').innerHTML = body;
  document.getElementById('modal-overlay').classList.add('active');
}
function closeModal() { document.getElementById('modal-overlay').classList.remove('active'); }
document.getElementById('modal-overlay').addEventListener('click', e => { if (e.target.id === 'modal-overlay') closeModal(); });
document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });

/* ── TABS ── */
function bindTabs() {
  document.querySelectorAll('.tab').forEach(tab => {
    tab.addEventListener('click', () => {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
      tab.classList.add('active');
      document.getElementById(tab.dataset.view + '-view').classList.add('active');
    });
  });
}

/* ── HELPERS ── */
function esc(s) { if (!s) return ''; const d = document.createElement('div'); d.textContent = s; return d.innerHTML; }
function bindCardClicks(container) {
  container.querySelectorAll('.task-card, .deferred-card').forEach(card => {
    card.addEventListener('click', () => {
      const task = tasks.find(t => t.id === card.dataset.id);
      if (task) showModal(task);
    });
  });
}

init();
</script>
<script>
/* ── BURNDOWN (separate block to keep main JS clean) ── */
function renderBurndown() {
  const view = document.getElementById('burndown-view');
  const bd = extra.burndown || {};
  const points = bd.burndown || [];
  const vel = bd.velocity || {};
  const fc = bd.forecast || {};

  let html = '<h2 class="section-h">Velocity & Burndown</h2>';

  // Velocity stats row
  html += '<div class="overview-grid">';
  html += `<div class="overview-card"><h3>Velocity</h3><div class="mono">
    <div style="margin-bottom:6px"><span style="color:var(--text3)">Tasks/week (${vel.window_weeks||4}w window):</span> <span style="color:var(--amber);font-size:18px">${vel.tasks_per_week||0}</span></div>
    <div style="margin-bottom:6px"><span style="color:var(--text3)">Completed in window:</span> <span style="color:var(--text)">${vel.completed_in_window||0}</span></div>
    <div><span style="color:var(--text3)">Total completed:</span> <span style="color:var(--green)">${vel.total_completed||0}</span> / ${vel.total_tasks||0}</div>
  </div></div>`;

  // Forecast card
  const onTrack = fc.on_track;
  const fcColor = onTrack ? 'var(--green)' : 'var(--red)';
  const fcLabel = onTrack ? 'ON TRACK' : 'BEHIND SCHEDULE';
  html += `<div class="overview-card"><h3>Forecast</h3><div class="mono">
    <div style="margin-bottom:6px"><span style="color:var(--text3)">Status:</span> <span style="color:${fcColor};font-size:14px;font-weight:500">${fcLabel}</span></div>
    <div style="margin-bottom:6px"><span style="color:var(--text3)">Forecast date:</span> <span style="color:var(--text)">${fc.forecast_date ? fc.forecast_date.split('T')[0] : 'N/A'}</span></div>
    <div style="margin-bottom:6px"><span style="color:var(--text3)">Deadline:</span> <span style="color:var(--text)">${fc.deadline||'N/A'}</span></div>
    <div><span style="color:var(--text3)">Tasks remaining:</span> <span style="color:var(--orange)">${fc.tasks_remaining||0}</span></div>
  </div></div>`;
  html += '</div>';

  // Burndown chart (CSS-only bar chart)
  if (points.length > 0) {
    const maxVal = Math.max(...points.map(p => Math.max(p.remaining, p.ideal)));
    html += '<div style="margin-top:24px"><h3 class="section-h">Burndown Chart</h3>';
    html += '<div style="display:flex;align-items:flex-end;gap:2px;height:200px;padding:16px 0;border-bottom:1px solid var(--border)">';
    points.forEach(p => {
      const rH = maxVal > 0 ? (p.remaining / maxVal * 160) : 0;
      const iH = maxVal > 0 ? (p.ideal / maxVal * 160) : 0;
      const w = Math.max(8, Math.floor(600 / points.length));
      html += `<div style="display:flex;flex-direction:column;align-items:center;gap:2px;flex:1;max-width:${w+20}px" title="Week ${p.week}: ${p.remaining} remaining (ideal: ${p.ideal})">
        <div style="display:flex;align-items:flex-end;gap:1px;height:164px">
          <div style="width:${w/2}px;height:${rH}px;background:var(--amber);opacity:.7;transition:height .3s"></div>
          <div style="width:${w/2}px;height:${iH}px;background:var(--border2);transition:height .3s"></div>
        </div>
        <div style="font-size:8px;color:var(--text3)">W${p.week}</div>
      </div>`;
    });
    html += '</div>';
    html += '<div style="display:flex;gap:16px;margin-top:8px;font-size:10px;color:var(--text3)">';
    html += '<span><span style="display:inline-block;width:10px;height:10px;background:var(--amber);opacity:.7;vertical-align:middle;margin-right:4px"></span>Actual remaining</span>';
    html += '<span><span style="display:inline-block;width:10px;height:10px;background:var(--border2);vertical-align:middle;margin-right:4px"></span>Ideal burndown</span>';
    html += '</div></div>';
  } else {
    html += '<div class="empty" style="margin-top:24px">No burndown data. Run <code>python -m tools.generate_burndown</code> to generate.</div>';
  }

  view.innerHTML = html;
}
if (typeof renderBurndown === 'function') renderBurndown();
</script>
<script type="text/plain" id="embedded-svg"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: Dependencies Pages: 1 -->
<svg width="2471pt" height="148pt"
 viewBox="0.00 0.00 2471.00 148.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 144)">
<title>Dependencies</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-144 2467,-144 2467,4 -4,4"/>
<text text-anchor="middle" x="1231.5" y="-7.8" font-family="Times,serif" font-size="14.00">qe&#45;dfpt&#45;migration Dependency Graph</text>
<!-- DFPT&#45;001 -->
<g id="node1" class="node">
<title>DFPT&#45;001</title>
<path fill="#3498db" stroke="black" d="M173,-113C173,-113 12,-113 12,-113 6,-113 0,-107 0,-101 0,-101 0,-89 0,-89 0,-83 6,-77 12,-77 12,-77 173,-77 173,-77 179,-77 185,-83 185,-89 185,-89 185,-101 185,-101 185,-107 179,-113 173,-113"/>
<text text-anchor="middle" x="92.5" y="-98.2" font-family="Times,serif" font-size="11.00">DFPT&#45;001</text>
<text text-anchor="middle" x="92.5" y="-86.2" font-family="Times,serif" font-size="11.00">设计 ABACUS DFPT 模块架构</text>
</g>
<!-- DFPT&#45;002 -->
<g id="node2" class="node">
<title>DFPT&#45;002</title>
<path fill="#3498db" stroke="black" d="M372.5,-140C372.5,-140 265.5,-140 265.5,-140 259.5,-140 253.5,-134 253.5,-128 253.5,-128 253.5,-116 253.5,-116 253.5,-110 259.5,-104 265.5,-104 265.5,-104 372.5,-104 372.5,-104 378.5,-104 384.5,-110 384.5,-116 384.5,-116 384.5,-128 384.5,-128 384.5,-134 378.5,-140 372.5,-140"/>
<text text-anchor="middle" x="319" y="-125.2" font-family="Times,serif" font-size="11.00">DFPT&#45;002</text>
<text text-anchor="middle" x="319" y="-113.2" font-family="Times,serif" font-size="11.00">建立代码审核工作流</text>
</g>
<!-- DFPT&#45;001&#45;&gt;DFPT&#45;002 -->
<g id="edge1" class="edge">
<title>DFPT&#45;001&#45;&gt;DFPT&#45;002</title>
<path fill="none" stroke="black" d="M185.14,-106.02C204.47,-108.35 224.65,-110.77 243.27,-113.01"/>
<polygon fill="black" stroke="black" points="243.1,-116.52 253.44,-114.24 243.93,-109.57 243.1,-116.52"/>
</g>
<!-- DFPT&#45;003 -->
<g id="node3" class="node">
<title>DFPT&#45;003</title>
<path fill="#3498db" stroke="black" d="M405,-86C405,-86 233,-86 233,-86 227,-86 221,-80 221,-74 221,-74 221,-62 221,-62 221,-56 227,-50 233,-50 233,-50 405,-50 405,-50 411,-50 417,-56 417,-62 417,-62 417,-74 417,-74 417,-80 411,-86 405,-86"/>
<text text-anchor="middle" x="319" y="-71.2" font-family="Times,serif" font-size="11.00">DFPT&#45;003</text>
<text text-anchor="middle" x="319" y="-59.2" font-family="Times,serif" font-size="11.00">创建 DFPT 模块骨架和构建系统</text>
</g>
<!-- DFPT&#45;001&#45;&gt;DFPT&#45;003 -->
<g id="edge2" class="edge">
<title>DFPT&#45;001&#45;&gt;DFPT&#45;003</title>
<path fill="none" stroke="black" d="M185.14,-83.98C193.59,-82.96 202.2,-81.93 210.78,-80.9"/>
<polygon fill="black" stroke="black" points="211.31,-84.36 220.82,-79.69 210.47,-77.41 211.31,-84.36"/>
</g>
<!-- DFPT&#45;101 -->
<g id="node4" class="node">
<title>DFPT&#45;101</title>
<path fill="#3498db" stroke="black" d="M572,-86C572,-86 465,-86 465,-86 459,-86 453,-80 453,-74 453,-74 453,-62 453,-62 453,-56 459,-50 465,-50 465,-50 572,-50 572,-50 578,-50 584,-56 584,-62 584,-62 584,-74 584,-74 584,-80 578,-86 572,-86"/>
<text text-anchor="middle" x="518.5" y="-71.2" font-family="Times,serif" font-size="11.00">DFPT&#45;101</text>
<text text-anchor="middle" x="518.5" y="-59.2" font-family="Times,serif" font-size="11.00">迁移数据结构适配层</text>
</g>
<!-- DFPT&#45;003&#45;&gt;DFPT&#45;101 -->
<g id="edge3" class="edge">
<title>DFPT&#45;003&#45;&gt;DFPT&#45;101</title>
<path fill="none" stroke="black" d="M417.01,-68C425.68,-68 434.37,-68 442.81,-68"/>
<polygon fill="black" stroke="black" points="442.96,-71.5 452.96,-68 442.96,-64.5 442.96,-71.5"/>
</g>
<!-- DFPT&#45;102 -->
<g id="node5" class="node">
<title>DFPT&#45;102</title>
<path fill="#3498db" stroke="black" d="M782,-86C782,-86 632,-86 632,-86 626,-86 620,-80 620,-74 620,-74 620,-62 620,-62 620,-56 626,-50 632,-50 632,-50 782,-50 782,-50 788,-50 794,-56 794,-62 794,-62 794,-74 794,-74 794,-80 788,-86 782,-86"/>
<text text-anchor="middle" x="707" y="-71.2" font-family="Times,serif" font-size="11.00">DFPT&#45;102</text>
<text text-anchor="middle" x="707" y="-59.2" font-family="Times,serif" font-size="11.00">迁移 DVQPsiUS 核心 kernel</text>
</g>
<!-- DFPT&#45;101&#45;&gt;DFPT&#45;102 -->
<g id="edge4" class="edge">
<title>DFPT&#45;101&#45;&gt;DFPT&#45;102</title>
<path fill="none" stroke="black" d="M584.21,-68C592.45,-68 601.02,-68 609.63,-68"/>
<polygon fill="black" stroke="black" points="609.73,-71.5 619.73,-68 609.73,-64.5 609.73,-71.5"/>
</g>
<!-- DFPT&#45;103 -->
<g id="node6" class="node">
<title>DFPT&#45;103</title>
<path fill="#3498db" stroke="black" d="M976,-86C976,-86 842,-86 842,-86 836,-86 830,-80 830,-74 830,-74 830,-62 830,-62 830,-56 836,-50 842,-50 842,-50 976,-50 976,-50 982,-50 988,-56 988,-62 988,-62 988,-74 988,-74 988,-80 982,-86 976,-86"/>
<text text-anchor="middle" x="909" y="-71.2" font-family="Times,serif" font-size="11.00">DFPT&#45;103</text>
<text text-anchor="middle" x="909" y="-59.2" font-family="Times,serif" font-size="11.00">迁移 Sternheimer 求解器</text>
</g>
<!-- DFPT&#45;102&#45;&gt;DFPT&#45;103 -->
<g id="edge5" class="edge">
<title>DFPT&#45;102&#45;&gt;DFPT&#45;103</title>
<path fill="none" stroke="black" d="M794.27,-68C802.69,-68 811.24,-68 819.68,-68"/>
<polygon fill="black" stroke="black" points="819.9,-71.5 829.9,-68 819.9,-64.5 819.9,-71.5"/>
</g>
<!-- DFPT&#45;201 -->
<g id="node7" class="node">
<title>DFPT&#45;201</title>
<path fill="#3498db" stroke="black" d="M1157,-86C1157,-86 1036,-86 1036,-86 1030,-86 1024,-80 1024,-74 1024,-74 1024,-62 1024,-62 1024,-56 1030,-50 1036,-50 1036,-50 1157,-50 1157,-50 1163,-50 1169,-56 1169,-62 1169,-62 1169,-74 1169,-74 1169,-80 1163,-86 1157,-86"/>
<text text-anchor="middle" x="1096.5" y="-71.2" font-family="Times,serif" font-size="11.00">DFPT&#45;201</text>
<text text-anchor="middle" x="1096.5" y="-59.2" font-family="Times,serif" font-size="11.00">实现 DFPT 自洽场迭代</text>
</g>
<!-- DFPT&#45;103&#45;&gt;DFPT&#45;201 -->
<g id="edge6" class="edge">
<title>DFPT&#45;103&#45;&gt;DFPT&#45;201</title>
<path fill="none" stroke="black" d="M988.13,-68C996.58,-68 1005.19,-68 1013.68,-68"/>
<polygon fill="black" stroke="black" points="1013.96,-71.5 1023.96,-68 1013.95,-64.5 1013.96,-71.5"/>
</g>
<!-- DFPT&#45;202 -->
<g id="node8" class="node">
<title>DFPT&#45;202</title>
<path fill="#3498db" stroke="black" d="M1324,-86C1324,-86 1217,-86 1217,-86 1211,-86 1205,-80 1205,-74 1205,-74 1205,-62 1205,-62 1205,-56 1211,-50 1217,-50 1217,-50 1324,-50 1324,-50 1330,-50 1336,-56 1336,-62 1336,-62 1336,-74 1336,-74 1336,-80 1330,-86 1324,-86"/>
<text text-anchor="middle" x="1270.5" y="-71.2" font-family="Times,serif" font-size="11.00">DFPT&#45;202</text>
<text text-anchor="middle" x="1270.5" y="-59.2" font-family="Times,serif" font-size="11.00">实现动力学矩阵计算</text>
</g>
<!-- DFPT&#45;201&#45;&gt;DFPT&#45;202 -->
<g id="edge7" class="edge">
<title>DFPT&#45;201&#45;&gt;DFPT&#45;202</title>
<path fill="none" stroke="black" d="M1169.45,-68C1177.82,-68 1186.38,-68 1194.8,-68"/>
<polygon fill="black" stroke="black" points="1194.96,-71.5 1204.96,-68 1194.96,-64.5 1194.96,-71.5"/>
</g>
<!-- DFPT&#45;203 -->
<g id="node9" class="node">
<title>DFPT&#45;203</title>
<path fill="#3498db" stroke="black" d="M1479,-86C1479,-86 1384,-86 1384,-86 1378,-86 1372,-80 1372,-74 1372,-74 1372,-62 1372,-62 1372,-56 1378,-50 1384,-50 1384,-50 1479,-50 1479,-50 1485,-50 1491,-56 1491,-62 1491,-62 1491,-74 1491,-74 1491,-80 1485,-86 1479,-86"/>
<text text-anchor="middle" x="1431.5" y="-71.2" font-family="Times,serif" font-size="11.00">DFPT&#45;203</text>
<text text-anchor="middle" x="1431.5" y="-59.2" font-family="Times,serif" font-size="11.00">实现电声耦合计算</text>
</g>
<!-- DFPT&#45;202&#45;&gt;DFPT&#45;203 -->
<g id="edge8" class="edge">
<title>DFPT&#45;202&#45;&gt;DFPT&#45;203</title>
<path fill="none" stroke="black" d="M1336.17,-68C1344.55,-68 1353.15,-68 1361.59,-68"/>
<polygon fill="black" stroke="black" points="1361.77,-71.5 1371.77,-68 1361.77,-64.5 1361.77,-71.5"/>
</g>
<!-- DFPT&#45;301 -->
<g id="node10" class="node">
<title>DFPT&#45;301</title>
<path fill="#3498db" stroke="black" d="M1626,-86C1626,-86 1539,-86 1539,-86 1533,-86 1527,-80 1527,-74 1527,-74 1527,-62 1527,-62 1527,-56 1533,-50 1539,-50 1539,-50 1626,-50 1626,-50 1632,-50 1638,-56 1638,-62 1638,-62 1638,-74 1638,-74 1638,-80 1632,-86 1626,-86"/>
<text text-anchor="middle" x="1582.5" y="-71.2" font-family="Times,serif" font-size="11.00">DFPT&#45;301</text>
<text text-anchor="middle" x="1582.5" y="-59.2" font-family="Times,serif" font-size="11.00">实现 MPI 并行化</text>
</g>
<!-- DFPT&#45;203&#45;&gt;DFPT&#45;301 -->
<g id="edge9" class="edge">
<title>DFPT&#45;203&#45;&gt;DFPT&#45;301</title>
<path fill="none" stroke="black" d="M1491.39,-68C1499.72,-68 1508.32,-68 1516.75,-68"/>
<polygon fill="black" stroke="black" points="1516.92,-71.5 1526.92,-68 1516.92,-64.5 1516.92,-71.5"/>
</g>
<!-- DFPT&#45;302 -->
<g id="node11" class="node">
<title>DFPT&#45;302</title>
<path fill="#3498db" stroke="black" d="M1793,-86C1793,-86 1686,-86 1686,-86 1680,-86 1674,-80 1674,-74 1674,-74 1674,-62 1674,-62 1674,-56 1680,-50 1686,-50 1686,-50 1793,-50 1793,-50 1799,-50 1805,-56 1805,-62 1805,-62 1805,-74 1805,-74 1805,-80 1799,-86 1793,-86"/>
<text text-anchor="middle" x="1739.5" y="-71.2" font-family="Times,serif" font-size="11.00">DFPT&#45;302</text>
<text text-anchor="middle" x="1739.5" y="-59.2" font-family="Times,serif" font-size="11.00">性能优化和基准测试</text>
</g>
<!-- DFPT&#45;301&#45;&gt;DFPT&#45;302 -->
<g id="edge10" class="edge">
<title>DFPT&#45;301&#45;&gt;DFPT&#45;302</title>
<path fill="none" stroke="black" d="M1638.15,-68C1646.48,-68 1655.2,-68 1663.87,-68"/>
<polygon fill="black" stroke="black" points="1664,-71.5 1674,-68 1664,-64.5 1664,-71.5"/>
</g>
<!-- DFPT&#45;401 -->
<g id="node12" class="node">
<title>DFPT&#45;401</title>
<path fill="#3498db" stroke="black" d="M1972,-86C1972,-86 1853,-86 1853,-86 1847,-86 1841,-80 1841,-74 1841,-74 1841,-62 1841,-62 1841,-56 1847,-50 1853,-50 1853,-50 1972,-50 1972,-50 1978,-50 1984,-56 1984,-62 1984,-62 1984,-74 1984,-74 1984,-80 1978,-86 1972,-86"/>
<text text-anchor="middle" x="1912.5" y="-71.2" font-family="Times,serif" font-size="11.00">DFPT&#45;401</text>
<text text-anchor="middle" x="1912.5" y="-59.2" font-family="Times,serif" font-size="11.00">创建 ESolver_DFPT 类</text>
</g>
<!-- DFPT&#45;302&#45;&gt;DFPT&#45;401 -->
<g id="edge11" class="edge">
<title>DFPT&#45;302&#45;&gt;DFPT&#45;401</title>
<path fill="none" stroke="black" d="M1805.15,-68C1813.51,-68 1822.15,-68 1830.73,-68"/>
<polygon fill="black" stroke="black" points="1830.76,-71.5 1840.76,-68 1830.76,-64.5 1830.76,-71.5"/>
</g>
<!-- DFPT&#45;402 -->
<g id="node13" class="node">
<title>DFPT&#45;402</title>
<path fill="#3498db" stroke="black" d="M2154,-86C2154,-86 2032,-86 2032,-86 2026,-86 2020,-80 2020,-74 2020,-74 2020,-62 2020,-62 2020,-56 2026,-50 2032,-50 2032,-50 2154,-50 2154,-50 2160,-50 2166,-56 2166,-62 2166,-62 2166,-74 2166,-74 2166,-80 2160,-86 2154,-86"/>
<text text-anchor="middle" x="2093" y="-71.2" font-family="Times,serif" font-size="11.00">DFPT&#45;402</text>
<text text-anchor="middle" x="2093" y="-59.2" font-family="Times,serif" font-size="11.00">实现 q 点网格和工作流</text>
</g>
<!-- DFPT&#45;401&#45;&gt;DFPT&#45;402 -->
<g id="edge12" class="edge">
<title>DFPT&#45;401&#45;&gt;DFPT&#45;402</title>
<path fill="none" stroke="black" d="M1984.05,-68C1992.52,-68 2001.23,-68 2009.86,-68"/>
<polygon fill="black" stroke="black" points="2009.92,-71.5 2019.92,-68 2009.92,-64.5 2009.92,-71.5"/>
</g>
<!-- DFPT&#45;501 -->
<g id="node14" class="node">
<title>DFPT&#45;501</title>
<path fill="#3498db" stroke="black" d="M2309,-86C2309,-86 2214,-86 2214,-86 2208,-86 2202,-80 2202,-74 2202,-74 2202,-62 2202,-62 2202,-56 2208,-50 2214,-50 2214,-50 2309,-50 2309,-50 2315,-50 2321,-56 2321,-62 2321,-62 2321,-74 2321,-74 2321,-80 2315,-86 2309,-86"/>
<text text-anchor="middle" x="2261.5" y="-71.2" font-family="Times,serif" font-size="11.00">DFPT&#45;501</text>
<text text-anchor="middle" x="2261.5" y="-59.2" font-family="Times,serif" font-size="11.00">创建集成测试套件</text>
</g>
<!-- DFPT&#45;402&#45;&gt;DFPT&#45;501 -->
<g id="edge13" class="edge">
<title>DFPT&#45;402&#45;&gt;DFPT&#45;501</title>
<path fill="none" stroke="black" d="M2166.06,-68C2174.56,-68 2183.21,-68 2191.67,-68"/>
<polygon fill="black" stroke="black" points="2191.85,-71.5 2201.85,-68 2191.85,-64.5 2191.85,-71.5"/>
</g>
<!-- DFPT&#45;502 -->
<g id="node15" class="node">
<title>DFPT&#45;502</title>
<path fill="#3498db" stroke="black" d="M2444.5,-113C2444.5,-113 2375.5,-113 2375.5,-113 2369.5,-113 2363.5,-107 2363.5,-101 2363.5,-101 2363.5,-89 2363.5,-89 2363.5,-83 2369.5,-77 2375.5,-77 2375.5,-77 2444.5,-77 2444.5,-77 2450.5,-77 2456.5,-83 2456.5,-89 2456.5,-89 2456.5,-101 2456.5,-101 2456.5,-107 2450.5,-113 2444.5,-113"/>
<text text-anchor="middle" x="2410" y="-98.2" font-family="Times,serif" font-size="11.00">DFPT&#45;502</text>
<text text-anchor="middle" x="2410" y="-86.2" font-family="Times,serif" font-size="11.00">编写用户文档</text>
</g>
<!-- DFPT&#45;501&#45;&gt;DFPT&#45;502 -->
<g id="edge14" class="edge">
<title>DFPT&#45;501&#45;&gt;DFPT&#45;502</title>
<path fill="none" stroke="black" d="M2321.24,-78.83C2331.86,-80.78 2342.9,-82.82 2353.42,-84.76"/>
<polygon fill="black" stroke="black" points="2352.86,-88.21 2363.32,-86.58 2354.12,-81.33 2352.86,-88.21"/>
</g>
<!-- DFPT&#45;503 -->
<g id="node16" class="node">
<title>DFPT&#45;503</title>
<path fill="#3498db" stroke="black" d="M2451,-59C2451,-59 2369,-59 2369,-59 2363,-59 2357,-53 2357,-47 2357,-47 2357,-35 2357,-35 2357,-29 2363,-23 2369,-23 2369,-23 2451,-23 2451,-23 2457,-23 2463,-29 2463,-35 2463,-35 2463,-47 2463,-47 2463,-53 2457,-59 2451,-59"/>
<text text-anchor="middle" x="2410" y="-44.2" font-family="Times,serif" font-size="11.00">DFPT&#45;503</text>
<text text-anchor="middle" x="2410" y="-32.2" font-family="Times,serif" font-size="11.00">编写开发者文档</text>
</g>
<!-- DFPT&#45;501&#45;&gt;DFPT&#45;503 -->
<g id="edge15" class="edge">
<title>DFPT&#45;501&#45;&gt;DFPT&#45;503</title>
<path fill="none" stroke="black" d="M2321.24,-57.17C2329.71,-55.61 2338.45,-54 2346.98,-52.43"/>
<polygon fill="black" stroke="black" points="2347.67,-55.86 2356.87,-50.61 2346.4,-48.98 2347.67,-55.86"/>
</g>
</g>
</svg>
</script>
</body>
</html>