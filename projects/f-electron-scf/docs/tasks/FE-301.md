# FE-301: 选择 2-3 个代表性验证体系

## Objective

基于用户需求，选择2-3个代表性体系作为验证目标，必须覆盖：简单氧化物基线、磁序、一个应用场景。每个体系有明确的参考数据来源。

## Reference Code

### DFT+U 能力评估

**`/root/abacus-develop/source/source_lcao/module_dftu/dftu.h`** (354 行) — DFT+U 核心接口
- 确认各候选体系所需的 DFT+U 功能是否已实现
- `cal_energy_correction()`: 能量修正计算
- `cal_force_correction()`: 力修正计算

**`/root/abacus-develop/source/source_lcao/module_dftu/dftu_pw.cpp`** (219 行) — PW 基组 DFT+U
- 评估候选体系是否需要 PW 基组（大体系可能需要）

### 结构与赝势兼容性

**`/root/abacus-develop/source/source_cell/unitcell.h`** (265 行) — UnitCell 类
- `read_atom_species()`: 原子种类读取
- `read_atom_positions()`: 原子位置读取
- 确认候选体系的结构能被正确解析

**`/root/abacus-develop/source/source_cell/read_pp.h`** (130 行) — 赝势读取
- `read_pp_upf()`: UPF 格式赝势
- `read_pp_vwr()`: VWR 格式赝势
- 确认候选体系所需元素的赝势可用性（Ce, Gd, Nd, La 等稀土元素）

### 输入参数

**`/root/abacus-develop/source/source_io/module_parameter/input_parameter.h`** (704 行) — 输入参数定义
- 确认候选体系所需的计算参数（nspin, dft_plus_u, hubbard_u 等）均有对应输入接口

## Implementation Guide

### 体系选择标准

选择验证体系需满足以下约束：

1. **物理覆盖性**
   - 简单氧化物基线（CeO2）：萤石结构，f 电子局域化，有大量参考数据
   - 磁性体系（GdN 或 NdFeB）：需要自旋极化，测试磁矩精度
   - 应用场景体系：来自 FE-300 用户调研的实际需求

2. **技术可行性检查**（每个候选体系需确认）
   - ABACUS 赝势库中是否有对应元素的赝势
   - 单胞原子数是否在合理范围（<100 原子）
   - 所需功能（DFT+U, SOC, 非共线磁性等）是否已实现

3. **参考数据来源**（每个体系至少一个）
   - 实验数据：晶格常数、带隙、磁矩
   - VASP PAW 计算：作为赝势方法的对照
   - 全电子计算（FHI-aims/Elk）：作为绝对参考

4. **推荐组合方案**

| 方案 | 体系1（基线） | 体系2（磁性） | 体系3（应用） |
|------|---------------|---------------|---------------|
| A    | CeO2          | GdN           | CeO2(111) 表面催化 |
| B    | CeO2          | NdFeB         | 稀土 MOF |
| C    | CeO2 + La2O3  | GdN           | 由用户调研决定 |

### 输出格式

`validation_systems.json` 结构：
```json
[
  {
    "name": "CeO2",
    "category": "oxide",
    "space_group": "Fm-3m",
    "n_atoms": 3,
    "reference_data": {
      "source": "experiment + VASP",
      "lattice_constant_A": 5.411,
      "band_gap_eV": 3.0,
      "bulk_modulus_GPa": 220
    },
    "abacus_feasibility": "high",
    "pseudopotential_available": true
  }
]
```

### 关键注意事项

- GdN 的 Gd 4f 电子高度局域化（~7 μB），是 DFT+U 精度的严格测试
- NdFeB 单胞 56 原子，计算量较大，需评估是否在合理时间内完成
- 表面体系需要真空层，原子数可能较多，需权衡

## TDD Test Plan

### Tests to Write FIRST

```python
import json

def test_validation_systems_selected():
    """验证已选择至少2个体系，覆盖氧化物和磁性"""
    with open("projects/f-electron-scf/validation_systems.json") as f:
        systems = json.load(f)
    assert len(systems) >= 2
    categories = [s.get("category") for s in systems]
    assert "oxide" in categories or "氧化物" in categories
    assert "magnetic" in categories or "磁性" in categories

def test_each_system_has_reference():
    """验证每个体系有参考数据来源"""
    with open("projects/f-electron-scf/validation_systems.json") as f:
        systems = json.load(f)
    for s in systems:
        assert "reference_data" in s, f"{s['name']}: missing reference_data"
        assert "source" in s["reference_data"]

def test_each_system_has_feasibility():
    """验证每个体系有 ABACUS 可行性评估"""
    with open("projects/f-electron-scf/validation_systems.json") as f:
        systems = json.load(f)
    for s in systems:
        assert "abacus_feasibility" in s, f"{s['name']}: missing feasibility"
        assert s["abacus_feasibility"] in ["high", "medium", "low"]

def test_each_system_has_pseudopotential_check():
    """验证每个体系已检查赝势可用性"""
    with open("projects/f-electron-scf/validation_systems.json") as f:
        systems = json.load(f)
    for s in systems:
        assert "pseudopotential_available" in s, f"{s['name']}: missing PP check"
```

## Acceptance Criteria

- [ ] 选择标准：覆盖关键物理（f电子、磁性、化学环境）
- [ ] 示例组合：CeO2（基线）+ GdN（磁性）+ CeO2(111)表面（催化）
- [ ] 或：CeO2 + NdFeB（合金磁性）+ 稀土MOF（分子）
- [ ] 每个体系有明确的参考数据来源
