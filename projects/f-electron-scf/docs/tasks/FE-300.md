# FE-300: 用户需求调研

## Objective

调研实际用户的稀土计算需求，收集3-5个具体体系和性质要求，识别真实痛点。覆盖不同应用场景（氧化物/合金/催化等）。

## Reference Code

### 现有 DFT+U 能力与限制

**`/root/abacus-develop/source/source_lcao/module_dftu/dftu.h`** (354 行) — 当前 DFT+U 实现的核心头文件
- `DFTU` 类：定义了 Hubbard U/J 参数、占据矩阵、能量修正等接口
- 当前支持 LCAO 基组下的 DFT+U，PW 基组支持有限
- 用户痛点参考：哪些功能已实现、哪些缺失

**`/root/abacus-develop/source/source_lcao/module_dftu/dftu_pw.cpp`** (219 行) — PW 基组 DFT+U 实现
- PW 基组下的 DFT+U 功能较 LCAO 更受限
- 用户如需 PW+U 计算可能遇到功能缺失

**`/root/abacus-develop/source/source_io/module_parameter/input_parameter.h`** (704 行) — 所有可用输入参数定义
- DFT+U 相关参数：`dft_plus_u`, `hubbard_u`, `hubbard_j`, `orbital_corr`
- 用户可配置的收敛参数：`scf_nmax`, `scf_thr`, `mixing_beta`
- 调研时需对照此文件确认用户需求是否已有对应参数支持

### 输出文件

**`projects/f-electron-scf/user_requirements.md`** — 需求调研报告（本任务产出）
**`projects/f-electron-scf/user_requirements.json`** — 结构化需求数据（本任务产出）

## Implementation Guide

### 调研方法论

本任务为调研任务，不涉及代码开发。核心工作流程：

1. **目标用户群体识别**
   - 催化方向：CeO2 基催化剂、稀土掺杂氧化物
   - 磁性材料：NdFeB 永磁体、GdN 自旋电子学
   - 核材料：UO2 燃料、PuO2 储存
   - 光学材料：稀土掺杂荧光体、Nd:YAG 激光

2. **调研模板设计**
   - 体系信息：化学式、空间群、原子数、元素种类
   - 目标性质：晶格常数、带隙、磁矩、形成能、声子谱
   - 计算方法：PBE/PBE+U/HSE/SOC 需求
   - 当前痛点：收敛困难、精度不足、功能缺失、性能瓶颈

3. **痛点分类体系**
   - 收敛类：f 电子 SCF 不收敛、磁性体系振荡
   - 精度类：与实验/VASP 偏差过大、赝势不足
   - 可用性类：参数设置复杂、文档不足、错误信息不明确
   - 性能类：大体系计算时间过长、内存不足

4. **输出格式**
   - `user_requirements.json`：结构化 JSON，包含 `systems` 数组（每个体系含 `name`, `formula`, `space_group`, `target_properties`, `pain_points`, `priority`）
   - `user_requirements.md`：叙述性 Markdown 报告，含用户背景、需求汇总、痛点分析、优先级建议

### 关键注意事项

- 需求必须具体到可验证的体系和性质，避免泛泛而谈
- 每个痛点需关联到 ABACUS 代码中的具体模块（参考 Reference Code 中的文件）
- 优先级排序应考虑：用户数量、科学影响力、技术可行性

## TDD Test Plan

### Tests to Write FIRST

```python
import os
import json

def test_requirements_doc_exists():
    """验证需求文档已生成"""
    assert os.path.exists("projects/f-electron-scf/user_requirements.md")

def test_requirements_cover_scenarios():
    """验证需求覆盖多个应用场景"""
    with open("projects/f-electron-scf/user_requirements.md") as f:
        content = f.read()
    scenarios = ["氧化物", "合金", "催化"]
    covered = sum(1 for s in scenarios if s in content)
    assert covered >= 2, f"Only {covered}/3 scenarios covered"

def test_requirements_have_systems():
    """验证结构化数据包含至少3个体系"""
    with open("projects/f-electron-scf/user_requirements.json") as f:
        reqs = json.load(f)
    assert len(reqs.get("systems", [])) >= 3

def test_each_system_has_required_fields():
    """验证每个体系包含必要字段"""
    with open("projects/f-electron-scf/user_requirements.json") as f:
        reqs = json.load(f)
    required_fields = ["name", "formula", "target_properties", "pain_points"]
    for system in reqs["systems"]:
        for field in required_fields:
            assert field in system, f"{system.get('name', 'unknown')}: missing {field}"

def test_pain_points_categorized():
    """验证痛点已分类"""
    with open("projects/f-electron-scf/user_requirements.json") as f:
        reqs = json.load(f)
    valid_categories = {"convergence", "accuracy", "usability", "performance"}
    for system in reqs["systems"]:
        for pp in system.get("pain_points", []):
            assert pp.get("category") in valid_categories, \
                f"{system['name']}: pain point category '{pp.get('category')}' invalid"
```

## Acceptance Criteria

- [ ] 收集至少3个实际研究项目的计算需求
- [ ] 记录：元素、结构、目标性质、当前痛点
- [ ] 覆盖不同应用场景（氧化物/合金/催化等）
- [ ] 形成需求文档
