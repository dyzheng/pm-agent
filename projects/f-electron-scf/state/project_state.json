{
  "request": "ABACUS 稀土 DFT+U 计算能力完善（工程项目）。完成代码迁移、收敛策略实现、验证与基础自动化。诚实定位为工程追赶，不标 frontier。",
  "project_id": "f-electron-scf",
  "phase": "execute",
  "parsed_intent": {
    "domain": "rare-earth DFT+U convergence",
    "method": "SCF algorithm improvements + pseudopotential optimization",
    "validation": "VASP and all-electron cross-validation",
    "keywords": [
      "f_in_valence",
      "norm-conserving pseudopotential",
      "SCF convergence",
      "DFT+U",
      "orbital optimization",
      "AI-guided initial guess",
      "constrained DFT",
      "rare-earth elements"
    ]
  },
  "metadata": {
    "created": "2026-02-11T12:00:00Z",
    "last_updated": "2026-02-16T23:34:34Z",
    "brainstorm_applied": "2026-02-11T15:30:00Z",
    "unified_task_system": "2026-02-13T00:00:00Z",
    "strategy": "engineering catch-up with pseudopotential pre-validation",
    "timeline": "14 weeks (3.5 months)",
    "id_scheme": "FE-{phase}{seq}, FE-D-{category}{seq} for deferred",
    "milestones": {
      "M0": "Week 2 - 基础验证完成（赝势前置验证 + 回归测试基线）",
      "M1": "Week 6 - 代码迁移完成（DFT+U PW/LCAO + DeltaSpin）",
      "M2": "Week 10 - 收敛策略可用（SCF 收敛率 >80%）",
      "M3": "Week 14 - 验证与交付（ABACUS vs VASP <3% + 全电子参考 + 自动化）"
    },
    "statistics": {
      "total_tasks": 43,
      "active_tasks": 35,
      "terminated_tasks": 8,
      "in_review": 1,
      "in_progress": 0,
      "done": 0,
      "pending": 34
    },
    "phases": {
      "Phase 0 (基础验证)": [
        "FE-000",
        "FE-005",
        "FE-002"
      ],
      "Phase 1 (代码移植)": [
        "FE-100",
        "FE-101",
        "FE-102",
        "FE-103",
        "FE-104",
        "FE-105",
        "FE-106",
        "FE-107",
        "FE-108",
        "FE-109",
        "FE-110",
        "FE-111",
        "FE-112",
        "FE-113"
      ],
      "Phase 2 (SCF算法)": [
        "FE-200",
        "FE-201",
        "FE-202",
        "FE-204",
        "FE-205"
      ],
      "Phase 3 (验证)": [
        "FE-300",
        "FE-301",
        "FE-302",
        "FE-303",
        "FE-304",
        "FE-305",
        "FE-306"
      ],
      "Phase 4 (自动化-精简)": [
        "FE-400",
        "FE-402"
      ]
    },
    "critical_path": "FE-000 → FE-005 → FE-100 → FE-101 → FE-105 → FE-200 → FE-204 → FE-205 → FE-302 → FE-306 → FE-304 → FE-400",
    "parallel_opportunities": [
      "FE-000 || FE-001 || FE-002 (Phase 0 全部可并行)",
      "FE-100 || FE-107 (onsite_projector 与 deltaspin 可并行)",
      "FE-200 || FE-201 || FE-202 (Phase 2 前三个可并行)",
      "FE-300 || FE-301 (用户调研可提前启动)"
    ],
    "execution_timeline": {
      "Week 1": "FE-100(补测试) + FE-107 [可并行]",
      "Week 2": "FE-101 (DFT+U PW nspin=4 SCF)",
      "Week 3": "FE-102 + FE-103 [可并行]",
      "Week 4": "FE-104 + FE-105 [可并行]",
      "Week 5": "FE-108 + FE-109 [可并行]",
      "Week 6": "FE-110 + FE-111",
      "Week 7": "FE-106 + FE-112 + FE-113",
      "Week 8-10": "Phase 2 (FE-200~205)",
      "Week 11-14": "Phase 3 (FE-300~305)",
      "Week 15-20": "Phase 4 (FE-400~404)"
    },
    "restructured": "2026-02-16T23:34:34Z",
    "restructure_reason": "批判性评审发现70%工作为工程追赶，拆分为工程+研究两个项目"
  },
  "tasks": [
    {
      "id": "FE-D-C1",
      "title": "AI 训练数据收集",
      "layer": "workflow",
      "type": "data",
      "scope": "cross_code",
      "status": "terminated",
      "dependencies": [],
      "blocks": [],
      "description": "[TERMINATED] 从验证计算中收集训练数据：(1) 结构信息（元素、坐标、晶格），(2) 收敛后的占据矩阵，(3) f 电子数、自旋态、轨道序，(4) SCF 收敛路径信息。目标：至少 500 个不同结构的数据点。\n\n终止原因：见 plans/2026-02-16-critical-review.md",
      "acceptance_criteria": [
        "收集 100+ 个收敛的稀土体系计算",
        "记录：结构、元素、占据矩阵、能量",
        "覆盖不同氧化态、配位环境、磁序",
        "数据清洗和标准化"
      ],
      "files_to_touch": [
        "ml_models/training_data/",
        "ml_models/training_data/dataset.json"
      ],
      "estimated_effort": "2-3 weeks",
      "specialist": "workflow",
      "risk_level": "high",
      "defer_trigger": "FE-202:failure_rate_above_20pct",
      "old_ids": [
        "D-C1",
        "FE-300(旧)"
      ],
      "spec_doc": "docs/tasks/FE-D-C1.md"
    },
    {
      "id": "FE-D-C2",
      "title": "GNN 占据矩阵模型训练",
      "layer": "algorithm",
      "type": "new",
      "scope": "local",
      "status": "terminated",
      "dependencies": [
        "FE-D-C1"
      ],
      "blocks": [],
      "description": "[TERMINATED] 训练轻量级模型预测初始占据矩阵：(1) 输入特征：原子类型、近邻环境、氧化态估计，(2) 输出：每个稀土原子的 f 电子占据数和轨道序，(3) 先尝试 MLP/随机森林，再考虑 GNN。\n\n终止原因：见 plans/2026-02-16-critical-review.md",
      "acceptance_criteria": [
        "设计 GNN 架构（结构→占据矩阵）",
        "训练/验证/测试集划分",
        "模型精度：占据数预测误差<0.5 电子",
        "推理速度<1 秒/结构"
      ],
      "files_to_touch": [
        "ml_models/occupation_predictor/",
        "ml_models/occupation_predictor/model.py",
        "ml_models/occupation_predictor/train.py"
      ],
      "estimated_effort": "3-4 weeks",
      "specialist": "workflow",
      "risk_level": "high",
      "defer_trigger": "FE-D-C1:completed",
      "old_ids": [
        "D-C2",
        "FE-301(旧)"
      ],
      "spec_doc": "docs/tasks/FE-D-C2.md"
    },
    {
      "id": "FE-D-C3",
      "title": "ABACUS ML 集成",
      "layer": "infra",
      "type": "new",
      "scope": "abacus",
      "status": "terminated",
      "dependencies": [
        "FE-D-C2"
      ],
      "blocks": [],
      "description": "[TERMINATED] 将训练好的模型集成到 ABACUS 工作流：(1) Python 脚本：读取 STRU 文件→模型预测→生成 initial_onsite.dm，(2) 或通过 PyABACUS 接口直接注入，(3) 新增 init_chg='ai' 选项（长期目标）。\n\n终止原因：见 plans/2026-02-16-critical-review.md",
      "acceptance_criteria": [
        "模型推理接口集成到 ABACUS",
        "添加 init_chg=ml 选项",
        "自动从结构预测占据矩阵",
        "与现有 omc 模式兼容",
        "性能开销<5%"
      ],
      "files_to_touch": [
        "source/source_lcao/module_dftu/dftu_ml_init.cpp",
        "source/source_io/module_parameter/read_input_item_exx_dftu.cpp"
      ],
      "estimated_effort": "1-2 weeks",
      "specialist": "abacus-develop",
      "risk_level": "high",
      "defer_trigger": "FE-D-C2:completed",
      "old_ids": [
        "D-C3",
        "FE-302(旧)"
      ],
      "spec_doc": "docs/tasks/FE-D-C3.md"
    },
    {
      "id": "FE-000",
      "title": "赝势库调研与收集",
      "layer": "core",
      "type": "research",
      "scope": "external",
      "status": "pending",
      "dependencies": [],
      "blocks": [
        "FE-302",
        "FE-005"
      ],
      "description": "系统调研现有稀土f_in_valence模守恒赝势库：PseudoDojo (ONCVPSP), PSlibrary (QE), SG15, GBRV, JTH。收集可用赝势，记录每个赝势的参考构型、截断半径、lmax、验证状态。建立赝势库索引。",
      "acceptance_criteria": [
        "至少覆盖La/Ce/Nd/Sm/Eu/Gd/Tb 7种元素的赝势可用性报告",
        "每个元素至少1个f_in_valence赝势",
        "记录赝势来源、参数、质量评估",
        "建立赝势库目录结构"
      ],
      "files_to_touch": [
        "pseudopotentials/rare_earth/",
        "pseudopotentials/rare_earth/README.md"
      ],
      "estimated_effort": "1-2 days",
      "specialist": "workflow",
      "risk_level": "low",
      "old_ids": [
        "T0-4",
        "FE-000"
      ],
      "spec_doc": "docs/tasks/FE-000.md"
    },
    {
      "id": "FE-001",
      "title": "ABACUS DFT+U 代码深度审计",
      "layer": "core",
      "type": "research",
      "scope": "abacus",
      "status": "terminated",
      "dependencies": [],
      "blocks": [],
      "description": "[TERMINATED] 详细审计ABACUS DFT+U实现：dftu.cpp（主逻辑、U-ramping、omc）、dftu_occup.cpp（占据矩阵mixing）、dftu_hamilt.cpp（哈密顿量）、dftu_yukawa.cpp（自动U）、dftu_pw.cpp（PW限制）。记录每个函数的输入输出、数据流、已知限制。特别关注f电子（l=3）的处理路径。\n\n终止原因：见 plans/2026-02-16-critical-review.md",
      "acceptance_criteria": [
        "完整的代码审计文档，包含数据流图",
        "f电子处理路径分析",
        "已知限制和改进点清单"
      ],
      "files_to_touch": [
        "projects/f-electron-scf/audit/dftu_audit.md"
      ],
      "estimated_effort": "2-3 days",
      "specialist": "abacus-develop",
      "risk_level": "low",
      "old_ids": [
        "FE-002"
      ],
      "spec_doc": "docs/tasks/FE-001.md"
    },
    {
      "id": "FE-002",
      "title": "建立 DFT+U 回归测试套件",
      "layer": "core",
      "type": "infra",
      "scope": "abacus",
      "status": "pending",
      "dependencies": [],
      "blocks": [
        "FE-101"
      ],
      "description": "建立CeO2和GdN的DFT+U回归测试基线。包括LCAO和PW两种基组的参考结果。确保后续代码移植不破坏现有功能。",
      "acceptance_criteria": [
        "CeO2 LCAO DFT+U 基线结果",
        "GdN LCAO DFT+U 基线结果",
        "自动化回归测试脚本",
        "结果对比阈值定义"
      ],
      "files_to_touch": [
        "projects/f-electron-scf/tests/regression/"
      ],
      "estimated_effort": "1-2 days",
      "specialist": "abacus-develop",
      "risk_level": "low",
      "old_ids": [
        "T0-3"
      ],
      "spec_doc": "docs/tasks/FE-002.md"
    },
    {
      "id": "FE-005",
      "title": "赝势质量前置验证",
      "layer": "validation",
      "type": "validation",
      "scope": "cross_code",
      "status": "pending",
      "dependencies": [
        "FE-000"
      ],
      "blocks": [
        "FE-302"
      ],
      "description": "用现有赝势（SG15/PseudoDojo）对 CeO2、Gd2O3 分别跑 ABACUS 和 VASP 对比。量化偏差：晶格常数、体模量、带隙、磁矩。Go/No-Go 门控：偏差 >5% 则标记赝势不可用，通知项目 f-electron-multiscale 启动赝势生成任务。此任务在 Phase 0 执行，目的是提前暴露赝势质量风险，避免在 Phase 3 才发现问题。",
      "acceptance_criteria": [
        "CeO2 和 Gd2O3 的 ABACUS vs VASP 对比完成",
        "晶格常数、体模量、带隙偏差量化记录",
        "Go/No-Go 判定文档产出"
      ],
      "files_to_touch": [
        "projects/f-electron-scf/validation/pseudopotential_precheck/"
      ],
      "estimated_effort": "3-5 days",
      "specialist": "workflow",
      "risk_level": "medium",
      "spec_doc": "docs/tasks/FE-005.md"
    },
    {
      "id": "FE-100",
      "title": "onsite_projector nspin=1/2 支持",
      "layer": "infra",
      "type": "extend",
      "scope": "abacus",
      "status": "in_review",
      "dependencies": [],
      "blocks": [
        "FE-101",
        "FE-102",
        "FE-109"
      ],
      "description": "扩展 develop 的 onsite_projector 支持 nspin=1/2。当前 develop 仅支持 nspin=4。需要：(1) cal_occupations() 增加 isk_in 参数，(2) cal_becp() 增加 npwx 参数，(3) 适配 Onsite_Proj_tools（develop）vs FS_Nonlocal_tools（zdy-tmp）的 API 差异。",
      "acceptance_criteria": [
        "编译通过",
        "现有 nspin=4 测试不受影响（回归 099_PW_DJ_SO）",
        "新增 nspin=2 单元测试（npol=1 spin-up/down occupation、charge_mag）",
        "npol=2 回归测试通过"
      ],
      "files_to_touch": [
        "source/source_pw/module_pwdft/onsite_projector.h",
        "source/source_pw/module_pwdft/onsite_projector.cpp",
        "source/source_pw/module_pwdft/onsite_proj_tools.h",
        "source/source_pw/module_pwdft/onsite_proj_tools.cpp"
      ],
      "estimated_effort": "1-2 days",
      "specialist": "abacus-develop",
      "risk_level": "low",
      "old_ids": [
        "PR-1"
      ],
      "commit_hash": "d2364165c",
      "review_notes": "代码已提交但验收未通过：零单元测试、零集成测试、无编译日志。需补充测试。",
      "spec_doc": "docs/tasks/FE-100.md"
    },
    {
      "id": "FE-101",
      "title": "DFT+U PW SCF（nspin=4）",
      "layer": "infra",
      "type": "extend",
      "scope": "abacus",
      "status": "pending",
      "dependencies": [
        "FE-100"
      ],
      "blocks": [
        "FE-102",
        "FE-103",
        "FE-105",
        "FE-106"
      ],
      "description": "在 PW 基组下支持 DFT+U SCF 计算（先 nspin=4）。核心工作：(1) 移植 zdy-tmp dftu_pw.cpp 的 PW 占据矩阵计算到 develop 的 Plus_U 类，(2) 添加 eff_pot_pw/cal_occup_m_pw 等 PW 相关方法，(3) 在 esolver_ks_pw.cpp 集成 DFT+U 调用。适配要点：DFTU→Plus_U 类名、GlobalC::ucell→参数传递、GlobalV::NSPIN→PARAM.inp.nspin。",
      "acceptance_criteria": [
        "CeO2 nspin=4 PW DFT+U SCF 可收敛",
        "能量与 LCAO DFT+U 定性一致",
        "编译通过，现有测试不受影响",
        "nspin=1/2/4 的能量权重和对角系数单元测试",
        "set_locale() 的 uom_array→locale 拷贝单元测试"
      ],
      "files_to_touch": [
        "source/source_lcao/module_dftu/dftu_pw.cpp",
        "source/source_lcao/module_dftu/dftu.h",
        "source/source_lcao/module_dftu/dftu.cpp",
        "source/source_esolver/esolver_ks_pw.cpp",
        "source/source_io/module_parameter/input_parameter.h"
      ],
      "estimated_effort": "3-5 days",
      "specialist": "abacus-develop",
      "risk_level": "medium",
      "old_ids": [
        "PR-2"
      ],
      "spec_doc": "docs/tasks/FE-101.md"
    },
    {
      "id": "FE-102",
      "title": "DFT+U PW nspin=1/2 扩展",
      "layer": "infra",
      "type": "extend",
      "scope": "abacus",
      "status": "pending",
      "dependencies": [
        "FE-100",
        "FE-101"
      ],
      "blocks": [
        "FE-106"
      ],
      "description": "扩展 PW DFT+U 支持 nspin=1 和 nspin=2。在 dftu_pw.cpp 添加 nspin=1/2 分支，在 esolver_ks_pw.cpp 处理 nspin=2 的 isk 映射。",
      "acceptance_criteria": [
        "NiO nspin=2 PW DFT+U SCF 可收敛",
        "能量与 LCAO 一致",
        "新增 100_PW_DFTU_S2（nspin=2）和 101_PW_DFTU_S1（nspin=1）集成测试"
      ],
      "files_to_touch": [
        "source/source_lcao/module_dftu/dftu_pw.cpp",
        "source/source_esolver/esolver_ks_pw.cpp"
      ],
      "estimated_effort": "2-3 days",
      "specialist": "abacus-develop",
      "risk_level": "medium",
      "old_ids": [
        "PR-3"
      ],
      "spec_doc": "docs/tasks/FE-102.md"
    },
    {
      "id": "FE-103",
      "title": "DFT+U PW force",
      "layer": "infra",
      "type": "extend",
      "scope": "abacus",
      "status": "pending",
      "dependencies": [
        "FE-101"
      ],
      "blocks": [
        "FE-104",
        "FE-106"
      ],
      "description": "PW 基组下 DFT+U 力的计算。适配 forces_onsite.cpp 到 Plus_U 接口，确保 cal_force_dftu() 在 Onsite_Proj_tools 中正确工作。",
      "acceptance_criteria": [
        "CeO2 PW DFT+U 力与 LCAO 一致（误差 < 1 mRy/Bohr）",
        "力的对称性正确"
      ],
      "files_to_touch": [
        "source/source_pw/module_pwdft/forces_onsite.cpp",
        "source/source_pw/module_pwdft/onsite_proj_tools.h",
        "source/source_pw/module_pwdft/onsite_proj_tools.cpp"
      ],
      "estimated_effort": "2-3 days",
      "specialist": "abacus-develop",
      "risk_level": "medium",
      "old_ids": [
        "PR-4"
      ],
      "spec_doc": "docs/tasks/FE-103.md"
    },
    {
      "id": "FE-104",
      "title": "DFT+U PW stress",
      "layer": "infra",
      "type": "extend",
      "scope": "abacus",
      "status": "pending",
      "dependencies": [
        "FE-103"
      ],
      "blocks": [
        "FE-106"
      ],
      "description": "PW 基组下 DFT+U 应力的计算。适配 stress_func_onsite.cpp 到 Plus_U 接口。",
      "acceptance_criteria": [
        "CeO2 PW DFT+U 应力与 LCAO 一致",
        "应力张量对称性正确"
      ],
      "files_to_touch": [
        "source/source_pw/module_pwdft/stress_func_onsite.cpp",
        "source/source_pw/module_pwdft/onsite_proj_tools.h",
        "source/source_pw/module_pwdft/onsite_proj_tools.cpp"
      ],
      "estimated_effort": "2 days",
      "specialist": "abacus-develop",
      "risk_level": "low",
      "old_ids": [
        "PR-5"
      ],
      "spec_doc": "docs/tasks/FE-104.md"
    },
    {
      "id": "FE-105",
      "title": "mixing_dftu（占据矩阵 mixing）",
      "layer": "infra",
      "type": "extend",
      "scope": "abacus",
      "status": "pending",
      "dependencies": [
        "FE-101"
      ],
      "blocks": [
        "FE-106",
        "FE-111",
        "FE-112",
        "FE-113",
        "FE-200"
      ],
      "description": "实现占据矩阵的 Broyden mixing，改善 DFT+U 收敛性。添加 mix_locale() 方法，mixing_dftu 输入参数，震荡体系自动开启 mixing_dftu。",
      "acceptance_criteria": [
        "mixing_dftu=true 时占据矩阵使用 Broyden mixing",
        "震荡体系自动开启 mixing_dftu",
        "不影响非 DFT+U 计算"
      ],
      "files_to_touch": [
        "source/source_lcao/module_dftu/dftu_occup.cpp",
        "source/source_lcao/module_dftu/dftu.h",
        "source/source_lcao/module_dftu/dftu.cpp",
        "source/source_io/module_parameter/input_parameter.h",
        "source/source_io/module_parameter/read_input_item_exx_dftu.cpp"
      ],
      "estimated_effort": "3-4 days",
      "specialist": "abacus-develop",
      "risk_level": "medium",
      "old_ids": [
        "PR-6"
      ],
      "spec_doc": "docs/tasks/FE-105.md"
    },
    {
      "id": "FE-106",
      "title": "DFT+U PW GPU/DCU 加速适配",
      "layer": "infra",
      "type": "extend",
      "scope": "abacus",
      "status": "pending",
      "dependencies": [
        "FE-101",
        "FE-102",
        "FE-103",
        "FE-104"
      ],
      "blocks": [],
      "description": "确保 PW DFT+U 在 GPU/DCU 上正确运行。适配 GPU kernel、device memory 操作。",
      "acceptance_criteria": [
        "CUDA 编译通过",
        "GPU 结果与 CPU 一致"
      ],
      "files_to_touch": [
        "source/source_pw/module_pwdft/kernels/",
        "source/source_pw/module_pwdft/onsite_proj_tools.cpp"
      ],
      "estimated_effort": "3-5 days",
      "specialist": "abacus-develop",
      "risk_level": "medium",
      "old_ids": [
        "PR-7"
      ],
      "spec_doc": "docs/tasks/FE-106.md"
    },
    {
      "id": "FE-107",
      "title": "module_deltaspin 核心移植",
      "layer": "infra",
      "type": "extend",
      "scope": "abacus",
      "status": "pending",
      "dependencies": [],
      "blocks": [
        "FE-108",
        "FE-109"
      ],
      "description": "将 zdy-tmp 新增的 deltaspin 文件移植到 develop。新增 cal_h_lambda.cpp、cal_mw_helper.cpp、sc_parse_json.cpp。更新 spin_constrain.h/cpp（合并 zdy-tmp 增强到 develop 基础版本）。适配 include 路径和 GlobalC 去除。",
      "acceptance_criteria": [
        "所有 deltaspin 单元测试通过",
        "编译通过"
      ],
      "files_to_touch": [
        "source/source_lcao/module_deltaspin/cal_h_lambda.cpp (NEW)",
        "source/source_lcao/module_deltaspin/cal_mw_helper.cpp (NEW)",
        "source/source_lcao/module_deltaspin/sc_parse_json.cpp (NEW)",
        "source/source_lcao/module_deltaspin/spin_constrain.h",
        "source/source_lcao/module_deltaspin/spin_constrain.cpp",
        "source/source_lcao/module_deltaspin/CMakeLists.txt",
        "source/source_lcao/module_deltaspin/test/"
      ],
      "estimated_effort": "3-4 days",
      "specialist": "abacus-develop",
      "risk_level": "low",
      "old_ids": [
        "PR-8"
      ],
      "spec_doc": "docs/tasks/FE-107.md"
    },
    {
      "id": "FE-108",
      "title": "DeltaSpin LCAO 算符更新",
      "layer": "infra",
      "type": "extend",
      "scope": "abacus",
      "status": "pending",
      "dependencies": [
        "FE-107"
      ],
      "blocks": [
        "FE-110",
        "FE-111"
      ],
      "description": "更新 LCAO 下的 DeltaSpin 算符。合并 zdy-tmp 对 dspin_lcao.h/cpp、dspin_force_stress.hpp 的改动。更新 esolver_ks_lcao.cpp 中的 DeltaSpin 集成点。",
      "acceptance_criteria": [
        "LCAO DeltaSpin SCF 正确",
        "力/应力正确"
      ],
      "files_to_touch": [
        "source/source_lcao/module_operator_lcao/dspin_lcao.h",
        "source/source_lcao/module_operator_lcao/dspin_lcao.cpp",
        "source/source_lcao/module_operator_lcao/dspin_force_stress.hpp",
        "source/source_esolver/esolver_ks_lcao.cpp"
      ],
      "estimated_effort": "2-3 days",
      "specialist": "abacus-develop",
      "risk_level": "medium",
      "old_ids": [
        "PR-9"
      ],
      "spec_doc": "docs/tasks/FE-108.md"
    },
    {
      "id": "FE-109",
      "title": "DeltaSpin PW 支持",
      "layer": "infra",
      "type": "extend",
      "scope": "abacus",
      "status": "pending",
      "dependencies": [
        "FE-100",
        "FE-107"
      ],
      "blocks": [
        "FE-110"
      ],
      "description": "在 PW 基组下支持 DeltaSpin。在 esolver_ks_pw.cpp 集成 lambda loop，添加 cal_Mi_pw 等 PW 相关方法。",
      "acceptance_criteria": [
        "PW DeltaSpin SCF 可运行",
        "磁矩约束有效"
      ],
      "files_to_touch": [
        "source/source_esolver/esolver_ks_pw.cpp",
        "source/source_lcao/module_deltaspin/spin_constrain.h",
        "source/source_lcao/module_deltaspin/spin_constrain.cpp"
      ],
      "estimated_effort": "3-4 days",
      "specialist": "abacus-develop",
      "risk_level": "medium",
      "old_ids": [
        "PR-10"
      ],
      "spec_doc": "docs/tasks/FE-109.md"
    },
    {
      "id": "FE-110",
      "title": "DeltaSpin force/stress（LCAO + PW）",
      "layer": "infra",
      "type": "extend",
      "scope": "abacus",
      "status": "pending",
      "dependencies": [
        "FE-108",
        "FE-109"
      ],
      "blocks": [],
      "description": "DeltaSpin 的力和应力计算，覆盖 LCAO 和 PW 两种基组。",
      "acceptance_criteria": [
        "DeltaSpin 力/应力与数值微分一致"
      ],
      "files_to_touch": [
        "source/source_pw/module_pwdft/forces_onsite.cpp",
        "source/source_pw/module_pwdft/stress_func_onsite.cpp"
      ],
      "estimated_effort": "2-3 days",
      "specialist": "abacus-develop",
      "risk_level": "medium",
      "old_ids": [
        "PR-11"
      ],
      "spec_doc": "docs/tasks/FE-110.md"
    },
    {
      "id": "FE-111",
      "title": "DeltaSpin + DFTU 联合 + conserve_setting",
      "layer": "infra",
      "type": "extend",
      "scope": "abacus",
      "status": "pending",
      "dependencies": [
        "FE-105",
        "FE-108"
      ],
      "blocks": [],
      "description": "支持 DeltaSpin 和 DFT+U 同时使用。添加 conserve_setting 参数控制联合计算行为。",
      "acceptance_criteria": [
        "DeltaSpin + DFT+U 联合计算正确",
        "conserve_setting 参数生效"
      ],
      "files_to_touch": [
        "source/source_esolver/esolver_ks_pw.cpp",
        "source/source_esolver/esolver_ks_lcao.cpp",
        "source/source_io/module_parameter/input_parameter.h"
      ],
      "estimated_effort": "2-3 days",
      "specialist": "abacus-develop",
      "risk_level": "medium",
      "old_ids": [
        "PR-12"
      ],
      "spec_doc": "docs/tasks/FE-111.md"
    },
    {
      "id": "FE-112",
      "title": "SCF 震荡检测 + 自动回退",
      "layer": "algorithm",
      "type": "extend",
      "scope": "abacus",
      "status": "pending",
      "dependencies": [
        "FE-105"
      ],
      "blocks": [
        "FE-113"
      ],
      "description": "检测 SCF 能量震荡并自动调整策略。震荡体系自动调整 mixing 参数，不影响正常收敛体系。",
      "acceptance_criteria": [
        "震荡体系自动检测并调整 mixing 参数",
        "不影响正常收敛体系"
      ],
      "files_to_touch": [
        "source/source_estate/module_charge/charge_mixing.cpp",
        "source/source_esolver/esolver_ks.cpp"
      ],
      "estimated_effort": "2-3 days",
      "specialist": "abacus-develop",
      "risk_level": "low",
      "old_ids": [
        "PR-13"
      ],
      "spec_doc": "docs/tasks/FE-112.md"
    },
    {
      "id": "FE-113",
      "title": "mixing_restart 与 mixing_dftu 协同修复",
      "layer": "algorithm",
      "type": "fix",
      "scope": "abacus",
      "status": "pending",
      "dependencies": [
        "FE-105",
        "FE-112"
      ],
      "blocks": [],
      "description": "修复 mixing_restart 与 mixing_dftu 的兼容性问题，包括 kpar > 1 时的正确性。",
      "acceptance_criteria": [
        "mixing_restart 后 mixing_dftu 状态正确",
        "kpar > 1 时 mixing_dftu 正确"
      ],
      "files_to_touch": [
        "source/source_estate/module_charge/charge_mixing.cpp"
      ],
      "estimated_effort": "1-2 days",
      "specialist": "abacus-develop",
      "risk_level": "low",
      "old_ids": [
        "PR-14"
      ],
      "spec_doc": "docs/tasks/FE-113.md"
    },
    {
      "id": "FE-200",
      "title": "自适应 Kerker 预处理参数",
      "layer": "algorithm",
      "type": "algorithm",
      "scope": "abacus",
      "status": "pending",
      "dependencies": [
        "FE-105"
      ],
      "blocks": [
        "FE-204"
      ],
      "description": "修改 charge_mixing_preconditioner.cpp，实现自适应 mixing_gg0：(1) 根据体系类型（金属/绝缘体/f电子）自动选择初始值，(2) 在 SCF 过程中根据残差变化动态调整，(3) 对 f 电子体系使用更保守的预处理。需要在 input_parameter.h 中添加 mixing_gg0_auto 选项。",
      "acceptance_criteria": [
        "自动检测体系中是否含f电子",
        "根据体系类型自动调整 mixing_gg0",
        "CeO2 收敛步数减少>20%",
        "不影响非f电子体系性能"
      ],
      "files_to_touch": [
        "source/source_estate/module_charge/charge_mixing_preconditioner.cpp",
        "source/source_estate/module_charge/charge_mixing.h",
        "source/source_estate/module_charge/charge_mixing.cpp",
        "source/source_io/module_parameter/input_parameter.h"
      ],
      "estimated_effort": "3-5 days",
      "specialist": "abacus-develop",
      "risk_level": "low",
      "old_ids": [
        "T1-1",
        "FE-200"
      ],
      "spec_doc": "docs/tasks/FE-200.md"
    },
    {
      "id": "FE-201",
      "title": "分通道 mixing_beta 实现",
      "layer": "algorithm",
      "type": "algorithm",
      "scope": "abacus",
      "status": "pending",
      "dependencies": [],
      "blocks": [
        "FE-204"
      ],
      "description": "在 charge_mixing 中实现按角动量通道分别设置 mixing_beta 的能力。f 电子通道使用更小的 mixing_beta（如 0.05-0.1），s/p/d 通道使用正常值（0.3-0.7）。实现方式：在实空间投影到原子轨道分量后分别 mixing，或在密度矩阵 mixing（LCAO）中按 l 分通道。",
      "acceptance_criteria": [
        "识别f通道并单独设置 mixing_beta",
        "改善f电子体系收敛稳定性",
        "含f电子体系的 SCF 收敛性改善",
        "不影响无f电子体系的性能"
      ],
      "files_to_touch": [
        "source/source_estate/module_charge/charge_mixing_rho.cpp",
        "source/source_estate/module_charge/charge_mixing_dmr.cpp",
        "source/source_estate/module_charge/charge_mixing.h"
      ],
      "estimated_effort": "3-5 days",
      "specialist": "abacus-develop",
      "risk_level": "low",
      "old_ids": [
        "T1-2",
        "FE-201"
      ],
      "spec_doc": "docs/tasks/FE-201.md"
    },
    {
      "id": "FE-202",
      "title": "占据矩阵随机初始化 + 多起点探索",
      "layer": "algorithm",
      "type": "algorithm",
      "scope": "abacus",
      "status": "pending",
      "dependencies": [],
      "blocks": [],
      "description": "在 dftu.cpp 中实现：(1) 随机占据矩阵初始化（在合理物理约束内随机），(2) 基于氧化态的化学直觉初始化（如 Ce4+ → f^0, Ce3+ → f^1），(3) 多起点并行探索接口（运行 N 个不同初始化的 SCF，选最低能量）。新增输入参数：omc_random, omc_nstart, omc_seed。",
      "acceptance_criteria": [
        "添加 omc_mode=random 选项",
        "支持多起点并行运行",
        "自动选择最低能量结果",
        "CeO2 的 DFT+U 计算能通过多起点找到正确基态（与 VASP 一致）"
      ],
      "files_to_touch": [
        "source/source_lcao/module_dftu/dftu.cpp",
        "source/source_lcao/module_dftu/dftu.h",
        "source/source_lcao/module_dftu/dftu_io.cpp",
        "source/source_io/module_parameter/read_input_item_exx_dftu.cpp"
      ],
      "estimated_effort": "1 week",
      "specialist": "abacus-develop",
      "risk_level": "medium",
      "old_ids": [
        "T1-4",
        "T2-1",
        "FE-202"
      ],
      "spec_doc": "docs/tasks/FE-202.md"
    },
    {
      "id": "FE-203",
      "title": "占据矩阵退火策略",
      "layer": "algorithm",
      "type": "algorithm",
      "scope": "abacus",
      "status": "terminated",
      "dependencies": [
        "FE-202"
      ],
      "blocks": [],
      "description": "[TERMINATED] 实现占据退火：(1) 初始阶段使用高 smearing 温度（如 0.1 Ry），使占据矩阵平滑化，(2) 逐步降低 smearing 到目标值（如 0.01 Ry），(3) 与 U-ramping 协同：先 ramping U 到目标值，再退火 smearing。在 dftu_occup.cpp 中实现退火调度器。\n\n终止原因：见 plans/2026-02-16-critical-review.md",
      "acceptance_criteria": [
        "实现 smearing 温度退火",
        "与 U-ramping 协同",
        "EuO 等多极小值体系的收敛成功率提升>50%",
        "验证收敛率改善"
      ],
      "files_to_touch": [
        "source/source_lcao/module_dftu/dftu_occup.cpp",
        "source/source_lcao/module_dftu/dftu.cpp"
      ],
      "estimated_effort": "3-5 days",
      "specialist": "abacus-develop",
      "risk_level": "medium",
      "old_ids": [
        "T2-2",
        "FE-203"
      ],
      "spec_doc": "docs/tasks/FE-203.md"
    },
    {
      "id": "FE-204",
      "title": "能量监控 + SCF 自动回退机制",
      "layer": "algorithm",
      "type": "algorithm",
      "scope": "abacus",
      "status": "pending",
      "dependencies": [
        "FE-200",
        "FE-201"
      ],
      "blocks": [
        "FE-205",
        "FE-302",
        "FE-303"
      ],
      "description": "在 SCF 主循环中实现：(1) 逐步监控总能量变化，检测震荡模式，(2) 当能量连续上升 N 步时，自动减小 mixing_beta 并回退到上一个低能量状态，(3) 当检测到周期性震荡时，切换 mixing 策略（如从 Broyden 切换到 Pulay 或 plain），(4) 输出诊断信息帮助用户理解收敛行为。",
      "acceptance_criteria": [
        "原本不收敛的f电子体系中>70%可通过自动回退收敛",
        "监控 SCF 能量变化趋势",
        "能量上升时自动减小 mixing_beta",
        "回退到上一步收敛的电荷密度"
      ],
      "files_to_touch": [
        "source/source_estate/module_charge/charge_mixing.cpp",
        "source/source_estate/module_charge/charge_mixing_rho.cpp"
      ],
      "estimated_effort": "1 week",
      "specialist": "abacus-develop",
      "risk_level": "medium",
      "old_ids": [
        "T1-3",
        "FE-204"
      ],
      "spec_doc": "docs/tasks/FE-204.md"
    },
    {
      "id": "FE-205",
      "title": "constrained DFT 框架（f 电子数约束）",
      "layer": "algorithm",
      "type": "algorithm",
      "scope": "abacus",
      "status": "pending",
      "dependencies": [
        "FE-204"
      ],
      "blocks": [],
      "description": "[EPIC][工程追赶] 实现 constrained DFT：(1) 新模块 charge_constraint.cpp，添加惩罚势 V = λ·(n_f - n_target)^2 到哈密顿量，(2) 约束强度 λ 从大到小逐步释放（类似 U-ramping），(3) 支持按原子指定目标 f 电子数，(4) 与 DFT+U 的 omc 协同工作。这是确保 f 电子体系收敛到正确基态的关键手段。\n\n已分解为子任务：FE-205-1（模块骨架与参数）→ FE-205-2（惩罚势与投影）→ FE-205-3（Lambda 调度与 SCF 集成）→ FE-205-4（omc 协同与端到端验证）",
      "acceptance_criteria": [
        "Ce2O3 中 Ce 的 f 电子数可被约束到目标值±0.1",
        "释放约束后保持",
        "实现惩罚势 V_constraint",
        "约束强度逐步释放",
        "与 DFT+U 占据矩阵控制协同"
      ],
      "files_to_touch": [
        "source/source_estate/module_charge/charge_constraint.cpp (NEW)",
        "source/source_estate/module_charge/charge_constraint.h (NEW)",
        "source/source_lcao/module_dftu/dftu.cpp",
        "source/source_io/module_parameter/input_parameter.h"
      ],
      "estimated_effort": "2 weeks",
      "specialist": "abacus-develop",
      "risk_level": "medium",
      "old_ids": [
        "T2-3",
        "FE-205"
      ],
      "spec_doc": "docs/tasks/FE-205.md"
    },
    {
      "id": "FE-205-1",
      "title": "ChargeConstraint 模块骨架与输入参数",
      "layer": "algorithm",
      "type": "algorithm",
      "scope": "abacus",
      "status": "pending",
      "dependencies": [
        "FE-204"
      ],
      "blocks": [
        "FE-205-2"
      ],
      "description": "[工程追赶] 创建 charge_constraint.h/cpp 模块骨架：\n(1) ChargeConstraint 类定义，包含 per-atom 约束参数结构体 (atom_index, n_target, lambda, orbital_l)\n(2) INPUT 参数扩展：chg_constraint (bool), chg_constraint_atoms (string), chg_constraint_targets (double[]), chg_constraint_lambda0 (double)\n(3) 从 INPUT 解析约束配置并初始化 ChargeConstraint 实例\n(4) 单元测试验证参数解析正确性",
      "acceptance_criteria": [
        "charge_constraint.h/cpp 编译通过",
        "INPUT 参数可正确解析约束配置",
        "单元测试覆盖参数解析"
      ],
      "files_to_touch": [
        "source/source_estate/module_charge/charge_constraint.h (NEW)",
        "source/source_estate/module_charge/charge_constraint.cpp (NEW)",
        "source/source_io/module_parameter/input_parameter.h"
      ],
      "estimated_effort": "2 days",
      "specialist": "abacus-develop",
      "risk_level": "low",
      "old_ids": [
        "FE-205"
      ],
      "spec_doc": "docs/tasks/FE-205-1.md"
    },
    {
      "id": "FE-205-2",
      "title": "惩罚势计算与占据数投影",
      "layer": "algorithm",
      "type": "algorithm",
      "scope": "abacus",
      "status": "pending",
      "dependencies": [
        "FE-205-1"
      ],
      "blocks": [
        "FE-205-3"
      ],
      "description": "[工程追赶] 实现惩罚势核心算法：\n(1) 从 DFT+U 的 onsite projector 获取 f 轨道占据矩阵，计算 n_f = Tr(occupation_matrix) 得到 f 电子数\n(2) 实现二次惩罚势 V_penalty = λ·(n_f - n_target)²，计算对应的势能贡献和力贡献 dV/dn = 2λ·(n_f - n_target)\n(3) 将惩罚势叠加到 Hamiltonian（复用 DFT+U 的 V_eff 接口）\n(4) 单元测试：给定已知占据矩阵，验证惩罚势数值正确",
      "acceptance_criteria": [
        "惩罚势 V = λ·(n_f - n_target)² 计算正确",
        "势能贡献正确叠加到 Hamiltonian",
        "与 DFT+U projector 接口对接",
        "数值单元测试通过"
      ],
      "files_to_touch": [
        "source/source_estate/module_charge/charge_constraint.cpp",
        "source/source_lcao/module_dftu/dftu.cpp"
      ],
      "estimated_effort": "3 days",
      "specialist": "abacus-develop",
      "risk_level": "medium",
      "old_ids": [
        "FE-205"
      ],
      "spec_doc": "docs/tasks/FE-205-2.md"
    },
    {
      "id": "FE-205-3",
      "title": "Lambda 调度策略与 SCF 集成",
      "layer": "algorithm",
      "type": "algorithm",
      "scope": "abacus",
      "status": "pending",
      "dependencies": [
        "FE-205-2"
      ],
      "blocks": [
        "FE-205-4"
      ],
      "description": "[工程追赶] 实现约束强度的逐步释放机制并集成到 SCF 主循环：\n(1) Lambda 调度器：支持指数衰减 λ(t) = λ₀·exp(-t/τ) 和线性衰减两种模式，可配置 λ₀（默认 10.0 eV）、τ（默认 50 步）、λ_final（默认 0.0）\n(2) 在 SCF 主循环的每步调用 ChargeConstraint::update(scf_step)，更新 λ 值并重新计算惩罚势\n(3) 与 FE-204 的能量监控协同：当能量回退触发时暂停 λ 衰减\n(4) 收敛判据扩展：同时满足能量收敛 ΔE < 10⁻⁶ eV 和占据收敛 |n_f - n_target| < 0.05",
      "acceptance_criteria": [
        "Lambda 从 λ₀ 逐步衰减到 0",
        "SCF 循环中正确调用约束更新",
        "与能量监控（FE-204）协同工作",
        "收敛判据包含占据数条件"
      ],
      "files_to_touch": [
        "source/source_estate/module_charge/charge_constraint.cpp",
        "source/source_estate/module_charge/charge_mixing.cpp"
      ],
      "estimated_effort": "3 days",
      "specialist": "abacus-develop",
      "risk_level": "medium",
      "old_ids": [
        "FE-205"
      ],
      "spec_doc": "docs/tasks/FE-205-3.md"
    },
    {
      "id": "FE-205-4",
      "title": "与 DFT+U omc 协同及端到端验证",
      "layer": "algorithm",
      "type": "algorithm",
      "scope": "abacus",
      "status": "pending",
      "dependencies": [
        "FE-205-3"
      ],
      "blocks": [
        "FE-302"
      ],
      "description": "[工程追赶] 实现与 DFT+U occupation matrix control 的协同，并完成端到端验证：\n(1) 当 DFT+U 的 omc 开启时，约束目标自动从 omc 的目标占据矩阵推导 n_target\n(2) 支持 Hund 规则自动构造初始占据矩阵（Ce³⁺ f¹, Gd³⁺ f⁷ 等）\n(3) 端到端测试：Ce2O3 体系，约束 Ce 的 f 电子数到 1.0±0.1，释放约束后验证占据数保持\n(4) 测试 CeO2（f⁰）和 GdN（f⁷）作为额外验证\n(5) 输出诊断信息：每步的 n_f、λ、V_penalty、总能量",
      "acceptance_criteria": [
        "Ce2O3 中 Ce 的 f 电子数可被约束到目标值±0.1",
        "释放约束后占据数保持",
        "与 DFT+U 占据矩阵控制协同工作",
        "CeO2 和 GdN 验证通过",
        "诊断输出完整"
      ],
      "files_to_touch": [
        "source/source_estate/module_charge/charge_constraint.cpp",
        "source/source_lcao/module_dftu/dftu.cpp"
      ],
      "estimated_effort": "3 days",
      "specialist": "abacus-develop",
      "risk_level": "medium",
      "old_ids": [
        "FE-205"
      ],
      "spec_doc": "docs/tasks/FE-205-4.md"
    },
    {
      "id": "FE-300",
      "title": "用户需求调研",
      "layer": "workflow",
      "type": "research",
      "scope": "external",
      "status": "pending",
      "dependencies": [],
      "blocks": [
        "FE-301"
      ],
      "description": "调研实际用户的稀土计算需求，收集3-5个具体体系和性质要求，识别真实痛点。覆盖不同应用场景（氧化物/合金/催化等）。",
      "acceptance_criteria": [
        "收集至少3个实际研究项目的计算需求",
        "记录：元素、结构、目标性质、当前痛点",
        "覆盖不同应用场景（氧化物/合金/催化等）",
        "形成需求文档"
      ],
      "files_to_touch": [
        "projects/f-electron-scf/user_requirements.md"
      ],
      "estimated_effort": "3-5 days",
      "specialist": "workflow",
      "risk_level": "low",
      "old_ids": [
        "T3-1"
      ],
      "spec_doc": "docs/tasks/FE-300.md"
    },
    {
      "id": "FE-301",
      "title": "选择 2-3 个代表性验证体系",
      "layer": "workflow",
      "type": "research",
      "scope": "cross_code",
      "status": "pending",
      "dependencies": [
        "FE-300"
      ],
      "blocks": [
        "FE-304"
      ],
      "description": "基于用户需求，选择2-3个代表性体系作为验证目标，必须覆盖：简单氧化物基线、磁序、一个应用场景。每个体系有明确的参考数据来源。",
      "acceptance_criteria": [
        "选择标准：覆盖关键物理（f电子、磁性、化学环境）",
        "示例组合：CeO2（基线）+ GdN（磁性）+ CeO2(111)表面（催化）",
        "或：CeO2 + NdFeB（合金磁性）+ 稀土MOF（分子）",
        "每个体系有明确的参考数据来源"
      ],
      "files_to_touch": [
        "projects/f-electron-scf/validation_systems.md"
      ],
      "estimated_effort": "2-3 days",
      "specialist": "workflow",
      "risk_level": "low",
      "old_ids": [
        "T3-2"
      ],
      "spec_doc": "docs/tasks/FE-301.md"
    },
    {
      "id": "FE-302",
      "title": "简单氧化物验证（CeO2, Gd2O3, La2O3）",
      "layer": "validation",
      "type": "validation",
      "scope": "cross_code",
      "status": "pending",
      "dependencies": [
        "FE-000",
        "FE-204",
        "FE-205-4"
      ],
      "blocks": [
        "FE-303",
        "FE-304",
        "FE-306"
      ],
      "description": "基准验证：ABACUS vs VASP PAW 对比 CeO2/Gd2O3/La2O3 的晶格常数、体模量、带隙、磁矩（如适用）。PBE 和 PBE+U 两种泛函。记录 SCF 收敛步数和计算时间。",
      "acceptance_criteria": [
        "晶格常数误差<1%",
        "体模量误差<10%",
        "带隙定性一致",
        "SCF 收敛步数和计算时间记录"
      ],
      "files_to_touch": [
        "projects/f-electron-scf/validation/oxide_benchmark/"
      ],
      "estimated_effort": "1 week",
      "specialist": "workflow",
      "risk_level": "medium",
      "old_ids": [
        "FE-400"
      ],
      "spec_doc": "docs/tasks/FE-302.md"
    },
    {
      "id": "FE-303",
      "title": "合金与磁性化合物验证",
      "layer": "validation",
      "type": "validation",
      "scope": "cross_code",
      "status": "pending",
      "dependencies": [
        "FE-302",
        "FE-204"
      ],
      "blocks": [
        "FE-304"
      ],
      "description": "中等难度验证：(1) NdFeB/SmCo5 合金的磁矩和磁各向异性，(2) GdN/EuO 的磁序和交换耦合，(3) TbMnO3 的多铁性。重点关注 DFT+U 参数敏感性和 SCF 收敛可靠性。",
      "acceptance_criteria": [
        "磁矩与 VASP/实验值偏差<10%",
        "SCF 收敛成功率>90%"
      ],
      "files_to_touch": [
        "projects/f-electron-scf/validation/magnetic_benchmark/"
      ],
      "estimated_effort": "1-2 weeks",
      "specialist": "workflow",
      "risk_level": "medium",
      "old_ids": [
        "FE-401"
      ],
      "spec_doc": "docs/tasks/FE-303.md"
    },
    {
      "id": "FE-304",
      "title": "跨代码验证（ABACUS vs VASP）",
      "layer": "validation",
      "type": "validation",
      "scope": "cross_code",
      "status": "pending",
      "dependencies": [
        "FE-302",
        "FE-301",
        "FE-306"
      ],
      "blocks": [
        "FE-305",
        "FE-400"
      ],
      "description": "对选定的验证体系，运行 ABACUS 和 VASP 计算，对比晶格常数、磁矩、带隙、形成能等关键性质。如果误差>5%且可追溯到赝势，触发 FE-D-A1。",
      "acceptance_criteria": [
        "ABACUS vs VASP 结构性质误差<2%",
        "能量误差<10%",
        "磁矩误差<0.1 μB",
        "如果误差>5%且可追溯到赝势，触发 FE-D-A1"
      ],
      "files_to_touch": [
        "projects/f-electron-scf/validation/cross_code/",
        "projects/f-electron-scf/validation/comparison_report.md"
      ],
      "estimated_effort": "1-2 weeks",
      "specialist": "workflow",
      "risk_level": "medium",
      "old_ids": [
        "T3-3"
      ],
      "spec_doc": "docs/tasks/FE-304.md"
    },
    {
      "id": "FE-305",
      "title": "收敛可靠性测试",
      "layer": "validation",
      "type": "validation",
      "scope": "cross_code",
      "status": "pending",
      "dependencies": [
        "FE-304"
      ],
      "blocks": [
        "FE-400"
      ],
      "description": "对每个验证体系运行10次不同随机种子的计算，统计收敛率和能量一致性。",
      "acceptance_criteria": [
        "每个体系运行10次（不同随机种子）",
        "收敛率>90%",
        "收敛结果能量标准差<1 meV",
        "记录失败案例的诊断信息"
      ],
      "files_to_touch": [
        "projects/f-electron-scf/validation/reliability_test.py",
        "projects/f-electron-scf/validation/reliability_report.md"
      ],
      "estimated_effort": "1 week",
      "specialist": "workflow",
      "risk_level": "low",
      "old_ids": [
        "T3-4"
      ],
      "spec_doc": "docs/tasks/FE-305.md"
    },
    {
      "id": "FE-306",
      "title": "CeO2 全电子参考计算 (FHI-aims/Elk)",
      "layer": "validation",
      "type": "validation",
      "scope": "cross_code",
      "status": "pending",
      "dependencies": [
        "FE-302"
      ],
      "blocks": [
        "FE-304"
      ],
      "description": "用 FHI-aims 或 Elk 对 CeO2 做全电子 DFT+U 参考计算。提供赝势近似误差的绝对参考。消除'ABACUS ≠ VASP 时无法区分算法问题还是赝势问题'的歧义。对比项：晶格常数、体模量、带隙、Ce 4f 占据数、磁矩。",
      "acceptance_criteria": [
        "CeO2 全电子 DFT+U 计算完成",
        "与 ABACUS 和 VASP 结果三方对比",
        "赝势近似误差量化"
      ],
      "files_to_touch": [
        "projects/f-electron-scf/validation/all_electron_reference/"
      ],
      "estimated_effort": "1 week",
      "specialist": "workflow",
      "risk_level": "medium",
      "spec_doc": "docs/tasks/FE-306.md"
    },
    {
      "id": "FE-400",
      "title": "自动参数选择",
      "layer": "workflow",
      "type": "new",
      "scope": "abacus",
      "status": "pending",
      "dependencies": [
        "FE-304",
        "FE-305"
      ],
      "blocks": [
        "FE-402"
      ],
      "description": "实现自动参数选择工具：输入结构文件+元素列表，输出推荐的 mixing_beta、Kerker 参数、U 值、占据策略。检测 f 元素并应用最佳实践参数。",
      "acceptance_criteria": [
        "检测f元素并应用最佳实践参数",
        "输出推荐 INPUT 文件",
        "Python 脚本或 ABACUS 预处理器",
        "文档说明参数选择逻辑"
      ],
      "files_to_touch": [
        "tools/rare_earth_auto_setup.py",
        "tools/rare_earth_auto_setup_README.md"
      ],
      "estimated_effort": "1 week",
      "specialist": "workflow",
      "risk_level": "low",
      "old_ids": [
        "T4-1"
      ],
      "spec_doc": "docs/tasks/FE-400.md"
    },
    {
      "id": "FE-401",
      "title": "失败诊断 + 自动重试",
      "layer": "workflow",
      "type": "new",
      "scope": "abacus",
      "status": "terminated",
      "dependencies": [
        "FE-400"
      ],
      "blocks": [],
      "description": "[TERMINATED] 实现 SCF 失败自动诊断和重试机制：监控收敛模式（震荡/发散/慢收敛），自动调整参数重试。最多3次重试策略。\n\n终止原因：见 plans/2026-02-16-critical-review.md",
      "acceptance_criteria": [
        "识别失败模式（震荡/发散/慢收敛）",
        "自动调整策略：减小 beta/切换退火/尝试随机初始化",
        "最多3次重试策略",
        "输出诊断日志",
        "失败后给出明确错误信息和建议"
      ],
      "files_to_touch": [
        "tools/scf_auto_retry.py",
        "source/source_estate/module_esolver/esolver_ks.cpp"
      ],
      "estimated_effort": "1-2 weeks",
      "specialist": "workflow",
      "risk_level": "medium",
      "old_ids": [
        "T4-2"
      ],
      "spec_doc": "docs/tasks/FE-401.md"
    },
    {
      "id": "FE-402",
      "title": "abacustest 工作流集成",
      "layer": "workflow",
      "type": "extend",
      "scope": "abacus-test",
      "status": "pending",
      "dependencies": [
        "FE-400"
      ],
      "blocks": [],
      "description": "将稀土收敛工作流集成到 abacustest，提供预配置模板和自动化 VASP 对比。",
      "acceptance_criteria": [
        "添加稀土 DFT+U 工作流模板到 abacustest",
        "预配置 INPUT 文件（常见场景）",
        "自动 VASP 对比（如果有参考数据）",
        "集成到 abacustest 文档"
      ],
      "files_to_touch": [
        "abacustest/workflows/rare_earth_dftu/",
        "abacustest/workflows/rare_earth_dftu/README.md"
      ],
      "estimated_effort": "1 week",
      "specialist": "abacus-test",
      "risk_level": "low",
      "old_ids": [
        "T4-3"
      ],
      "spec_doc": "docs/tasks/FE-402.md"
    },
    {
      "id": "FE-403",
      "title": "文档与示例",
      "layer": "workflow",
      "type": "new",
      "scope": "abacus",
      "status": "terminated",
      "dependencies": [
        "FE-400"
      ],
      "blocks": [],
      "description": "[TERMINATED] 编写完整的用户文档和示例：教程、示例库、故障排除指南。\n\n终止原因：见 plans/2026-02-16-critical-review.md",
      "acceptance_criteria": [
        "教程：《ABACUS 稀土 DFT+U 计算指南》",
        "示例库：5-10 个收敛体系的 INPUT 文件和分析",
        "故障排除指南：常见失败模式和解决方案",
        "发布到 ABACUS 文档网站"
      ],
      "files_to_touch": [
        "docs/advanced/rare_earth_dftu_tutorial.md",
        "examples/rare_earth/",
        "docs/troubleshooting/rare_earth_convergence.md"
      ],
      "estimated_effort": "1 week",
      "specialist": "workflow",
      "risk_level": "low",
      "old_ids": [
        "T4-4"
      ],
      "spec_doc": "docs/tasks/FE-403.md"
    },
    {
      "id": "FE-404",
      "title": "自动化工作流与参数推荐系统",
      "layer": "workflow",
      "type": "new",
      "scope": "abacus",
      "status": "terminated",
      "dependencies": [
        "FE-401",
        "FE-403"
      ],
      "blocks": [],
      "description": "[TERMINATED] 整合所有技术为自动化工作流：(1) 根据输入结构自动选择赝势/轨道/DFT+U 参数，(2) 自动选择 SCF 策略（mixing 参数、是否启用约束、是否多起点），(3) 失败自动诊断和重试，(4) 通过 abacustest 或 PyABACUS 接口暴露。\n\n终止原因：见 plans/2026-02-16-critical-review.md",
      "acceptance_criteria": [
        "端到端自动化：用户只需提供结构文件，系统自动完成计算",
        "集成参数推荐、失败诊断、自动重试"
      ],
      "files_to_touch": [
        "tools/rare_earth_workflow.py"
      ],
      "estimated_effort": "1-2 weeks",
      "specialist": "workflow",
      "risk_level": "low",
      "old_ids": [
        "FE-500"
      ],
      "spec_doc": "docs/tasks/FE-404.md"
    }
  ],
  "current_task_id": null,
  "drafts": {},
  "gate_results": {},
  "integration_results": [],
  "human_decisions": [],
  "review_results": [],
  "human_approvals": [],
  "brainstorm_results": [],
  "blocked_reason": null
}
