# f-electron 项目重构设计文档

**日期:** 2026-02-16
**决策:** 将 f-electron-scf 拆分为两个独立项目

---

## 一、重构背景

基于 2026-02-16 批判性评审（见 `plans/2026-02-16-critical-review.md`），核心发现：

1. 项目 70% 工作量是追赶 VASP/QE 已有能力，非方法学创新
2. FE-205 (constrained DFT) 被标为 priority 100 / "frontier"，但 VASP 2009 年已有成熟实现
3. 最大风险（赝势质量）被延迟到 Phase 3 才暴露
4. ABACUS 的真正差异化优势（LCAO 基组）未被利用
5. 与 deepmodeling 生态（DeePMD-kit、DeePTB）协同为零

**决策：** 拆分为工程项目（3.5 个月）和研究项目（6 个月），诚实定位，聚焦差异化。

---

## 二、项目 1：f-electron-engineering

### 定位

ABACUS 稀土 DFT+U 计算能力完善。工程追赶，不标"frontier"。

### 任务变更

**终止的任务（8 个）：**

| 任务 | 原因 |
|------|------|
| FE-001 | 代码审计是阅读非生产，改为阅读文档即可 |
| FE-203 | 占据矩阵退火与 FE-202 (multi-start) 冗余 |
| FE-401 | 失败诊断+自动重试，过度工程化 |
| FE-403 | 过早写文档，应在验证后再写 |
| FE-404 | 自动化工作流，依赖已终止任务 |
| FE-D-C1 | ML 训练数据收集，投入产出比极低 |
| FE-D-C2 | GNN 模型训练，需 ML 专业知识且延迟触发不可控 |
| FE-D-C3 | ABACUS ML 集成，依赖已终止任务 |

**降级的任务：**

| 任务 | 变更 |
|------|------|
| FE-205 及子任务 | priority 100→70，标记"工程追赶" |
| FE-200 | priority 95→65 |

**新增的任务（2 个）：**

| 任务 ID | 标题 | 阶段 | 工期 |
|---------|------|------|------|
| FE-005 | 赝势质量前置验证 | Phase 0 | 3-5 天 |
| FE-306 | CeO2 全电子参考计算 (FHI-aims) | Phase 3 | 1 周 |

**FE-005 详细定义：**
- 用现有赝势（SG15/PseudoDojo）对 CeO2、Gd2O3 跑 ABACUS + VASP 对比
- 量化偏差：晶格常数、体模量、带隙、磁矩
- Go/No-Go：偏差 >5% 则立即触发赝势生成（转入项目 2）
- 依赖：FE-000
- 阻塞：FE-302

**FE-306 详细定义：**
- 用 FHI-aims 或 Elk 对 CeO2 做全电子参考计算
- 提供赝势近似误差的绝对参考
- 消除"ABACUS ≠ VASP 时无法区分算法问题还是赝势问题"的歧义
- 依赖：FE-302
- 阻塞：FE-304

**FE-204 依赖更新：**
- 原依赖：FE-200, FE-201, FE-203
- 新依赖：FE-200, FE-201（移除已终止的 FE-203）

**FE-001 阻塞关系处理：**
- FE-001 原阻塞 FE-200, FE-201, FE-202
- 终止 FE-001 后，FE-200/201/202 移除对 FE-001 的依赖（代码审计不再是前置条件）

### 里程碑

**M0（第 2 周）：基础验证完成**
- 任务：FE-000 + FE-005 + FE-002
- 交付物：赝势可用性报告 + 回归测试基线
- Go/No-Go：赝势偏差 >5% → 触发项目 2 赝势生成任务
- 验收标准：赝势报告完成，回归测试可运行

**M1（第 6 周）：代码迁移完成**
- 任务：FE-100 ~ FE-113（14 个任务）
- 交付物：ABACUS develop 分支具备完整 DFT+U PW/LCAO + DeltaSpin
- 验收标准：回归测试全部通过，nspin=1/2/4 均可运行
- 里程碑意义：项目 2 可在此后启动

**M2（第 10 周）：收敛策略可用**
- 任务：FE-200, FE-201, FE-202, FE-204, FE-205 系列
- 交付物：f 电子 SCF 收敛率 >80%
- 验收标准：Ce2O3、GdN、NdFeB 三个代表体系均可收敛

**M3（第 14 周）：验证与交付**
- 任务：FE-302, FE-303, FE-304, FE-305, FE-306, FE-400, FE-402
- 交付物：验证报告 + 全电子参考 + 自动化工作流
- 验收标准：ABACUS vs VASP 偏差 <3%（晶格常数）、<10%（体模量）

### 预期收益

| 收益 | 量化指标 |
|------|---------|
| 稀土 DFT+U 可用性 | 从"困难/不可用"提升到"可用" |
| SCF 收敛率 | 从 ~30-50% 提升到 >80% |
| 用户体验 | 非专家可通过自动参数选择完成计算 |
| 论文产出 | 1 篇应用/软件论文 |
| 对项目 2 的支撑 | 提供基础 DFT+U 能力 |

### 任务统计

- 原任务数：42（含延迟）→ 新任务数：~30
- 原工期：25 周 → 新工期：14 周
- 终止任务节省：~8 周工作量

---

## 三、项目 2：f-electron-multiscale

### 定位

基于 ABACUS LCAO + deepmodeling 生态的稀土材料计算创新。VASP/QE 生态无法提供的差异化能力。

### 前置依赖

项目 1 的 M1（第 6 周，代码迁移完成）。项目 2 在第 8 周启动，与项目 1 后半段并行。

### 任务定义

**Phase R0：LCAO f 电子基线（第 8-10 周）**

| 任务 ID | 标题 | 工期 | 依赖 |
|---------|------|------|------|
| FM-001 | LCAO 基组 f 电子收敛性系统测试 | 1 周 | 项目 1 M1 |
| FM-002 | LCAO vs PW 精度偏差量化 | 1 周 | FM-001 |

FM-001：对 CeO2、Gd2O3、La2O3 分别用 SZ/DZP/TZDP 基组测试 DFT+U 收敛性，记录收敛率、SCF 步数、能量精度。
FM-002：同一体系 LCAO vs PW 对比，量化晶格常数、体模量、带隙偏差。Go/No-Go：偏差 >3% 触发 FM-003/004。

**Phase R1：差异化能力原型（第 10-18 周）**

| 任务 ID | 标题 | 工期 | 依赖 |
|---------|------|------|------|
| FM-003 | NAO 多 zeta f 轨道生成与测试 | 1-2 周 | FM-002（条件触发） |
| FM-004 | Spillage 算法 f 轨道调优 | 1-2 周 | FM-003（条件触发） |
| FM-005 | DFT+U+V 可行性评估 | 1 周 | FM-002 |
| FM-006 | DFT+U+V 原型实现 | 2-3 周 | FM-005 |
| FM-007 | 大规模稀土 LCAO 性能基准 | 1-2 周 | FM-002 |
| FM-008 | 自定义稀土 NC 赝势生成 | 2-3 周 | 项目 1 M0 门控触发 |
| FM-009 | 新赝势验证 | 1-2 周 | FM-008 |

FM-003/004：从原 FE-D-B1/B2 迁移，条件触发。
FM-005：调研 QE hp.x 的站间 Hubbard 实现，评估在 ABACUS 中实现的工作量和价值。
FM-006：如 FM-005 评估可行，实现 DFT+U+V 原型（至少支持 LCAO）。
FM-007：100-500 原子 CeO2 表面 slab，展示 LCAO 相对 PW 的计算成本优势。
FM-008/009：从原 FE-D-A2/A3 迁移（FE-D-A1 环境搭建合并到 FM-008）。

**Phase R2：生态集成（第 18-24 周）**

| 任务 ID | 标题 | 工期 | 依赖 |
|---------|------|------|------|
| FM-010 | ABACUS DFT+U → DeePMD-kit 训练数据工作流 | 2 周 | FM-007 |
| FM-011 | 稀土体系 MLP 质量验证 | 1-2 周 | FM-010 |
| FM-012 | DeePTB f 电子紧束缚模型探索 | 2-3 周 | FM-002 |
| FM-013 | 大规模稀土 MD 演示 | 1-2 周 | FM-011 |

FM-010：设计从 ABACUS DFT+U LCAO 计算到 DeePMD-kit 训练集的自动化流程。
FM-011：验证 MLP 对稀土体系的力/能量/应力精度。
FM-012：探索 DeePTB 能否学习 f 电子的紧束缚哈密顿量。
FM-013：1000+ 原子稀土体系 MD 模拟演示。

**Phase R3：发表与交付（第 24-26 周）**

| 任务 ID | 标题 | 工期 | 依赖 |
|---------|------|------|------|
| FM-014 | 方法学论文撰写 | 2 周 | FM-006, FM-013 |
| FM-015 | 文档与开源工具链 | 1 周 | FM-014 |

### 里程碑

**R0（第 10 周）：LCAO f 电子基线建立**
- 交付物：LCAO f 电子基组质量报告
- Go/No-Go：LCAO vs PW 偏差 >3% → 触发 FM-003/004

**R1（第 18 周）：差异化能力原型**
- 交付物：DFT+U+V 原型 + 大规模 LCAO 基准数据
- 验收标准：100 原子 CeO2 slab LCAO 计算成功收敛

**R2（第 24 周）：生态集成**
- 交付物：端到端 "DFT+U → MLP → 大规模 MD" 工作流
- 验收标准：MLP 力精度 <50 meV/Å，1000+ 原子 MD 可运行

**R3（第 26 周）：发表与交付**
- 交付物：论文初稿 + 开源工具链
- 验收标准：论文提交

### 预期收益

| 收益 | 量化指标 |
|------|---------|
| LCAO 大规模稀土计算 | 100-500 原子级别，VASP 无法竞争 |
| DFT+U+V 方法学 | ABACUS 填补空白，VASP 也没有 |
| deepmodeling 全链路 | 首次实现稀土 "DFT → MLP → MD" |
| 论文产出 | 1-2 篇方法学论文（有真正创新内容） |
| 计算成本优势 | LCAO 比 PW 低 1-2 个数量级（大体系） |

---

## 四、两个项目的时间线总览

```
周次:  1  2  3  4  5  6  7  8  9 10 11 12 13 14 ... 18 ... 24 26
      |-----|-----------|-----------|-----------|
项目1: [M0 ] [   M1    ] [   M2    ] [   M3    ]
                              |
                              v 项目2启动
      　　　　　　　　　　　　 |-----|-----------|-----------|--|
项目2:                        [ R0  ] [   R1    ] [   R2    ] R3
```

- 项目 1：第 1-14 周（3.5 个月）
- 项目 2：第 8-26 周（4.5 个月）
- 并行期：第 8-14 周
- 总跨度：26 周（6.5 个月）

---

## 五、风险与门控

| 门控点 | 条件 | 触发动作 |
|--------|------|---------|
| M0 赝势验证 | 偏差 >5% | 立即启动 FM-008/009 赝势生成 |
| R0 LCAO 基线 | LCAO vs PW 偏差 >3% | 触发 FM-003/004 NAO 优化 |
| R1 DFT+U+V 评估 | 实现工作量 >4 周 | 降级为可行性报告，不做原型 |
| R2 MLP 验证 | 力精度 >100 meV/Å | 调整训练策略或降级为概念验证 |

---

## 六、与原项目的对比

| 维度 | 原项目 | 重构后 |
|------|--------|--------|
| 项目数 | 1 | 2 |
| 总任务数 | 42 | ~30 + 15 = ~45 |
| 工程追赶占比 | 70% | 项目 1: 100%（诚实定位） |
| 创新内容占比 | 30%（标签虚高） | 项目 2: 100%（真正差异化） |
| 方法学创新 | 2/10 | 项目 2: 7/10 |
| 生态协同 | 2/10 | 项目 2: 8/10 |
| 论文预期 | 1 篇应用论文 | 1 篇应用 + 1-2 篇方法学 |
| 总工期 | 25 周（乐观） | 26 周（含并行） |
| LCAO 差异化 | 未利用 | 核心目标 |
| DFT+U+V | 未规划 | 原型实现 |
| DeePMD-kit 集成 | 无 | 全链路工作流 |
