# f-electron-scf 项目批判性评审报告

**日期:** 2026-02-16
**评审性质:** 项目先进性、预期效益与任务合理性的独立批判性评估

---

## 一、核心判断

**本项目约 70% 的工作量是让 ABACUS 追赶 VASP/QE 已有的 f 电子计算能力，约 30% 是真正的改进。项目以"解决 f 电子 SCF 收敛问题"为名，但实际上 VASP 在 2009 年（Dorado 等人的 UO2 研究）就通过占据矩阵控制解决了这个问题的核心方法学。本项目的本质是工程追赶，不是方法学创新。**

这不意味着项目没有价值——ABACUS 作为开源代码需要这些能力。但项目的定位、优先级排序和资源分配需要基于这个诚实判断来重新审视。

---

## 二、先进性评价

### 2.1 与现有代码的功能对比

| 功能 | VASP | QE | ABACUS 现状 | 本项目计划 | 评价 |
|------|------|----|-------------|-----------|------|
| DFT+U (Dudarev) | ✅ 成熟 | ✅ 成熟 | ✅ 已有 | 扩展 PW 支持 | 工程补全 |
| 占据矩阵控制 (omc) | ✅ OCCEXT 成熟 | ✅ starting_ns | ✅ 已有 omc=0/1/2 | 增强 | 增量改进 |
| Constrained DFT | ✅ 已有 | ✅ 已有 | ❌ 无 | FE-205 新增 | **追赶，非创新** |
| 自适应 Kerker | 隐式处理 | 隐式处理 | ❌ 无 | FE-200 新增 | 有用但非新方法 |
| 占据矩阵退火 | 用户手动 | 用户手动 | ❌ 无 | FE-203 新增 | 已知技术的自动化 |
| Multi-start 探索 | 用户手动 | 用户手动 | ❌ 无 | FE-202 新增 | 已知技术的自动化 |
| DFT+U+V (站间 Hubbard) | ❌ 无 | ✅ hp.x | ❌ 无 | **未规划** | 重大缺失 |
| Liechtenstein 形式 | ✅ 有 | ✅ 有 | ❌ 无 | **未规划** | 缺失 |
| LCAO 基组 f 电子 | ❌ 无 | ❌ 无 | ⚠️ 有限 | 间接涉及 | **ABACUS 独有优势，未充分利用** |
| GNN 占据矩阵预测 | ❌ 无 | ❌ 无 | ❌ 无 | 延迟 (FE-D-C2) | 唯一前沿内容，但被延迟 |

### 2.2 先进性结论

- **前沿创新 (Frontier):** 仅 GNN 占据矩阵预测（FE-D-C2），但被延迟且触发条件苛刻
- **有差异化价值:** LCAO 基组的大规模稀土计算能力，但项目未将其作为核心目标
- **工程追赶:** Phase 1 全部（14 个任务）、Phase 2 大部分（FE-202/203/205）
- **标准工程:** Phase 4 全部（自动化工具）

**项目自评的 "priority score 100/100" 给了 FE-205 (constrained DFT)，但项目自己的文献综述将其标记为 "incremental"。这是自相矛盾的。**

---

## 三、预期效益分析

### 3.1 对 ABACUS 用户的效益

| 效益 | 概率 | 影响 |
|------|------|------|
| 稀土体系 DFT+U 可用性从"困难"提升到"可用" | 高 | 高 |
| SCF 收敛率提升 30-50% | 中 | 中 |
| 非专家用户可以计算稀土体系 | 中 | 中 |
| ABACUS 在稀土领域与 VASP 竞争力 | 低-中 | 高 |

### 3.2 对科学社区的效益

| 效益 | 概率 | 影响 |
|------|------|------|
| 方法学论文（高影响期刊） | **低** | — |
| 应用论文（计算材料学期刊） | 中 | 中 |
| 软件论文 | 中 | 低 |
| 推动 f 电子计算方法学发展 | **低** | — |

### 3.3 效益的诚实评估

**最可能的结果：** ABACUS 获得了与 VASP 2015 年水平相当的 f 电子计算能力。用户不再需要切换到 VASP 来做稀土计算。这对 ABACUS 生态有价值，但对计算材料学领域没有推动作用。

**不太可能的结果：** 项目产出方法学创新（GNN 模型、LCAO 大规模计算）。这需要延迟任务全部触发且成功，概率较低。

---

## 四、任务级批判与终止建议

### 4.1 建议终止的任务

| 任务 | 原因 | 节省工期 |
|------|------|---------|
| FE-001 (DFT+U 代码审计) | 代码已有文档，审计是阅读而非生产性工作。改为"阅读现有文档 + 记录关键接口"即可，不需要独立任务 | 2-3 天 |
| FE-203 (占据矩阵退火) | 模拟退火是通用启发式方法，对 f 电子问题没有特殊优势。FE-202 (multi-start) 已经覆盖了多极小值探索的需求。两者同时存在是冗余 | 3-5 天 |
| FE-403 (用户文档) | 在项目完成前写文档是浪费。应在 Phase 3 验证完成后再写，且不需要独立任务 | 3-5 天 |
| FE-D-C1/C2/C3 (全部 ML 延迟任务) | 训练 GNN 需要 6-8 周额外时间和 ML 专业知识。如果规则方法失败率 >20%，正确的做法是改进规则方法或使用 Hund 规则查找表，而不是训练神经网络。投入产出比极低 | 6-8 周（如触发） |

### 4.2 建议降级的任务

| 任务 | 当前定位 | 建议调整 |
|------|---------|---------|
| FE-205 (constrained DFT) | priority 100/100, "frontier" | 降为 priority 70, "engineering catch-up"。VASP/QE 已有成熟实现，这是功能补全 |
| FE-200 (自适应 Kerker) | priority 95/100 | 降为 priority 65。概念不新，其他代码通过调优默认参数隐式处理 |
| FE-400-404 (Phase 4 自动化) | 独立阶段 | 合并为 2 个任务：(1) 参数自动选择 (2) abacustest 集成。其余砍掉 |

### 4.3 建议提升的任务

| 方向 | 理由 | 建议 |
|------|------|------|
| 赝势验证前置 | 当前赝势质量是最大风险，却被延迟到 Phase 3 才发现问题。如果赝势不行，所有算法改进都建立在沙子上 | 将赝势验证从 Phase 3 提前到 Phase 0，与 FE-000 合并 |
| 全电子参考计算 | 当前只与 VASP 对比。如果 ABACUS ≠ VASP，无法区分是算法问题还是赝势问题 | 新增任务：至少对 CeO2 做 FHI-aims 或 Elk 全电子参考 |
| LCAO f 电子专项优化 | ABACUS 的 LCAO 基组是相对于 VASP/QE 的唯一差异化优势。大规模稀土 LCAO 计算比 PW 便宜一个数量级 | 新增任务：LCAO 基组 f 电子收敛性专项测试和优化 |
| DFT+U+V 支持 | QE 已有 hp.x 实现站间 Hubbard 参数自洽计算。这是 DFT+U 方法学的真正前沿，VASP 也没有 | 新增任务：评估 DFT+U+V 在 ABACUS 中的可行性 |

---

## 五、项目根本性问题

### 5.1 项目没有回答"为什么"

项目把 f 电子 SCF 收敛当作工程问题（调参数、换初猜、加约束），但没有回答根本问题：

- DFT+U 的能量面上有多少个局域极小值？势垒有多高？
- Dudarev 简化形式对 f 电子是否足够，还是需要 Liechtenstein 完整形式？
- 赝势近似对 4f 电子的系统误差有多大？
- 什么时候应该放弃 DFT+U，转用杂化泛函或 GW？

**没有这些基础理解，所有的收敛策略都是"试错法"——可能有效，但不知道为什么有效，也不知道什么时候会失效。**

### 5.2 项目错过了 ABACUS 的真正差异化

ABACUS 相对于 VASP/QE 的核心优势是 LCAO 数值原子轨道基组。对于稀土体系：

- LCAO 计算成本比 PW 低 1-2 个数量级（对于大体系）
- LCAO 天然适合局域化的 f 电子描述
- VASP 没有 LCAO，QE 的 LCAO 支持有限

**如果项目的目标是"让 ABACUS 做稀土计算和 VASP 一样好"，那永远追不上——VASP 有 30 年的积累。但如果目标是"让 ABACUS 做 VASP 做不了的大规模稀土 LCAO 计算"，这才是真正的差异化价值。**

### 5.3 与 deepmodeling 生态的协同不足

项目标题提到"deepmodeling 生态"，但实际上与 DeePMD-kit、DeePTB 的协同几乎为零：

- 没有 MLP 加速的稀土 MD 模拟
- 没有 DeePTB 的 f 电子紧束缚模型
- 没有利用 ABACUS 产生 DeePMD 训练数据的工作流

这些才是 deepmodeling 生态的独特价值，其他 DFT 代码生态无法提供。

---

## 六、量化评估总结

### 6.1 任务分类统计

| 类别 | 任务数 | 占比 | 工期估计 |
|------|--------|------|---------|
| 工程追赶（VASP/QE 已有） | 22 | 52% | ~15 周 |
| 增量改进（已知方法的自动化） | 10 | 24% | ~8 周 |
| 有差异化价值 | 4 | 10% | ~4 周 |
| 纯基础设施/文档 | 6 | 14% | ~3 周 |
| **合计** | **42** | **100%** | **~30 周** |

### 6.2 创新性评分

| 维度 | 评分 (1-10) | 说明 |
|------|------------|------|
| 方法学创新 | 2/10 | 几乎所有方法都已在其他代码中实现 |
| 工程价值 | 7/10 | 对 ABACUS 用户有实际价值 |
| 科学影响力 | 3/10 | 不太可能产出高影响论文 |
| 生态协同 | 2/10 | 与 deepmodeling 其他工具协同不足 |
| 差异化竞争力 | 3/10 | 主要是追赶，未利用 LCAO 优势 |

---

## 七、建议的行动方向

以下三个方向供决策参考，不互斥：

### 方向 A：LCAO 差异化路线（推荐）

保留 Phase 1 代码迁移（必要的工程债务），但将 Phase 2 的重心从"复制 VASP 的收敛策略"转向"LCAO 基组的 f 电子专项优化"。新增：
- LCAO f 电子基组质量评估与优化
- DFT+U+V 可行性评估
- 大规模稀土体系 LCAO 性能基准（100+ 原子，VASP 做不到）
- 与 DeePMD-kit 的 MLP 训练数据生成工作流

**预期效益：** ABACUS 在大规模稀土 LCAO 计算上建立 VASP 无法竞争的优势。

### 方向 B：务实工程路线

承认项目本质是工程追赶，重新定义为"ABACUS 稀土计算能力完善"。砍掉所有"frontier"标签，降低预期。保留 Phase 1-3 核心任务，终止 Phase 4 大部分和所有 ML 延迟任务。目标从"创新"调整为"可用性"。

**预期效益：** 3-4 个月内让 ABACUS 稀土 DFT+U 达到可用水平。

### 方向 C：拆分为工程+研究两个项目

将当前项目缩减为纯工程项目（Phase 0-1 + 基础验证），同时启动一个真正有创新性的并行研究项目：基于 ABACUS LCAO + DeePMD-kit 的稀土材料多尺度模拟框架。

**预期效益：** 工程项目 3 个月交付可用能力；研究项目 6 个月产出有发表价值的方法学创新。

---

## 八、结论

这是一个规划质量高、执行路径清晰的项目，但它解决的是一个 2009 年就已经被 VASP 解决的问题。项目的价值在于让 ABACUS 获得这些能力，而不在于方法学创新。

**建议：**
1. 诚实地重新定位项目——这是工程完善，不是科学创新
2. 赝势验证前置——不要在沙子上建楼
3. 利用 LCAO 差异化——这是 ABACUS 唯一能赢 VASP 的地方
4. 砍掉低价值任务——FE-203、FE-403、ML 延迟任务
5. 补充真正缺失的能力——DFT+U+V、全电子参考、LCAO 专项优化
