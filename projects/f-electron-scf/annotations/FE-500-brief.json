{
  "task_id": "FE-500",
  "title": "自动化工作流与参数推荐系统",
  "specialist": "workflow_agent",

  "goal": "整合所有技术成果为自动化工作流：用户只需提供结构文件和目标精度，系统自动选择赝势/轨道/DFT+U参数/SCF策略，完成计算并验证结果。",

  "workflow_design": {
    "input": {
      "required": ["STRU文件（或ASE Atoms对象）"],
      "optional": ["目标精度级别（fast/production/high）", "目标性质（energy/force/band）", "已知氧化态"]
    },
    "stages": [
      {
        "name": "结构分析",
        "actions": [
          "识别稀土元素及其化学环境",
          "推断氧化态（基于配位环境或用户指定）",
          "判断体系类型（体相/表面/分子）",
          "估计计算规模（原子数、k点数）"
        ]
      },
      {
        "name": "参数选择",
        "actions": [
          "选择赝势（从验证过的赝势库）",
          "选择轨道文件（根据精度级别）",
          "设置DFT+U参数（U值、omc模式）",
          "设置SCF参数（mixing_beta、mixing_gg0、是否启用退火/约束）",
          "设置ecutwfc（PW）或确认轨道截断半径（LCAO）"
        ]
      },
      {
        "name": "AI初猜（可选）",
        "actions": [
          "如果AI模型可用，预测初始占据矩阵",
          "生成initial_onsite.dm",
          "设置omc=1"
        ]
      },
      {
        "name": "SCF计算",
        "actions": [
          "运行ABACUS SCF",
          "监控收敛行为",
          "如果不收敛，自动升级策略（退火→约束→多起点）",
          "记录收敛路径信息"
        ]
      },
      {
        "name": "结果验证",
        "actions": [
          "检查f电子数是否合理（与预期氧化态一致）",
          "检查磁矩是否合理",
          "检查能量是否为多起点中的最低值",
          "输出警告（如果检测到可能的亚稳态）"
        ]
      }
    ],
    "output": {
      "files": ["收敛的电荷密度", "占据矩阵", "能量/力/应力"],
      "report": ["SCF收敛报告", "f电子分析报告", "参数选择日志"]
    }
  },

  "implementation": {
    "framework": "Python脚本 + abacustest集成",
    "entry_point": "rare_earth_workflow.py",
    "config": "rare_earth_defaults.yaml — 默认参数表",
    "integration": [
      "可通过PyABACUS调用",
      "可通过abacustest的workflow系统调用",
      "可作为独立命令行工具"
    ]
  },

  "acceptance_criteria": [
    "端到端自动化：用户提供STRU文件，系统自动完成计算",
    "在10个测试体系上，自动化工作流的成功率 > 80%",
    "参数选择合理（与专家手动选择的结果一致或更优）",
    "失败时有清晰的诊断信息和建议"
  ]
}
